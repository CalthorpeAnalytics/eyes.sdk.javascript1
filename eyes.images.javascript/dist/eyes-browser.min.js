(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){window.EyesImages=require("./index");console.log("loaded EyesImages into the 'window' object")},{"./index":2}],2:[function(require,module,exports){exports.Eyes=require("./src/Eyes");exports.EyesImagesScreenshot=require("./src/EyesImagesScreenshot")},{"./src/Eyes":57,"./src/EyesImagesScreenshot":58}],3:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":55}],4:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],5:[function(require,module,exports){},{}],6:[function(require,module,exports){arguments[4][5][0].apply(exports,arguments)},{dup:5}],7:[function(require,module,exports){(function(process,Buffer){"use strict";var assert=require("assert");var Zstream=require("pako/lib/zlib/zstream");var zlib_deflate=require("pako/lib/zlib/deflate.js");var zlib_inflate=require("pako/lib/zlib/inflate.js");var constants=require("pako/lib/zlib/constants");for(var key in constants){exports[key]=constants[key]}exports.NONE=0;exports.DEFLATE=1;exports.INFLATE=2;exports.GZIP=3;exports.GUNZIP=4;exports.DEFLATERAW=5;exports.INFLATERAW=6;exports.UNZIP=7;var GZIP_HEADER_ID1=31;var GZIP_HEADER_ID2=139;function Zlib(mode){if(typeof mode!=="number"||mode<exports.DEFLATE||mode>exports.UNZIP){throw new TypeError("Bad argument")}this.dictionary=null;this.err=0;this.flush=0;this.init_done=false;this.level=0;this.memLevel=0;this.mode=mode;this.strategy=0;this.windowBits=0;this.write_in_progress=false;this.pending_close=false;this.gzip_id_bytes_read=0}Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=true;return}this.pending_close=false;assert(this.init_done,"close before init");assert(this.mode<=exports.UNZIP);if(this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW){zlib_deflate.deflateEnd(this.strm)}else if(this.mode===exports.INFLATE||this.mode===exports.GUNZIP||this.mode===exports.INFLATERAW||this.mode===exports.UNZIP){zlib_inflate.inflateEnd(this.strm)}this.mode=exports.NONE;this.dictionary=null};Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){return this._write(true,flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){return this._write(false,flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype._write=function(async,flush,input,in_off,in_len,out,out_off,out_len){assert.equal(arguments.length,8);assert(this.init_done,"write before init");assert(this.mode!==exports.NONE,"already finalized");assert.equal(false,this.write_in_progress,"write already in progress");assert.equal(false,this.pending_close,"close is pending");this.write_in_progress=true;assert.equal(false,flush===undefined,"must provide flush value");this.write_in_progress=true;if(flush!==exports.Z_NO_FLUSH&&flush!==exports.Z_PARTIAL_FLUSH&&flush!==exports.Z_SYNC_FLUSH&&flush!==exports.Z_FULL_FLUSH&&flush!==exports.Z_FINISH&&flush!==exports.Z_BLOCK){throw new Error("Invalid flush value")}if(input==null){input=Buffer.alloc(0);in_len=0;in_off=0}this.strm.avail_in=in_len;this.strm.input=input;this.strm.next_in=in_off;this.strm.avail_out=out_len;this.strm.output=out;this.strm.next_out=out_off;this.flush=flush;if(!async){this._process();if(this._checkError()){return this._afterSync()}return}var self=this;process.nextTick(function(){self._process();self._after()});return this};Zlib.prototype._afterSync=function(){var avail_out=this.strm.avail_out;var avail_in=this.strm.avail_in;this.write_in_progress=false;return[avail_in,avail_out]};Zlib.prototype._process=function(){var next_expected_header_byte=null;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:this.err=zlib_deflate.deflate(this.strm,this.flush);break;case exports.UNZIP:if(this.strm.avail_in>0){next_expected_header_byte=this.strm.next_in}switch(this.gzip_id_bytes_read){case 0:if(next_expected_header_byte===null){break}if(this.strm.input[next_expected_header_byte]===GZIP_HEADER_ID1){this.gzip_id_bytes_read=1;next_expected_header_byte++;if(this.strm.avail_in===1){break}}else{this.mode=exports.INFLATE;break}case 1:if(next_expected_header_byte===null){break}if(this.strm.input[next_expected_header_byte]===GZIP_HEADER_ID2){this.gzip_id_bytes_read=2;this.mode=exports.GUNZIP}else{this.mode=exports.INFLATE}break;default:throw new Error("invalid number of gzip magic number bytes read")}case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:this.err=zlib_inflate.inflate(this.strm,this.flush);if(this.err===exports.Z_NEED_DICT&&this.dictionary){this.err=zlib_inflate.inflateSetDictionary(this.strm,this.dictionary);if(this.err===exports.Z_OK){this.err=zlib_inflate.inflate(this.strm,this.flush)}else if(this.err===exports.Z_DATA_ERROR){this.err=exports.Z_NEED_DICT}}while(this.strm.avail_in>0&&this.mode===exports.GUNZIP&&this.err===exports.Z_STREAM_END&&this.strm.next_in[0]!==0){this.reset();this.err=zlib_inflate.inflate(this.strm,this.flush)}break;default:throw new Error("Unknown mode "+this.mode)}};Zlib.prototype._checkError=function(){switch(this.err){case exports.Z_OK:case exports.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===exports.Z_FINISH){this._error("unexpected end of file");return false}break;case exports.Z_STREAM_END:break;case exports.Z_NEED_DICT:if(this.dictionary==null){this._error("Missing dictionary")}else{this._error("Bad dictionary")}return false;default:this._error("Zlib error");return false}return true};Zlib.prototype._after=function(){if(!this._checkError()){return}var avail_out=this.strm.avail_out;var avail_in=this.strm.avail_in;this.write_in_progress=false;this.callback(avail_in,avail_out);if(this.pending_close){this.close()}};Zlib.prototype._error=function(message){if(this.strm.msg){message=this.strm.msg}this.onerror(message,this.err);this.write_in_progress=false;if(this.pending_close){this.close()}};Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){assert(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])");assert(windowBits>=8&&windowBits<=15,"invalid windowBits");assert(level>=-1&&level<=9,"invalid compression level");assert(memLevel>=1&&memLevel<=9,"invalid memlevel");assert(strategy===exports.Z_FILTERED||strategy===exports.Z_HUFFMAN_ONLY||strategy===exports.Z_RLE||strategy===exports.Z_FIXED||strategy===exports.Z_DEFAULT_STRATEGY,"invalid strategy");this._init(level,windowBits,memLevel,strategy,dictionary);this._setDictionary()};Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")};Zlib.prototype.reset=function(){this._reset();this._setDictionary()};Zlib.prototype._init=function(level,windowBits,memLevel,strategy,dictionary){this.level=level;this.windowBits=windowBits;this.memLevel=memLevel;this.strategy=strategy;this.flush=exports.Z_NO_FLUSH;this.err=exports.Z_OK;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP){this.windowBits+=16}if(this.mode===exports.UNZIP){this.windowBits+=32}if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW){this.windowBits=-1*this.windowBits}this.strm=new Zstream;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:this.err=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:this.err=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(this.err!==exports.Z_OK){this._error("Init error")}this.dictionary=dictionary;this.write_in_progress=false;this.init_done=true};Zlib.prototype._setDictionary=function(){if(this.dictionary==null){return}this.err=exports.Z_OK;switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:this.err=zlib_deflate.deflateSetDictionary(this.strm,this.dictionary);break;default:break}if(this.err!==exports.Z_OK){this._error("Failed to set dictionary")}};Zlib.prototype._reset=function(){this.err=exports.Z_OK;switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:case exports.GZIP:this.err=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:case exports.GUNZIP:this.err=zlib_inflate.inflateReset(this.strm);break;default:break}if(this.err!==exports.Z_OK){this._error("Failed to reset stream")}};exports.Zlib=Zlib}).call(this,require("_process"),require("buffer").Buffer)},{_process:29,assert:3,buffer:9,"pako/lib/zlib/constants":18,"pako/lib/zlib/deflate.js":20,"pako/lib/zlib/inflate.js":22,"pako/lib/zlib/zstream":26}],8:[function(require,module,exports){(function(process){"use strict";var Buffer=require("buffer").Buffer;var Transform=require("stream").Transform;var binding=require("./binding");var util=require("util");var assert=require("assert").ok;var kMaxLength=require("buffer").kMaxLength;var kRangeErrorMessage="Cannot create final Buffer. It would be larger "+"than 0x"+kMaxLength.toString(16)+" bytes";binding.Z_MIN_WINDOWBITS=8;binding.Z_MAX_WINDOWBITS=15;binding.Z_DEFAULT_WINDOWBITS=15;binding.Z_MIN_CHUNK=64;binding.Z_MAX_CHUNK=Infinity;binding.Z_DEFAULT_CHUNK=16*1024;binding.Z_MIN_MEMLEVEL=1;binding.Z_MAX_MEMLEVEL=9;binding.Z_DEFAULT_MEMLEVEL=8;binding.Z_MIN_LEVEL=-1;binding.Z_MAX_LEVEL=9;binding.Z_DEFAULT_LEVEL=binding.Z_DEFAULT_COMPRESSION;var bkeys=Object.keys(binding);for(var bk=0;bk<bkeys.length;bk++){var bkey=bkeys[bk];if(bkey.match(/^Z/)){Object.defineProperty(exports,bkey,{enumerable:true,value:binding[bkey],writable:false})}}var codes={Z_OK:binding.Z_OK,Z_STREAM_END:binding.Z_STREAM_END,Z_NEED_DICT:binding.Z_NEED_DICT,Z_ERRNO:binding.Z_ERRNO,Z_STREAM_ERROR:binding.Z_STREAM_ERROR,Z_DATA_ERROR:binding.Z_DATA_ERROR,Z_MEM_ERROR:binding.Z_MEM_ERROR,Z_BUF_ERROR:binding.Z_BUF_ERROR,Z_VERSION_ERROR:binding.Z_VERSION_ERROR};var ckeys=Object.keys(codes);for(var ck=0;ck<ckeys.length;ck++){var ckey=ckeys[ck];codes[codes[ckey]]=ckey}Object.defineProperty(exports,"codes",{enumerable:true,value:Object.freeze(codes),writable:false});exports.Deflate=Deflate;exports.Inflate=Inflate;exports.Gzip=Gzip;exports.Gunzip=Gunzip;exports.DeflateRaw=DeflateRaw;exports.InflateRaw=InflateRaw;exports.Unzip=Unzip;exports.createDeflate=function(o){return new Deflate(o)};exports.createInflate=function(o){return new Inflate(o)};exports.createDeflateRaw=function(o){return new DeflateRaw(o)};exports.createInflateRaw=function(o){return new InflateRaw(o)};exports.createGzip=function(o){return new Gzip(o)};exports.createGunzip=function(o){return new Gunzip(o)};exports.createUnzip=function(o){return new Unzip(o)};exports.deflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Deflate(opts),buffer,callback)};exports.deflateSync=function(buffer,opts){return zlibBufferSync(new Deflate(opts),buffer)};exports.gzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gzip(opts),buffer,callback)};exports.gzipSync=function(buffer,opts){return zlibBufferSync(new Gzip(opts),buffer)};exports.deflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new DeflateRaw(opts),buffer,callback)};exports.deflateRawSync=function(buffer,opts){return zlibBufferSync(new DeflateRaw(opts),buffer)};exports.unzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Unzip(opts),buffer,callback)};exports.unzipSync=function(buffer,opts){return zlibBufferSync(new Unzip(opts),buffer)};exports.inflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Inflate(opts),buffer,callback)};exports.inflateSync=function(buffer,opts){return zlibBufferSync(new Inflate(opts),buffer)};exports.gunzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gunzip(opts),buffer,callback)};exports.gunzipSync=function(buffer,opts){return zlibBufferSync(new Gunzip(opts),buffer)};exports.inflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new InflateRaw(opts),buffer,callback)};exports.inflateRawSync=function(buffer,opts){return zlibBufferSync(new InflateRaw(opts),buffer)};function zlibBuffer(engine,buffer,callback){var buffers=[];var nread=0;engine.on("error",onError);engine.on("end",onEnd);engine.end(buffer);flow();function flow(){var chunk;while(null!==(chunk=engine.read())){buffers.push(chunk);nread+=chunk.length}engine.once("readable",flow)}function onError(err){engine.removeListener("end",onEnd);engine.removeListener("readable",flow);callback(err)}function onEnd(){var buf;var err=null;if(nread>=kMaxLength){err=new RangeError(kRangeErrorMessage)}else{buf=Buffer.concat(buffers,nread)}buffers=[];engine.close();callback(err,buf)}}function zlibBufferSync(engine,buffer){if(typeof buffer==="string")buffer=Buffer.from(buffer);if(!Buffer.isBuffer(buffer))throw new TypeError("Not a string or buffer");var flushFlag=engine._finishFlushFlag;return engine._processChunk(buffer,flushFlag)}function Deflate(opts){if(!(this instanceof Deflate))return new Deflate(opts);Zlib.call(this,opts,binding.DEFLATE)}function Inflate(opts){if(!(this instanceof Inflate))return new Inflate(opts);Zlib.call(this,opts,binding.INFLATE)}function Gzip(opts){if(!(this instanceof Gzip))return new Gzip(opts);Zlib.call(this,opts,binding.GZIP)}function Gunzip(opts){if(!(this instanceof Gunzip))return new Gunzip(opts);Zlib.call(this,opts,binding.GUNZIP)}function DeflateRaw(opts){if(!(this instanceof DeflateRaw))return new DeflateRaw(opts);Zlib.call(this,opts,binding.DEFLATERAW)}function InflateRaw(opts){if(!(this instanceof InflateRaw))return new InflateRaw(opts);Zlib.call(this,opts,binding.INFLATERAW)}function Unzip(opts){if(!(this instanceof Unzip))return new Unzip(opts);Zlib.call(this,opts,binding.UNZIP)}function isValidFlushFlag(flag){return flag===binding.Z_NO_FLUSH||flag===binding.Z_PARTIAL_FLUSH||flag===binding.Z_SYNC_FLUSH||flag===binding.Z_FULL_FLUSH||flag===binding.Z_FINISH||flag===binding.Z_BLOCK}function Zlib(opts,mode){var _this=this;this._opts=opts=opts||{};this._chunkSize=opts.chunkSize||exports.Z_DEFAULT_CHUNK;Transform.call(this,opts);if(opts.flush&&!isValidFlushFlag(opts.flush)){throw new Error("Invalid flush flag: "+opts.flush)}if(opts.finishFlush&&!isValidFlushFlag(opts.finishFlush)){throw new Error("Invalid flush flag: "+opts.finishFlush)}this._flushFlag=opts.flush||binding.Z_NO_FLUSH;this._finishFlushFlag=typeof opts.finishFlush!=="undefined"?opts.finishFlush:binding.Z_FINISH;if(opts.chunkSize){if(opts.chunkSize<exports.Z_MIN_CHUNK||opts.chunkSize>exports.Z_MAX_CHUNK){throw new Error("Invalid chunk size: "+opts.chunkSize)}}if(opts.windowBits){if(opts.windowBits<exports.Z_MIN_WINDOWBITS||opts.windowBits>exports.Z_MAX_WINDOWBITS){throw new Error("Invalid windowBits: "+opts.windowBits)}}if(opts.level){if(opts.level<exports.Z_MIN_LEVEL||opts.level>exports.Z_MAX_LEVEL){throw new Error("Invalid compression level: "+opts.level)}}if(opts.memLevel){if(opts.memLevel<exports.Z_MIN_MEMLEVEL||opts.memLevel>exports.Z_MAX_MEMLEVEL){throw new Error("Invalid memLevel: "+opts.memLevel)}}if(opts.strategy){if(opts.strategy!=exports.Z_FILTERED&&opts.strategy!=exports.Z_HUFFMAN_ONLY&&opts.strategy!=exports.Z_RLE&&opts.strategy!=exports.Z_FIXED&&opts.strategy!=exports.Z_DEFAULT_STRATEGY){throw new Error("Invalid strategy: "+opts.strategy)}}if(opts.dictionary){if(!Buffer.isBuffer(opts.dictionary)){throw new Error("Invalid dictionary: it should be a Buffer instance")}}this._handle=new binding.Zlib(mode);var self=this;this._hadError=false;this._handle.onerror=function(message,errno){_close(self);self._hadError=true;var error=new Error(message);error.errno=errno;error.code=exports.codes[errno];self.emit("error",error)};var level=exports.Z_DEFAULT_COMPRESSION;if(typeof opts.level==="number")level=opts.level;var strategy=exports.Z_DEFAULT_STRATEGY;if(typeof opts.strategy==="number")strategy=opts.strategy;this._handle.init(opts.windowBits||exports.Z_DEFAULT_WINDOWBITS,level,opts.memLevel||exports.Z_DEFAULT_MEMLEVEL,strategy,opts.dictionary);this._buffer=Buffer.allocUnsafe(this._chunkSize);this._offset=0;this._level=level;this._strategy=strategy;this.once("end",this.close);Object.defineProperty(this,"_closed",{get:function(){return!_this._handle},configurable:true,enumerable:true})}util.inherits(Zlib,Transform);Zlib.prototype.params=function(level,strategy,callback){if(level<exports.Z_MIN_LEVEL||level>exports.Z_MAX_LEVEL){throw new RangeError("Invalid compression level: "+level)}if(strategy!=exports.Z_FILTERED&&strategy!=exports.Z_HUFFMAN_ONLY&&strategy!=exports.Z_RLE&&strategy!=exports.Z_FIXED&&strategy!=exports.Z_DEFAULT_STRATEGY){throw new TypeError("Invalid strategy: "+strategy)}if(this._level!==level||this._strategy!==strategy){var self=this;this.flush(binding.Z_SYNC_FLUSH,function(){assert(self._handle,"zlib binding closed");self._handle.params(level,strategy);if(!self._hadError){self._level=level;self._strategy=strategy;if(callback)callback()}})}else{process.nextTick(callback)}};Zlib.prototype.reset=function(){assert(this._handle,"zlib binding closed");return this._handle.reset()};Zlib.prototype._flush=function(callback){this._transform(Buffer.alloc(0),"",callback)};Zlib.prototype.flush=function(kind,callback){var _this2=this;var ws=this._writableState;if(typeof kind==="function"||kind===undefined&&!callback){callback=kind;kind=binding.Z_FULL_FLUSH}if(ws.ended){if(callback)process.nextTick(callback)}else if(ws.ending){if(callback)this.once("end",callback)}else if(ws.needDrain){if(callback){this.once("drain",function(){return _this2.flush(kind,callback)})}}else{this._flushFlag=kind;this.write(Buffer.alloc(0),"",callback)}};Zlib.prototype.close=function(callback){_close(this,callback);process.nextTick(emitCloseNT,this)};function _close(engine,callback){if(callback)process.nextTick(callback);if(!engine._handle)return;engine._handle.close();engine._handle=null}function emitCloseNT(self){self.emit("close")}Zlib.prototype._transform=function(chunk,encoding,cb){var flushFlag;var ws=this._writableState;var ending=ws.ending||ws.ended;var last=ending&&(!chunk||ws.length===chunk.length);if(chunk!==null&&!Buffer.isBuffer(chunk))return cb(new Error("invalid input"));if(!this._handle)return cb(new Error("zlib binding closed"));if(last)flushFlag=this._finishFlushFlag;else{flushFlag=this._flushFlag;if(chunk.length>=ws.length){this._flushFlag=this._opts.flush||binding.Z_NO_FLUSH}}this._processChunk(chunk,flushFlag,cb)};Zlib.prototype._processChunk=function(chunk,flushFlag,cb){var availInBefore=chunk&&chunk.length;var availOutBefore=this._chunkSize-this._offset;var inOff=0;var self=this;var async=typeof cb==="function";if(!async){var buffers=[];var nread=0;var error;this.on("error",function(er){error=er});assert(this._handle,"zlib binding closed");do{var res=this._handle.writeSync(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore)}while(!this._hadError&&callback(res[0],res[1]));if(this._hadError){throw error}if(nread>=kMaxLength){_close(this);throw new RangeError(kRangeErrorMessage)}var buf=Buffer.concat(buffers,nread);_close(this);return buf}assert(this._handle,"zlib binding closed");var req=this._handle.write(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore);req.buffer=chunk;req.callback=callback;function callback(availInAfter,availOutAfter){if(this){this.buffer=null;this.callback=null}if(self._hadError)return;var have=availOutBefore-availOutAfter;assert(have>=0,"have should not go down");if(have>0){var out=self._buffer.slice(self._offset,self._offset+have);self._offset+=have;if(async){self.push(out)}else{buffers.push(out);nread+=out.length}}if(availOutAfter===0||self._offset>=self._chunkSize){availOutBefore=self._chunkSize;self._offset=0;self._buffer=Buffer.allocUnsafe(self._chunkSize)}if(availOutAfter===0){inOff+=availInBefore-availInAfter;availInBefore=availInAfter;if(!async)return true;var newReq=self._handle.write(flushFlag,chunk,inOff,availInBefore,self._buffer,self._offset,self._chunkSize);newReq.callback=callback;newReq.buffer=chunk;return}if(!async)return false;cb()}};util.inherits(Deflate,Zlib);util.inherits(Inflate,Zlib);util.inherits(Gzip,Zlib);util.inherits(Gunzip,Zlib);util.inherits(DeflateRaw,Zlib);util.inherits(InflateRaw,Zlib);util.inherits(Unzip,Zlib)}).call(this,require("_process"))},{"./binding":7,_process:29,assert:3,buffer:9,stream:48,util:55}],9:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(isArrayBuffer(value)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(isArrayBufferView(obj)||"length"in obj){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(isArrayBufferView(string)||isArrayBuffer(string)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding);var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||obj!=null&&obj.constructor!=null&&obj.constructor.name==="ArrayBuffer"&&typeof obj.byteLength==="number"}function isArrayBufferView(obj){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}},{"base64-js":4,ieee754:12}],10:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":14}],11:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],12:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],13:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],14:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],15:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],16:[function(require,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(_has(source,p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],17:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],18:[function(require,module,exports){"use strict";module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],19:[function(require,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],20:[function(require,module,exports){"use strict";var utils=require("../utils/common");var trees=require("./trees");var adler32=require("./adler32");var crc32=require("./crc32");var msg=require("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out}if(len===0){return}utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0}}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255;s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size}if(len===0){return 0}strm.avail_in-=len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start)}else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start)}strm.next_in+=len;strm.total_in+=len;return len}function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2}if(nice_match>s.lookahead){nice_match=s.lookahead}do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue}scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break}scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len}return s.lookahead}function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(s.strm.avail_in===0){break}n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5}for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_NEED_MORE}function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}if(hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head)}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)){s.match_length=MIN_MATCH-1}}if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,false)}s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE}}else{s.match_available=1;s.strstart++;s.lookahead--}}if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead}}}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE}break}}s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func}var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR)}strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap}s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0:1;s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state)}return ret}function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR}if(strm.state.wrap!==2){return Z_STREAM_ERROR}strm.state.gzhead=head;return Z_OK}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR}var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6}if(windowBits<0){wrap=0;windowBits=-windowBits}else if(windowBits>15){wrap=2;windowBits-=16}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR)}if(windowBits===8){windowBits=9}var s=new DeflateState;strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<memLevel+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR}s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH){return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR)}s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&255);put_byte(s,s.gzhead.time>>8&255);put_byte(s,s.gzhead.time>>16&255);put_byte(s,s.gzhead.time>>24&255);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&255);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&255);put_byte(s,s.gzhead.extra.length>>8&255)}if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)}s.gzindex=0;s.status=EXTRA_STATE}}else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0}else if(s.level<6){level_flags=1}else if(s.level===6){level_flags=2}else{level_flags=3}header|=level_flags<<6;if(s.strstart!==0){header|=PRESET_DICT}header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}strm.adler=1}}if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&65535)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break}}put_byte(s,s.gzhead.extra[s.gzindex]&255);s.gzindex++}if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}else{s.status=NAME_STATE}}if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}else{s.status=COMMENT_STATE}}if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.status=HCRC_STATE}}else{s.status=HCRC_STATE}}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm)}if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);strm.adler=0;s.status=BUSY_STATE}}else{s.status=BUSY_STATE}}if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR)}if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR)}if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE}if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1}return Z_OK}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s)}else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}if(flush!==Z_FINISH){return Z_OK}if(s.wrap<=0){return Z_STREAM_END}if(s.wrap===2){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);put_byte(s,strm.adler>>16&255);put_byte(s,strm.adler>>24&255);put_byte(s,strm.total_in&255);put_byte(s,strm.total_in>>8&255);put_byte(s,strm.total_in>>16&255);put_byte(s,strm.total_in>>24&255)}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap}return s.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(strm){var status;if(!strm||!strm.state){return Z_STREAM_ERROR}status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR)}strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var s;var str,n;var wrap;var avail;var next;var input;var tmpDict;if(!strm||!strm.state){return Z_STREAM_ERROR}s=strm.state;wrap=s.wrap;if(wrap===2||wrap===1&&s.status!==INIT_STATE||s.lookahead){return Z_STREAM_ERROR}if(wrap===1){strm.adler=adler32(strm.adler,dictionary,dictLength,0)}s.wrap=0;if(dictLength>=s.w_size){if(wrap===0){zero(s.head);s.strstart=0;s.block_start=0;s.insert=0}tmpDict=new utils.Buf8(s.w_size);utils.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0);dictionary=tmpDict;dictLength=s.w_size}avail=strm.avail_in;next=strm.next_in;input=strm.input;strm.avail_in=dictLength;strm.next_in=0;strm.input=dictionary;fill_window(s);while(s.lookahead>=MIN_MATCH){str=s.strstart;n=s.lookahead-(MIN_MATCH-1);do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++}while(--n);s.strstart=str;s.lookahead=MIN_MATCH-1;fill_window(s)}s.strstart+=s.lookahead;s.block_start=s.strstart;s.insert=s.lookahead;s.lookahead=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;strm.next_in=next;strm.input=input;strm.avail_in=avail;s.wrap=wrap;return Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":16,"./adler32":17,"./crc32":19,"./messages":24,"./trees":25}],21:[function(require,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],22:[function(require,module,exports){"use strict";var utils=require("../utils/common");var adler32=require("./adler32");var crc32=require("./crc32");var inflate_fast=require("./inffast");var inflate_table=require("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR}if(state.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR}state.havedict=1;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":16,"./adler32":17,"./crc32":19,"./inffast":21,"./inftrees":23}],23:[function(require,module,exports){"use strict";var utils=require("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}for(;;){here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":16}],24:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],25:[function(require,module,exports){"use strict";var utils=require("../utils/common");var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length}var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255;s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&65535;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size}else{s.bi_buf|=value<<s.bi_valid&65535;s.bi_valid+=length}}function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&255;s.bi_buf>>=8;s.bi_valid-=8}}function gen_bitlen(s,desc){var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0}tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}tree[n*2+1]=bits;if(n>max_code){continue}s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base]}f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits)}}if(overflow===0){return}do{bits=max_length-1;while(s.bl_count[bits]===0){bits--}s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue}if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}n--}}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=code+bl_count[bits-1]<<1}for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue}tree[n*2]=bi_reverse(next_code[len]++,len)}}function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++){_length_code[length++]=code}}_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++){_dist_code[dist++]=code}}dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++){_dist_code[256+dist++]=code}}for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0}n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5)}static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]=0}for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]=0}for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]=0}s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}function bi_windup(s){if(s.bi_valid>8){put_short(s,s.bi_buf)}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf}s.bi_buf=0;s.bi_valid=0}function copy_block(s,buf,len,header){bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++}if(smaller(tree,v,s.heap[j],s.depth)){break}s.heap[k]=s.heap[j];k=j;j<<=1}s.heap[k]=v}function compress_block(s,ltree,dtree){var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree)}else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit)}send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else{tree[n*2+1]=0}}while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]}}desc.max_code=max_code;for(n=s.heap_len>>1;n>=1;n--){pqdownheap(s,tree,n)}node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}tree[(max_code+1)*2+1]=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){s.bl_tree[curlen*2]+=count}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++}s.bl_tree[REP_3_6*2]++}else if(count<=10){s.bl_tree[REPZ_3_10*2]++}else{s.bl_tree[REPZ_11_138*2]++}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function send_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){do{send_code(s,curlen,s.bl_tree)}while(--count!==0)}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break}}s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3)}send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447;var n;for(n=0;n<=31;n++,black_mask>>>=1){if(black_mask&1&&s.dyn_ltree[n*2]!==0){return Z_BINARY}}if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT}for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT}}return Z_BINARY}var static_init_done=false;function _tr_init(s){if(!static_init_done){tr_static_init();static_init_done=true}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s)}build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb}}else{opt_lenb=static_lenb=stored_len+5}if(stored_len+4<=opt_lenb&&buf!==-1){_tr_stored_block(s,buf,stored_len,last)}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}init_block(s);if(last){bi_windup(s)}}function _tr_tally(s,dist,lc){s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255;s.pending_buf[s.l_buf+s.last_lit]=lc&255;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;s.dyn_dtree[d_code(dist)*2]++}return s.last_lit===s.lit_bufsize-1}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":16}],26:[function(require,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}],27:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:29}],28:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:29}],29:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],30:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=="object"&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],32:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],33:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":31,"./encode":32}],34:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":35}],35:[function(require,module,exports){"use strict";var processNextTick=require("process-nextick-args");var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){if(this._readableState===undefined||this._writableState===undefined){return false}return this._readableState.destroyed&&this._writableState.destroyed},set:function(value){if(this._readableState===undefined||this._writableState===undefined){return}this._readableState.destroyed=value;this._writableState.destroyed=value}});Duplex.prototype._destroy=function(err,cb){this.push(null);this.end();processNextTick(cb,err)};function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":37,"./_stream_writable":39,"core-util-is":10,inherits:13,"process-nextick-args":28}],36:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":38,"core-util-is":10,inherits:13}],37:[function(require,module,exports){(function(process,global){"use strict";var processNextTick=require("process-nextick-args");module.exports=Readable;var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("./internal/streams/stream");var Buffer=require("safe-buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var destroyImpl=require("./internal/streams/destroy");var StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.destroyed=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options){if(typeof options.read==="function")this._read=options.read;if(typeof options.destroy==="function")this._destroy=options.destroy}Stream.call(this)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){if(this._readableState===undefined){return false}return this._readableState.destroyed},set:function(value){if(!this._readableState){return}this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){this.push(null);cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=""}skipChunkCheck=true}}else{skipChunkCheck=true}return readableAddChunk(this,chunk,encoding,false,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,true,false)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(chunk===null){state.reading=false;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=="string"&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}if(addToFront){if(state.endEmitted)stream.emit("error",new Error("stream.unshift() after end event"));else addChunk(stream,state,chunk,true)}else if(state.ended){stream.emit("error",new Error("stream.push() after EOF"))}else{state.reading=false;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,false);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,false)}}}else if(!addToFront){state.reading=false}}return needMoreData(state)}function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.isPaused=function(){return this._readableState.flowing===false};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable,unpipeInfo){debug("onunpipe");if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===false){unpipeInfo.hasUnpiped=true;cleanup()}}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",unpipe);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:false};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this,unpipeInfo);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this,unpipeInfo)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]))}self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":35,"./internal/streams/BufferList":40,"./internal/streams/destroy":41,"./internal/streams/stream":42,_process:29,"core-util-is":10,events:11,inherits:13,isarray:15,"process-nextick-args":28,"safe-buffer":47,"string_decoder/":49,util:5}],38:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb){return stream.emit("error",new Error("write callback called multiple times"))}ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};Transform.prototype._destroy=function(err,cb){var _this=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2);_this.emit("close")})};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":35,"core-util-is":10,inherits:13}],39:[function(require,module,exports){(function(process,global){"use strict";var processNextTick=require("process-nextick-args");module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream=require("./internal/streams/stream");var Buffer=require("safe-buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var destroyImpl=require("./internal/streams/destroy");util.inherits(Writable,Stream);function nop(){}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=false;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;this.destroyed=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev;if(typeof options.destroy==="function")this._destroy=options.destroy;if(typeof options.final==="function")this._final=options.final}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;var isBuf=_isUint8Array(chunk)&&!state.objectMode;if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}if(typeof encoding==="function"){cb=encoding;encoding=null}if(isBuf)encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=Buffer.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=true;encoding="buffer";chunk=newChunk}}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){processNextTick(cb,er);processNextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=true;stream.emit("error",er)}else{cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er);finishMaybe(stream,state)}}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=true;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=false;entry=entry.next;count+=1}buffer.allBuffers=allBuffers;doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit("error",err)}state.prefinished=true;stream.emit("prefinish");finishMaybe(stream,state)})}function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==="function"){state.pendingcb++;state.finalCalled=true;processNextTick(callFinal,stream,state)}else{state.prefinished=true;stream.emit("prefinish")}}}function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=true;stream.emit("finish")}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=corkReq}else{state.corkedRequestsFree=corkReq}}Object.defineProperty(Writable.prototype,"destroyed",{get:function(){if(this._writableState===undefined){return false}return this._writableState.destroyed},set:function(value){if(!this._writableState){return}this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){this.end();cb(err)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":35,"./internal/streams/destroy":41,"./internal/streams/stream":42,_process:29,"core-util-is":10,inherits:13,"process-nextick-args":28,"safe-buffer":47,"util-deprecate":52}],40:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Buffer=require("safe-buffer").Buffer;function copyBuffer(src,target,offset){src.copy(target,offset)}module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function clear(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function join(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);if(this.length===1)return this.head.data;var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}return ret};return BufferList}()},{"safe-buffer":47}],41:[function(require,module,exports){"use strict";var processNextTick=require("process-nextick-args");function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){processNextTick(emitErrorNT,this,err)}return}if(this._readableState){this._readableState.destroyed=true}if(this._writableState){this._writableState.destroyed=true}this._destroy(err||null,function(err){if(!cb&&err){processNextTick(emitErrorNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=true}}else if(cb){cb(err)}})}function undestroy(){if(this._readableState){this._readableState.destroyed=false;this._readableState.reading=false;this._readableState.ended=false;this._readableState.endEmitted=false}if(this._writableState){this._writableState.destroyed=false;this._writableState.ended=false;this._writableState.ending=false;this._writableState.finished=false;this._writableState.errorEmitted=false}}function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:destroy,undestroy:undestroy}},{"process-nextick-args":28}],42:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:11}],43:[function(require,module,exports){module.exports=require("./readable").PassThrough},{"./readable":44}],44:[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":35,"./lib/_stream_passthrough.js":36,"./lib/_stream_readable.js":37,"./lib/_stream_transform.js":38,"./lib/_stream_writable.js":39}],45:[function(require,module,exports){module.exports=require("./readable").Transform},{"./readable":44}],46:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":39}],47:[function(require,module,exports){var buffer=require("buffer");var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return buffer.SlowBuffer(size)}},{buffer:9}],48:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:11,inherits:13,"readable-stream/duplex.js":34,"readable-stream/passthrough.js":43,"readable-stream/readable.js":44,"readable-stream/transform.js":45,"readable-stream/writable.js":46}],49:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=""+encoding;switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function _normalizeEncoding(enc){if(!enc)return"utf8";var retried;while(true){switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase();retried=true}}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=="string"&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text;this.end=utf16End;nb=4;break;case"utf8":this.fillLast=utf8FillLast;nb=4;break;case"base64":this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb)}StringDecoder.prototype.write=function(buf){if(buf.length===0)return"";var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return"";i=this.lastNeed;this.lastNeed=0}else{i=0}if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=127)return 0;else if(byte>>5===6)return 2;else if(byte>>4===14)return 3;else if(byte>>3===30)return 4;return-1}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}if(--j<i)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}if(--j<i)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}return nb}return 0}function utf8CheckExtraBytes(self,buf,p){if((buf[0]&192)!==128){self.lastNeed=0;return"�".repeat(p)}if(self.lastNeed>1&&buf.length>1){if((buf[1]&192)!==128){self.lastNeed=1;return"�".repeat(p+1)}if(self.lastNeed>2&&buf.length>2){if((buf[2]&192)!==128){self.lastNeed=2;return"�".repeat(p+2)}}}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+"�".repeat(this.lastTotal-this.lastNeed);return r}function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}return r}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString("base64",i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}return buf.toString("base64",i,buf.length-n)}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+this.lastChar.toString("base64",0,3-this.lastNeed);return r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}},{"safe-buffer":47}],50:[function(require,module,exports){"use strict";var punycode=require("punycode");var util=require("./util");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/");url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=="protocol")result[rkey]=relative[rkey]}if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}},{"./util":51,punycode:30,querystring:33}],51:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return typeof arg==="string"},isObject:function(arg){return typeof arg==="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}},{}],52:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],53:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{dup:13}],54:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],55:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":54,_process:29,inherits:53}],56:[function(require,module,exports){module.exports={name:"eyes.images",version:"1.0.0",description:"Applitools Eyes Javascript SDK for working directly with images.",author:"Applitools Team <team@applitools.com> (http://www.applitools.com/)",keywords:["eyes.images","Test Automation","Visual Regression","tests","SDK","Applitools","Eyes","automation","testing"],homepage:"http://www.applitools.com/",repository:{type:"git",url:"git://github.com/applitools/eyes.images.javascript.git"},license:"Apache-2.0",main:"index",scripts:{browserify:"browserify eyes-browser-loader.js > dist/eyes-browser.js",uglify:"uglifyjs dist/eyes-browser.js > dist/eyes-browser.min.js",build:"npm run browserify && npm run uglify"},dependencies:{"eyes.sdk":"1.0.0"},devDependencies:{browserify:"^14.5.0","uglify-es":"^3.1.9"},browser:{rsvp:false},engines:{node:">= 6.9.0"}}},{}],57:[function(require,module,exports){"use strict";const{ArgumentGuard:ArgumentGuard,GeneralUtils:GeneralUtils,EyesBase:EyesBase,RegionProvider:RegionProvider,MutableImage:MutableImage,RectangleSize:RectangleSize,NullRegionProvider:NullRegionProvider,CheckSettings:CheckSettings}=require("eyes.sdk");const EyesImagesScreenshot=require("./EyesImagesScreenshot");const VERSION=require("../package.json").version;class Eyes extends EyesBase{constructor(serverUrl,promiseFactory){super(serverUrl,promiseFactory);this._title=undefined;this._screenshot=undefined;this._inferred=""}getBaseAgentId(){return"eyes.images/"+VERSION}open(appName,testName,imageSize){return super.openBase(appName,testName,imageSize,null)}checkImage(image,tag,ignoreMismatch,retryTimeout){if(this.getIsDisabled()){this._logger.verbose(`CheckImage(Image, '${tag}', '${ignoreMismatch}', '${retryTimeout}'): Ignored`);return this._promiseFactory.resolve(false)}ArgumentGuard.notNull(image,"image cannot be null!");this._logger.verbose(`checkImage(Image, '${tag}', '${ignoreMismatch}', '${retryTimeout}')`);return this._checkImage(new NullRegionProvider(this.getPromiseFactory()),image,tag,ignoreMismatch,retryTimeout)}checkRegion(image,region,tag,ignoreMismatch,retryTimeout){if(this.getIsDisabled()){this._logger.verbose(`checkRegion(Image, [${region}], '${tag}', '${ignoreMismatch}', '${retryTimeout}'): Ignored`);return this._promiseFactory.resolve(false)}ArgumentGuard.notNull(image,"image cannot be null!");ArgumentGuard.notNull(region,"region cannot be null!");this._logger.verbose(`checkRegion(Image, [${region}], '${tag}', '${ignoreMismatch}', '${retryTimeout}')`);return this._checkImage(new RegionProvider(region,this.getPromiseFactory()),image,tag,ignoreMismatch,retryTimeout)}replaceImage(stepIndex,image,tag,title,userInputs){if(this.getIsDisabled()){this._logger.verbose(`replaceImage('${stepIndex}', Image, '${tag}', '${title}', '${userInputs}'): Ignored`);return this._promiseFactory.resolve(false)}ArgumentGuard.notNull(image,"image cannot be null!");ArgumentGuard.notNull(stepIndex,"stepIndex cannot be null!");image=this._normalizeImageType(image);this._logger.verbose(`replaceImage('${stepIndex}', Image, '${tag}', '${title}', '${userInputs}')`);return super.replaceWindow(stepIndex,image,tag,title,userInputs).then(results=>{return results.getAsExpected()})}addMouseTrigger(action,control,cursor){super.addMouseTriggerBase(action,control,cursor)}addTextTrigger(control,text){super.addTextTriggerBase(control,text)}getAUTSessionId(){return this._promiseFactory.resolve(undefined)}getViewportSize(){return this._promiseFactory.resolve(this._viewportSizeHandler.get())}setViewportSize(viewportSize){ArgumentGuard.notNull(viewportSize,"size");this._viewportSizeHandler.set(new RectangleSize(viewportSize));return this._promiseFactory.resolve()}getInferredEnvironment(){return this._promiseFactory.resolve(this._inferred)}setInferredEnvironment(inferred){this._inferred=inferred}getScreenshot(){return this._promiseFactory.resolve(this._screenshot)}getTitle(){return this._promiseFactory.resolve(this._title)}_checkImage(regionProvider,image,tag,ignoreMismatch,retryTimeout){image=this._normalizeImageType(image);if(!this._viewportSizeHandler.get()){this._viewportSize=new RectangleSize(image.getSize())}this._screenshot=new EyesImagesScreenshot(image);this._title=tag||"";return super.checkWindowBase(regionProvider,tag,ignoreMismatch,new CheckSettings(retryTimeout)).then(results=>{return results.getAsExpected()})}_normalizeImageType(image){if(image instanceof MutableImage){return image}else if(GeneralUtils.isBuffer(image)||GeneralUtils.isString(image)){return new MutableImage(image,this._promiseFactory)}throw new TypeError("unsupported type of image!")}}module.exports=Eyes},{"../package.json":56,"./EyesImagesScreenshot":58,"eyes.sdk":59}],58:[function(require,module,exports){"use strict";const{EyesScreenshot:EyesScreenshot,Region:Region,RectangleSize:RectangleSize,Location:Location,CoordinatesType:CoordinatesType,ArgumentGuard:ArgumentGuard,CoordinatesTypeConversionError:CoordinatesTypeConversionError,OutOfBoundsError:OutOfBoundsError}=require("eyes.sdk");class EyesImagesScreenshot extends EyesScreenshot{constructor(image,location=new Location(0,0)){super(image);this._bounds=new Region(location,new RectangleSize(image.getWidth(),image.getHeight()))}getSubScreenshot(region,throwIfClipped){ArgumentGuard.notNull(region,"region");const subScreenshotRegion=this.getIntersectedRegion(region,region.getCoordinatesType(),CoordinatesType.SCREENSHOT_AS_IS);if(subScreenshotRegion.isEmpty()||throwIfClipped&&!subScreenshotRegion.getSize().equals(region.getSize())){throw new OutOfBoundsError(`Region [${region}] is out of screenshot bounds [${this._bounds}]`)}const that=this;return this._image.getImagePart(subScreenshotRegion).then(subScreenshotImage=>{const relativeSubScreenshotRegion=that.convertRegionLocation(subScreenshotRegion,CoordinatesType.SCREENSHOT_AS_IS,CoordinatesType.CONTEXT_RELATIVE);return new EyesImagesScreenshot(subScreenshotImage,relativeSubScreenshotRegion.getLocation())})}convertLocation(location,from,to){ArgumentGuard.notNull(location,"location");ArgumentGuard.notNull(from,"from");ArgumentGuard.notNull(to,"to");const result=new Location(location);if(from===to){return result}switch(from){case CoordinatesType.SCREENSHOT_AS_IS:if(to===CoordinatesType.CONTEXT_RELATIVE){result.offset(this._bounds.getLeft(),this._bounds.getTop())}else{throw new CoordinatesTypeConversionError(from,to)}break;case CoordinatesType.CONTEXT_RELATIVE:if(to===CoordinatesType.SCREENSHOT_AS_IS){result.offset(-this._bounds.getLeft(),-this._bounds.getTop())}else{throw new CoordinatesTypeConversionError(from,to)}break;default:throw new CoordinatesTypeConversionError(from,to)}return result}getLocationInScreenshot(location,coordinatesType){ArgumentGuard.notNull(location,"location");ArgumentGuard.notNull(coordinatesType,"coordinatesType");location=this.convertLocation(location,coordinatesType,CoordinatesType.CONTEXT_RELATIVE);if(!this._bounds.contains(location)){throw new OutOfBoundsError(`Location ${location} ('${coordinatesType}') is not visible in screenshot!`)}return this.convertLocation(location,CoordinatesType.CONTEXT_RELATIVE,CoordinatesType.SCREENSHOT_AS_IS)}getIntersectedRegion(region,originalCoordinatesType,resultCoordinatesType){ArgumentGuard.notNull(region,"region");ArgumentGuard.notNull(originalCoordinatesType,"coordinatesType");if(region.isEmpty()){return new Region(region)}const intersectedRegion=this.convertRegionLocation(region,originalCoordinatesType,CoordinatesType.CONTEXT_RELATIVE);intersectedRegion.intersect(this._bounds);if(region.isEmpty()){return region}intersectedRegion.setLocation(this.convertLocation(intersectedRegion.getLocation(),CoordinatesType.CONTEXT_RELATIVE,resultCoordinatesType));return intersectedRegion}}module.exports=EyesImagesScreenshot},{"eyes.sdk":59}],59:[function(require,module,exports){exports.AppOutput=require("./src/capture/AppOutput");exports.AppOutputProvider=require("./src/capture/AppOutputProvider");exports.AppOutputWithScreenshot=require("./src/capture/AppOutputWithScreenshot");exports.EyesScreenshotFactory=require("./src/capture/EyesScreenshotFactory");exports.ImageProvider=require("./src/capture/ImageProvider");exports.CutProvider=require("./src/cutting/CutProvider");exports.FixedCutProvider=require("./src/cutting/FixedCutProvider");exports.NullCutProvider=require("./src/cutting/NullCutProvider");exports.UnscaledFixedCutProvider=require("./src/cutting/UnscaledFixedCutProvider");exports.DebugScreenshotsProvider=require("./src/debug/DebugScreenshotsProvider");exports.FileDebugScreenshotsProvider=require("./src/debug/FileDebugScreenshotsProvider");exports.NullDebugScreenshotProvider=require("./src/debug/NullDebugScreenshotProvider");exports.CoordinatesTypeConversionError=require("./src/errors/CoordinatesTypeConversionError");exports.DiffsFoundError=require("./src/errors/DiffsFoundError");exports.EyesError=require("./src/errors/EyesError");exports.NewTestError=require("./src/errors/NewTestError");exports.OutOfBoundsError=require("./src/errors/OutOfBoundsError");exports.TestFailedError=require("./src/errors/TestFailedError");exports.CheckSettings=require("./src/fluent/CheckSettings");exports.CheckTarget=require("./src/fluent/CheckTarget");exports.FloatingRegionByRectangle=require("./src/fluent/FloatingRegionByRectangle");exports.GetFloatingRegion=require("./src/fluent/GetFloatingRegion");exports.GetRegion=require("./src/fluent/GetRegion");exports.IgnoreRegionByRectangle=require("./src/fluent/IgnoreRegionByRectangle");exports.PropertyHandler=require("./src/handlers/PropertyHandler");exports.ReadOnlyPropertyHandler=require("./src/handlers/ReadOnlyPropertyHandler");exports.SimplePropertyHandler=require("./src/handlers/SimplePropertyHandler");exports.EyesScreenshot=require("./src/images/EyesScreenshot");exports.ImageDeltaCompressor=require("./src/images/ImageDeltaCompressor");exports.ImageUtils=require("./src/images/ImageUtils");exports.MutableImage=require("./src/images/MutableImage");exports.ConsoleLogHandler=require("./src/logging/ConsoleLogHandler");exports.FileLogHandler=require("./src/logging/FileLogHandler");exports.Logger=require("./src/logging/Logger");exports.LogHandler=require("./src/logging/LogHandler");exports.NullLogHandler=require("./src/logging/NullLogHandler");exports.ExactMatchSettings=require("./src/match/ExactMatchSettings");exports.ImageMatchSettings=require("./src/match/ImageMatchSettings");exports.MatchLevel=require("./src/match/MatchLevel");exports.MatchWindowData=require("./src/match/MatchWindowData");exports.MatchWindowDataWithScreenshot=require("./src/match/MatchWindowDataWithScreenshot");exports.CoordinatesType=require("./src/positioning/CoordinatesType");exports.FloatingMatchSettings=require("./src/positioning/FloatingMatchSettings");exports.InvalidPositionProvider=require("./src/positioning/InvalidPositionProvider");exports.Location=require("./src/positioning/Location");exports.PositionMemento=require("./src/positioning/PositionMemento");exports.NullRegionProvider=require("./src/positioning/NullRegionProvider");exports.PositionProvider=require("./src/positioning/PositionProvider");exports.RectangleSize=require("./src/positioning/RectangleSize");exports.Region=require("./src/positioning/Region");exports.RegionProvider=require("./src/positioning/RegionProvider");exports.ContextBasedScaleProvider=require("./src/scaling/ContextBasedScaleProvider");exports.ContextBasedScaleProviderFactory=require("./src/scaling/ContextBasedScaleProviderFactory");exports.FixedScaleProvider=require("./src/scaling/FixedScaleProvider");exports.FixedScaleProviderFactory=require("./src/scaling/FixedScaleProviderFactory");exports.NullScaleProvider=require("./src/scaling/NullScaleProvider");exports.ScaleProvider=require("./src/scaling/ScaleProvider");exports.ScaleProviderFactory=require("./src/scaling/ScaleProviderFactory");exports.ScaleProviderIdentityFactory=require("./src/scaling/ScaleProviderIdentityFactory");exports.MatchResult=require("./src/server/MatchResult");exports.PropertyData=require("./src/server/PropertyData");exports.ProxySettings=require("./src/server/ProxySettings");exports.RunningSession=require("./src/server/RunningSession");exports.ServerConnector=require("./src/server/ServerConnector");exports.SessionStartInfo=require("./src/server/SessionStartInfo");exports.SessionType=require("./src/server/SessionType");exports.TestResults=require("./src/server/TestResults");exports.TestResultsStatus=require("./src/server/TestResultsStatus");exports.MouseTrigger=require("./src/triggers/MouseTrigger");exports.TextTrigger=require("./src/triggers/TextTrigger");exports.Trigger=require("./src/triggers/Trigger");exports.AppEnvironment=require("./src/AppEnvironment");exports.ArgumentGuard=require("./src/ArgumentGuard");exports.BatchInfo=require("./src/BatchInfo");exports.BrowserNames=require("./src/BrowserNames");exports.EyesBase=require("./src/EyesBase");exports.EyesJsExecutor=require("./src/EyesJsExecutor");exports.FailureReports=require("./src/FailureReports");exports.GeneralUtils=require("./src/GeneralUtils");exports.MatchWindowTask=require("./src/MatchWindowTask");exports.OSNames=require("./src/OSNames");exports.PromiseFactory=require("./src/PromiseFactory");exports.RemoteSessionEventHandler=require("./src/RemoteSessionEventHandler");exports.SessionEventHandler=require("./src/SessionEventHandler");exports.StreamUtils=require("./src/StreamUtils");exports.UserAgent=require("./src/UserAgent")},{"./src/AppEnvironment":95,"./src/ArgumentGuard":96,"./src/BatchInfo":97,"./src/BrowserNames":98,"./src/EyesBase":99,"./src/EyesJsExecutor":100,"./src/FailureReports":101,"./src/GeneralUtils":102,"./src/MatchWindowTask":103,"./src/OSNames":104,"./src/PromiseFactory":105,"./src/RemoteSessionEventHandler":106,"./src/SessionEventHandler":107,"./src/StreamUtils":108,"./src/UserAgent":109,"./src/capture/AppOutput":110,"./src/capture/AppOutputProvider":111,"./src/capture/AppOutputWithScreenshot":112,"./src/capture/EyesScreenshotFactory":113,"./src/capture/ImageProvider":114,"./src/cutting/CutProvider":115,"./src/cutting/FixedCutProvider":116,"./src/cutting/NullCutProvider":117,"./src/cutting/UnscaledFixedCutProvider":118,"./src/debug/DebugScreenshotsProvider":119,"./src/debug/FileDebugScreenshotsProvider":120,"./src/debug/NullDebugScreenshotProvider":121,"./src/errors/CoordinatesTypeConversionError":122,"./src/errors/DiffsFoundError":123,"./src/errors/EyesError":124,"./src/errors/NewTestError":125,"./src/errors/OutOfBoundsError":126,"./src/errors/TestFailedError":127,"./src/fluent/CheckSettings":128,"./src/fluent/CheckTarget":129,"./src/fluent/FloatingRegionByRectangle":130,"./src/fluent/GetFloatingRegion":131,"./src/fluent/GetRegion":132,"./src/fluent/IgnoreRegionByRectangle":133,"./src/handlers/PropertyHandler":134,"./src/handlers/ReadOnlyPropertyHandler":135,"./src/handlers/SimplePropertyHandler":136,"./src/images/EyesScreenshot":137,"./src/images/ImageDeltaCompressor":138,"./src/images/ImageUtils":139,"./src/images/MutableImage":140,"./src/logging/ConsoleLogHandler":141,"./src/logging/FileLogHandler":142,"./src/logging/LogHandler":143,"./src/logging/Logger":144,"./src/logging/NullLogHandler":145,"./src/match/ExactMatchSettings":146,"./src/match/ImageMatchSettings":147,"./src/match/MatchLevel":148,"./src/match/MatchWindowData":149,"./src/match/MatchWindowDataWithScreenshot":150,"./src/positioning/CoordinatesType":151,"./src/positioning/FloatingMatchSettings":152,"./src/positioning/InvalidPositionProvider":153,"./src/positioning/Location":154,"./src/positioning/NullRegionProvider":155,"./src/positioning/PositionMemento":156,"./src/positioning/PositionProvider":157,"./src/positioning/RectangleSize":158,"./src/positioning/Region":159,"./src/positioning/RegionProvider":160,"./src/scaling/ContextBasedScaleProvider":161,"./src/scaling/ContextBasedScaleProviderFactory":162,"./src/scaling/FixedScaleProvider":163,"./src/scaling/FixedScaleProviderFactory":164,"./src/scaling/NullScaleProvider":165,"./src/scaling/ScaleProvider":166,"./src/scaling/ScaleProviderFactory":167,"./src/scaling/ScaleProviderIdentityFactory":168,"./src/server/MatchResult":169,"./src/server/PropertyData":170,"./src/server/ProxySettings":171,"./src/server/RunningSession":172,"./src/server/ServerConnector":173,"./src/server/SessionStartInfo":174,"./src/server/SessionType":175,"./src/server/TestResults":176,"./src/server/TestResultsStatus":177,"./src/triggers/MouseTrigger":178,"./src/triggers/TextTrigger":179,"./src/triggers/Trigger":180}],60:[function(require,module,exports){module.exports=require("./lib/axios")},{"./lib/axios":62}],61:[function(require,module,exports){(function(process){"use strict";var utils=require("./../utils");var settle=require("./../core/settle");var buildURL=require("./../helpers/buildURL");var parseHeaders=require("./../helpers/parseHeaders");var isURLSameOrigin=require("./../helpers/isURLSameOrigin");var createError=require("../core/createError");var btoa=typeof window!=="undefined"&&window.btoa&&window.btoa.bind(window)||require("./../helpers/btoa");module.exports=function xhrAdapter(config){return new Promise(function dispatchXhrRequest(resolve,reject){var requestData=config.data;var requestHeaders=config.headers;if(utils.isFormData(requestData)){delete requestHeaders["Content-Type"]}var request=new XMLHttpRequest;var loadEvent="onreadystatechange";var xDomain=false;if(process.env.NODE_ENV!=="test"&&typeof window!=="undefined"&&window.XDomainRequest&&!("withCredentials"in request)&&!isURLSameOrigin(config.url)){request=new window.XDomainRequest;loadEvent="onload";xDomain=true;request.onprogress=function handleProgress(){};request.ontimeout=function handleTimeout(){}}if(config.auth){var username=config.auth.username||"";var password=config.auth.password||"";requestHeaders.Authorization="Basic "+btoa(username+":"+password)}request.open(config.method.toUpperCase(),buildURL(config.url,config.params,config.paramsSerializer),true);request.timeout=config.timeout;request[loadEvent]=function handleLoad(){if(!request||request.readyState!==4&&!xDomain){return}if(request.status===0&&!(request.responseURL&&request.responseURL.indexOf("file:")===0)){return}var responseHeaders="getAllResponseHeaders"in request?parseHeaders(request.getAllResponseHeaders()):null;var responseData=!config.responseType||config.responseType==="text"?request.responseText:request.response;var response={data:responseData,status:request.status===1223?204:request.status,statusText:request.status===1223?"No Content":request.statusText,headers:responseHeaders,config:config,request:request};settle(resolve,reject,response);request=null};request.onerror=function handleError(){reject(createError("Network Error",config,null,request));request=null};request.ontimeout=function handleTimeout(){reject(createError("timeout of "+config.timeout+"ms exceeded",config,"ECONNABORTED",request));request=null};if(utils.isStandardBrowserEnv()){var cookies=require("./../helpers/cookies");var xsrfValue=(config.withCredentials||isURLSameOrigin(config.url))&&config.xsrfCookieName?cookies.read(config.xsrfCookieName):undefined;if(xsrfValue){requestHeaders[config.xsrfHeaderName]=xsrfValue}}if("setRequestHeader"in request){utils.forEach(requestHeaders,function setRequestHeader(val,key){if(typeof requestData==="undefined"&&key.toLowerCase()==="content-type"){delete requestHeaders[key]}else{request.setRequestHeader(key,val)}})}if(config.withCredentials){request.withCredentials=true}if(config.responseType){try{request.responseType=config.responseType}catch(e){if(config.responseType!=="json"){throw e}}}if(typeof config.onDownloadProgress==="function"){request.addEventListener("progress",config.onDownloadProgress)}if(typeof config.onUploadProgress==="function"&&request.upload){request.upload.addEventListener("progress",config.onUploadProgress)}if(config.cancelToken){config.cancelToken.promise.then(function onCanceled(cancel){if(!request){return}request.abort();reject(cancel);request=null})}if(requestData===undefined){requestData=null}request.send(requestData)})}}).call(this,require("_process"))},{"../core/createError":68,"./../core/settle":71,"./../helpers/btoa":75,"./../helpers/buildURL":76,"./../helpers/cookies":78,"./../helpers/isURLSameOrigin":80,"./../helpers/parseHeaders":82,"./../utils":84,_process:29}],62:[function(require,module,exports){"use strict";var utils=require("./utils");var bind=require("./helpers/bind");var Axios=require("./core/Axios");var defaults=require("./defaults");function createInstance(defaultConfig){var context=new Axios(defaultConfig);var instance=bind(Axios.prototype.request,context);utils.extend(instance,Axios.prototype,context);utils.extend(instance,context);return instance}var axios=createInstance(defaults);axios.Axios=Axios;axios.create=function create(instanceConfig){return createInstance(utils.merge(defaults,instanceConfig))};axios.Cancel=require("./cancel/Cancel");axios.CancelToken=require("./cancel/CancelToken");axios.isCancel=require("./cancel/isCancel");axios.all=function all(promises){return Promise.all(promises)};axios.spread=require("./helpers/spread");module.exports=axios;module.exports.default=axios},{"./cancel/Cancel":63,"./cancel/CancelToken":64,"./cancel/isCancel":65,"./core/Axios":66,"./defaults":73,"./helpers/bind":74,"./helpers/spread":83,"./utils":84}],63:[function(require,module,exports){"use strict";function Cancel(message){this.message=message}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")};Cancel.prototype.__CANCEL__=true;module.exports=Cancel},{}],64:[function(require,module,exports){"use strict";var Cancel=require("./Cancel");function CancelToken(executor){if(typeof executor!=="function"){throw new TypeError("executor must be a function.")}var resolvePromise;this.promise=new Promise(function promiseExecutor(resolve){resolvePromise=resolve});var token=this;executor(function cancel(message){if(token.reason){return}token.reason=new Cancel(message);resolvePromise(token.reason)})}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason){throw this.reason}};CancelToken.source=function source(){var cancel;var token=new CancelToken(function executor(c){cancel=c});return{token:token,cancel:cancel}};module.exports=CancelToken},{"./Cancel":63}],65:[function(require,module,exports){"use strict";module.exports=function isCancel(value){return!!(value&&value.__CANCEL__)}},{}],66:[function(require,module,exports){"use strict";var defaults=require("./../defaults");var utils=require("./../utils");var InterceptorManager=require("./InterceptorManager");var dispatchRequest=require("./dispatchRequest");function Axios(instanceConfig){this.defaults=instanceConfig;this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios.prototype.request=function request(config){if(typeof config==="string"){config=utils.merge({url:arguments[0]},arguments[1])}config=utils.merge(defaults,this.defaults,{method:"get"},config);config.method=config.method.toLowerCase();var chain=[dispatchRequest,undefined];var promise=Promise.resolve(config);this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor){chain.unshift(interceptor.fulfilled,interceptor.rejected)});this.interceptors.response.forEach(function pushResponseInterceptors(interceptor){chain.push(interceptor.fulfilled,interceptor.rejected)});while(chain.length){promise=promise.then(chain.shift(),chain.shift())}return promise};utils.forEach(["delete","get","head","options"],function forEachMethodNoData(method){Axios.prototype[method]=function(url,config){return this.request(utils.merge(config||{},{method:method,url:url}))}});utils.forEach(["post","put","patch"],function forEachMethodWithData(method){Axios.prototype[method]=function(url,data,config){return this.request(utils.merge(config||{},{method:method,url:url,data:data}))}});module.exports=Axios},{"./../defaults":73,"./../utils":84,"./InterceptorManager":67,"./dispatchRequest":69}],67:[function(require,module,exports){"use strict";var utils=require("./../utils");function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(fulfilled,rejected){this.handlers.push({fulfilled:fulfilled,rejected:rejected});return this.handlers.length-1};InterceptorManager.prototype.eject=function eject(id){if(this.handlers[id]){this.handlers[id]=null}};InterceptorManager.prototype.forEach=function forEach(fn){utils.forEach(this.handlers,function forEachHandler(h){if(h!==null){fn(h)}})};module.exports=InterceptorManager},{"./../utils":84}],68:[function(require,module,exports){"use strict";var enhanceError=require("./enhanceError");module.exports=function createError(message,config,code,request,response){var error=new Error(message);return enhanceError(error,config,code,request,response)}},{"./enhanceError":70}],69:[function(require,module,exports){"use strict";var utils=require("./../utils");var transformData=require("./transformData");var isCancel=require("../cancel/isCancel");var defaults=require("../defaults");var isAbsoluteURL=require("./../helpers/isAbsoluteURL");var combineURLs=require("./../helpers/combineURLs");function throwIfCancellationRequested(config){if(config.cancelToken){config.cancelToken.throwIfRequested()}}module.exports=function dispatchRequest(config){throwIfCancellationRequested(config);if(config.baseURL&&!isAbsoluteURL(config.url)){config.url=combineURLs(config.baseURL,config.url)}config.headers=config.headers||{};config.data=transformData(config.data,config.headers,config.transformRequest);config.headers=utils.merge(config.headers.common||{},config.headers[config.method]||{},config.headers||{});utils.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(method){delete config.headers[method]});var adapter=config.adapter||defaults.adapter;return adapter(config).then(function onAdapterResolution(response){throwIfCancellationRequested(config);response.data=transformData(response.data,response.headers,config.transformResponse);return response},function onAdapterRejection(reason){if(!isCancel(reason)){throwIfCancellationRequested(config);if(reason&&reason.response){reason.response.data=transformData(reason.response.data,reason.response.headers,config.transformResponse)}}return Promise.reject(reason)})}},{"../cancel/isCancel":65,"../defaults":73,"./../helpers/combineURLs":77,"./../helpers/isAbsoluteURL":79,"./../utils":84,"./transformData":72}],70:[function(require,module,exports){"use strict";module.exports=function enhanceError(error,config,code,request,response){error.config=config;if(code){error.code=code}error.request=request;error.response=response;return error}},{}],71:[function(require,module,exports){"use strict";var createError=require("./createError");module.exports=function settle(resolve,reject,response){var validateStatus=response.config.validateStatus;if(!response.status||!validateStatus||validateStatus(response.status)){resolve(response)}else{reject(createError("Request failed with status code "+response.status,response.config,null,response.request,response))}}},{"./createError":68}],72:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=function transformData(data,headers,fns){utils.forEach(fns,function transform(fn){data=fn(data,headers)});return data}},{"./../utils":84}],73:[function(require,module,exports){(function(process){"use strict";var utils=require("./utils");var normalizeHeaderName=require("./helpers/normalizeHeaderName");var DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(headers,value){if(!utils.isUndefined(headers)&&utils.isUndefined(headers["Content-Type"])){headers["Content-Type"]=value}}function getDefaultAdapter(){var adapter;if(typeof XMLHttpRequest!=="undefined"){adapter=require("./adapters/xhr")}else if(typeof process!=="undefined"){adapter=require("./adapters/http")}return adapter}var defaults={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(data,headers){normalizeHeaderName(headers,"Content-Type");if(utils.isFormData(data)||utils.isArrayBuffer(data)||utils.isBuffer(data)||utils.isStream(data)||utils.isFile(data)||utils.isBlob(data)){return data}if(utils.isArrayBufferView(data)){return data.buffer}if(utils.isURLSearchParams(data)){setContentTypeIfUnset(headers,"application/x-www-form-urlencoded;charset=utf-8");return data.toString()}if(utils.isObject(data)){setContentTypeIfUnset(headers,"application/json;charset=utf-8");return JSON.stringify(data)}return data}],transformResponse:[function transformResponse(data){if(typeof data==="string"){try{data=JSON.parse(data)}catch(e){}}return data}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function validateStatus(status){return status>=200&&status<300}};defaults.headers={common:{Accept:"application/json, text/plain, */*"}};utils.forEach(["delete","get","head"],function forEachMethodNoData(method){defaults.headers[method]={}});utils.forEach(["post","put","patch"],function forEachMethodWithData(method){defaults.headers[method]=utils.merge(DEFAULT_CONTENT_TYPE)});module.exports=defaults}).call(this,require("_process"))},{"./adapters/http":61,"./adapters/xhr":61,"./helpers/normalizeHeaderName":81,"./utils":84,_process:29}],74:[function(require,module,exports){"use strict";module.exports=function bind(fn,thisArg){return function wrap(){var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}return fn.apply(thisArg,args)}}},{}],75:[function(require,module,exports){"use strict";var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function E(){this.message="String contains an invalid character"}E.prototype=new Error;E.prototype.code=5;E.prototype.name="InvalidCharacterError";function btoa(input){var str=String(input);var output="";for(var block,charCode,idx=0,map=chars;str.charAt(idx|0)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){charCode=str.charCodeAt(idx+=3/4);if(charCode>255){throw new E}block=block<<8|charCode}return output}module.exports=btoa},{}],76:[function(require,module,exports){"use strict";var utils=require("./../utils");function encode(val){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function buildURL(url,params,paramsSerializer){if(!params){return url}var serializedParams;if(paramsSerializer){serializedParams=paramsSerializer(params)}else if(utils.isURLSearchParams(params)){serializedParams=params.toString()}else{var parts=[];utils.forEach(params,function serialize(val,key){if(val===null||typeof val==="undefined"){return}if(utils.isArray(val)){key=key+"[]"}if(!utils.isArray(val)){val=[val]}utils.forEach(val,function parseValue(v){if(utils.isDate(v)){v=v.toISOString()}else if(utils.isObject(v)){v=JSON.stringify(v)}parts.push(encode(key)+"="+encode(v))})});serializedParams=parts.join("&")}if(serializedParams){url+=(url.indexOf("?")===-1?"?":"&")+serializedParams}return url}},{"./../utils":84}],77:[function(require,module,exports){"use strict";module.exports=function combineURLs(baseURL,relativeURL){return relativeURL?baseURL.replace(/\/+$/,"")+"/"+relativeURL.replace(/^\/+/,""):baseURL}},{}],78:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(name,value,expires,path,domain,secure){var cookie=[];cookie.push(name+"="+encodeURIComponent(value));if(utils.isNumber(expires)){cookie.push("expires="+new Date(expires).toGMTString())}if(utils.isString(path)){cookie.push("path="+path)}if(utils.isString(domain)){cookie.push("domain="+domain)}if(secure===true){cookie.push("secure")}document.cookie=cookie.join("; ")},read:function read(name){var match=document.cookie.match(new RegExp("(^|;\\s*)("+name+")=([^;]*)"));return match?decodeURIComponent(match[3]):null},remove:function remove(name){this.write(name,"",Date.now()-864e5)}}}():function nonStandardBrowserEnv(){return{write:function write(){},read:function read(){return null},remove:function remove(){}}}()},{"./../utils":84}],79:[function(require,module,exports){"use strict";module.exports=function isAbsoluteURL(url){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url)}},{}],80:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){var msie=/(msie|trident)/i.test(navigator.userAgent);var urlParsingNode=document.createElement("a");var originURL;function resolveURL(url){var href=url;if(msie){urlParsingNode.setAttribute("href",href);href=urlParsingNode.href}urlParsingNode.setAttribute("href",href);return{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:urlParsingNode.pathname.charAt(0)==="/"?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}originURL=resolveURL(window.location.href);return function isURLSameOrigin(requestURL){var parsed=utils.isString(requestURL)?resolveURL(requestURL):requestURL;return parsed.protocol===originURL.protocol&&parsed.host===originURL.host}}():function nonStandardBrowserEnv(){return function isURLSameOrigin(){return true}}()},{"./../utils":84}],81:[function(require,module,exports){"use strict";var utils=require("../utils");module.exports=function normalizeHeaderName(headers,normalizedName){utils.forEach(headers,function processHeader(value,name){if(name!==normalizedName&&name.toUpperCase()===normalizedName.toUpperCase()){headers[normalizedName]=value;delete headers[name]}})}},{"../utils":84}],82:[function(require,module,exports){"use strict";var utils=require("./../utils");var ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];module.exports=function parseHeaders(headers){var parsed={};var key;var val;var i;if(!headers){return parsed}utils.forEach(headers.split("\n"),function parser(line){i=line.indexOf(":");key=utils.trim(line.substr(0,i)).toLowerCase();val=utils.trim(line.substr(i+1));if(key){if(parsed[key]&&ignoreDuplicateOf.indexOf(key)>=0){return}if(key==="set-cookie"){parsed[key]=(parsed[key]?parsed[key]:[]).concat([val])}else{parsed[key]=parsed[key]?parsed[key]+", "+val:val}}});return parsed}},{"./../utils":84}],83:[function(require,module,exports){"use strict";module.exports=function spread(callback){return function wrap(arr){return callback.apply(null,arr)}}},{}],84:[function(require,module,exports){"use strict";var bind=require("./helpers/bind");var isBuffer=require("is-buffer");var toString=Object.prototype.toString;function isArray(val){return toString.call(val)==="[object Array]"}function isArrayBuffer(val){return toString.call(val)==="[object ArrayBuffer]"}function isFormData(val){return typeof FormData!=="undefined"&&val instanceof FormData}function isArrayBufferView(val){var result;if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView){result=ArrayBuffer.isView(val)}else{result=val&&val.buffer&&val.buffer instanceof ArrayBuffer}return result}function isString(val){return typeof val==="string"}function isNumber(val){return typeof val==="number"}function isUndefined(val){return typeof val==="undefined"}function isObject(val){return val!==null&&typeof val==="object"}function isDate(val){return toString.call(val)==="[object Date]"}function isFile(val){return toString.call(val)==="[object File]"}function isBlob(val){return toString.call(val)==="[object Blob]"}function isFunction(val){return toString.call(val)==="[object Function]"}function isStream(val){return isObject(val)&&isFunction(val.pipe)}function isURLSearchParams(val){return typeof URLSearchParams!=="undefined"&&val instanceof URLSearchParams}function trim(str){return str.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){if(typeof navigator!=="undefined"&&navigator.product==="ReactNative"){return false}return typeof window!=="undefined"&&typeof document!=="undefined"}function forEach(obj,fn){if(obj===null||typeof obj==="undefined"){return}if(typeof obj!=="object"){obj=[obj]}if(isArray(obj)){for(var i=0,l=obj.length;i<l;i++){fn.call(null,obj[i],i,obj)}}else{for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){fn.call(null,obj[key],key,obj)}}}}function merge(){var result={};function assignValue(val,key){if(typeof result[key]==="object"&&typeof val==="object"){result[key]=merge(result[key],val)}else{result[key]=val}}for(var i=0,l=arguments.length;i<l;i++){forEach(arguments[i],assignValue)}return result}function extend(a,b,thisArg){forEach(b,function assignValue(val,key){if(thisArg&&typeof val==="function"){a[key]=bind(val,thisArg)}else{a[key]=val}});return a}module.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim}},{"./helpers/bind":74,"is-buffer":86}],85:[function(require,module,exports){(function(global){"use strict";var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|'[^']*'|'[^']*'/g;var timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g;var timezoneClip=/[^-+\dA-Z]/g;return function(date,mask,utc,gmt){if(arguments.length===1&&kindOf(date)==="string"&&!/\d/.test(date)){mask=date;date=undefined}date=date||new Date;if(!(date instanceof Date)){date=new Date(date)}if(isNaN(date)){throw TypeError("Invalid date")}mask=String(dateFormat.masks[mask]||mask||dateFormat.masks["default"]);var maskSlice=mask.slice(0,4);if(maskSlice==="UTC:"||maskSlice==="GMT:"){mask=mask.slice(4);utc=true;if(maskSlice==="GMT:"){gmt=true}}var _=utc?"getUTC":"get";var d=date[_+"Date"]();var D=date[_+"Day"]();var m=date[_+"Month"]();var y=date[_+"FullYear"]();var H=date[_+"Hours"]();var M=date[_+"Minutes"]();var s=date[_+"Seconds"]();var L=date[_+"Milliseconds"]();var o=utc?0:date.getTimezoneOffset();var W=getWeek(date);var N=getDayOfWeek(date);var flags={d:d,dd:pad(d),ddd:dateFormat.i18n.dayNames[D],dddd:dateFormat.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dateFormat.i18n.monthNames[m],mmmm:dateFormat.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(Math.round(L/10)),t:H<12?dateFormat.i18n.timeNames[0]:dateFormat.i18n.timeNames[1],tt:H<12?dateFormat.i18n.timeNames[2]:dateFormat.i18n.timeNames[3],T:H<12?dateFormat.i18n.timeNames[4]:dateFormat.i18n.timeNames[5],TT:H<12?dateFormat.i18n.timeNames[6]:dateFormat.i18n.timeNames[7],Z:gmt?"GMT":utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10],W:W,N:N};return mask.replace(token,function(match){if(match in flags){return flags[match]}return match.slice(1,match.length-1)})}}();dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]};function pad(val,len){val=String(val);len=len||2;while(val.length<len){val="0"+val}return val}function getWeek(date){var targetThursday=new Date(date.getFullYear(),date.getMonth(),date.getDate());targetThursday.setDate(targetThursday.getDate()-(targetThursday.getDay()+6)%7+3);var firstThursday=new Date(targetThursday.getFullYear(),0,4);firstThursday.setDate(firstThursday.getDate()-(firstThursday.getDay()+6)%7+3);var ds=targetThursday.getTimezoneOffset()-firstThursday.getTimezoneOffset();targetThursday.setHours(targetThursday.getHours()-ds);var weekDiff=(targetThursday-firstThursday)/(864e5*7);return 1+Math.floor(weekDiff)}function getDayOfWeek(date){var dow=date.getDay();if(dow===0){dow=7}return dow}function kindOf(val){if(val===null){return"null"}if(val===undefined){return"undefined"}if(typeof val!=="object"){return typeof val}if(Array.isArray(val)){return"array"}return{}.toString.call(val).slice(8,-1).toLowerCase()}if(typeof define==="function"&&define.amd){define(function(){return dateFormat})}else if(typeof exports==="object"){module.exports=dateFormat}else{global.dateFormat=dateFormat}})(this)},{}],86:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{dup:14}],87:[function(require,module,exports){(function(Buffer){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var stream=require("stream");var ChunkStream=function(_super){__extends(ChunkStream,_super);function ChunkStream(){_super.call(this);this.destroySoon=this.end;this._buffers=[];this._buffered=0;this._reads=[];this._paused=false;this.writable=true}ChunkStream.prototype._read=function(size){throw new Error("Not implemented")};ChunkStream.prototype._write=function(data,encoding,cb){var _this=this;if(this.writable===false){cb(new Error("Stream not writable"));return false}this._buffers.push(data);this._buffered+=data.length;setImmediate(function(){return _this._process()});if(this._reads&&this._reads.length===0){this._paused=true}cb()};ChunkStream.prototype.read=function(length,callback){var _this=this;this._reads.push({length:Math.abs(length),allowLess:length<0,func:callback});setImmediate(function(){_this._process();if(_this._paused&&_this._reads.length>0){_this._paused=false;_this.emit("drain")}})};ChunkStream.prototype.end=function(data){var _this=this;if(data){this.write(data)}this.writable=false;if(!this._buffers)return;if(this._buffers.length===0){this._end()}else{this._buffers.push(null);setImmediate(function(){return _this._process()})}};ChunkStream.prototype.destroy=function(){if(!this._buffers){return}this.writable=false;this._reads=null;this._buffers=null;this.emit("close")};ChunkStream.prototype._end=function(){if(this._reads.length>0){this.emit("error",new Error("There are some read requests waitng on finished stream"))}this.destroy()};ChunkStream.prototype._process=function(){var buf,data,len,pos,count,read;while(this._buffered>0&&this._reads&&this._reads.length>0){read=this._reads[0];if(read.allowLess){this._reads.shift();buf=this._buffers[0];if(buf.length>read.length){this._buffered-=read.length;this._buffers[0]=buf.slice(read.length);read.func.call(this,buf.slice(0,read.length))}else{this._buffered-=buf.length;this._buffers.shift();read.func.call(this,buf)}}else if(this._buffered>=read.length){this._reads.shift();pos=0;count=0;data=new Buffer(read.length);while(pos<read.length){buf=this._buffers[count++];len=Math.min(buf.length,read.length-pos);buf.copy(data,pos,0,len);pos+=len;if(len!==buf.length){this._buffers[--count]=buf.slice(len)}}if(count>0){this._buffers.splice(0,count)}this._buffered-=read.length;read.func.call(this,data)}else{break}}if(this._buffers&&this._buffers.length>0&&this._buffers[0]===null){this._end()}};return ChunkStream}(stream.Duplex);module.exports=ChunkStream}).call(this,require("buffer").Buffer)},{buffer:9,stream:48}],88:[function(require,module,exports){"use strict";exports.PNG_SIGNATURE=[137,80,78,71,13,10,26,10];exports.TYPE_IHDR=1229472850;exports.TYPE_IEND=1229278788;exports.TYPE_IDAT=1229209940;exports.TYPE_PLTE=1347179589;exports.TYPE_tRNS=1951551059;exports.TYPE_gAMA=1732332865;exports.COLOR_PALETTE=1;exports.COLOR_COLOR=2;exports.COLOR_ALPHA=4},{}],89:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var stream=require("stream");var crcTable=[0,1996959894,-301047508,-1727442502,124634137,1886057615,-379345611,-1637575261,249268274,2044508324,-522852066,-1747789432,162941995,2125561021,-407360249,-1866523247,498536548,1789927666,-205950648,-2067906082,450548861,1843258603,-187386543,-2083289657,325883990,1684777152,-43845254,-1973040660,335633487,1661365465,-99664541,-1928851979,997073096,1281953886,-715111964,-1570279054,1006888145,1258607687,-770865667,-1526024853,901097722,1119000684,-608450090,-1396901568,853044451,1172266101,-589951537,-1412350631,651767980,1373503546,-925412992,-1076862698,565507253,1454621731,-809855591,-1195530993,671266974,1594198024,-972236366,-1324619484,795835527,1483230225,-1050600021,-1234817731,1994146192,31158534,-1731059524,-271249366,1907459465,112637215,-1614814043,-390540237,2013776290,251722036,-1777751922,-519137256,2137656763,141376813,-1855689577,-429695999,1802195444,476864866,-2056965928,-228458418,1812370925,453092731,-2113342271,-183516073,1706088902,314042704,-1950435094,-54949764,1658658271,366619977,-1932296973,-69972891,1303535960,984961486,-1547960204,-725929758,1256170817,1037604311,-1529756563,-740887301,1131014506,879679996,-1385723834,-631195440,1141124467,855842277,-1442165665,-586318647,1342533948,654459306,-1106571248,-921952122,1466479909,544179635,-1184443383,-832445281,1591671054,702138776,-1328506846,-942167884,1504918807,783551873,-1212326853,-1061524307,-306674912,-1698712650,62317068,1957810842,-355121351,-1647151185,81470997,1943803523,-480048366,-1805370492,225274430,2053790376,-468791541,-1828061283,167816743,2097651377,-267414716,-2029476910,503444072,1762050814,-144550051,-2140837941,426522225,1852507879,-19653770,-1982649376,282753626,1742555852,-105259153,-1900089351,397917763,1622183637,-690576408,-1580100738,953729732,1340076626,-776247311,-1497606297,1068828381,1219638859,-670225446,-1358292148,906185462,1090812512,-547295293,-1469587627,829329135,1181335161,-882789492,-1134132454,628085408,1382605366,-871598187,-1156888829,570562233,1426400815,-977650754,-1296233688,733239954,1555261956,-1026031705,-1244606671,752459403,1541320221,-1687895376,-328994266,1969922972,40735498,-1677130071,-351390145,1913087877,83908371,-1782625662,-491226604,2075208622,213261112,-1831694693,-438977011,2094854071,198958881,-2032938284,-237706686,1759359992,534414190,-2118248755,-155638181,1873836001,414664567,-2012718362,-15766928,1711684554,285281116,-1889165569,-127750551,1634467795,376229701,-1609899400,-686959890,1308918612,956543938,-1486412191,-799009033,1231636301,1047427035,-1362007478,-640263460,1088359270,936918e3,-1447252397,-558129467,1202900863,817233897,-1111625188,-893730166,1404277552,615818150,-1160759803,-841546093,1423857449,601450431,-1285129682,-1000256840,1567103746,711928724,-1274298825,-1022587231,1510334235,755167117];var CrcStream=function(_super){__extends(CrcStream,_super);function CrcStream(){_super.call(this);this._crc=-1;this.writable=true}Object.defineProperty(CrcStream.prototype,"crc32",{get:function(){return this._crc^-1},enumerable:true,configurable:true});CrcStream.prototype._write=function(data,encoding,cb){for(var i=0;i<data.length;i++){this._crc=crcTable[(this._crc^data[i])&255]^this._crc>>>8}cb()};CrcStream.prototype.end=function(data){if(data){this.write(data)}this.emit("crc",this.crc32)};CrcStream.crc32=function(buf){var crc=-1;for(var i=0;i<buf.length;i++){crc=crcTable[(crc^buf[i])&255]^crc>>>8}return crc^-1};return CrcStream}(stream.Writable);module.exports=CrcStream},{stream:48}],90:[function(require,module,exports){(function(Buffer){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var ChunkStream=require("./chunk-stream");var pixelBppMap={1:{0:0,1:0,2:0,3:255},2:{0:0,1:0,2:0,3:1},3:{0:0,1:1,2:2,3:255},4:{0:0,1:1,2:2,3:3}};function PaethPredictor(left,above,upLeft){var p=left+above-upLeft;var pLeft=Math.abs(p-left);var pAbove=Math.abs(p-above);var pUpLeft=Math.abs(p-upLeft);if(pLeft<=pAbove&&pLeft<=pUpLeft){return left}else if(pAbove<=pUpLeft){return above}else{return upLeft}}var Filter=function(_super){__extends(Filter,_super);function Filter(width,height,bpp,data,option){_super.call(this);this._width=width;this._height=height;this._bpp=bpp;this._data=data;this._option=option;this._line=0;if(option.filterType===undefined||option.filterType===-1){this._filterTypes=[0,1,2,3,4]}else if(typeof option.filterType==="number"){this._filterTypes=[option.filterType]}this._filters={0:this._filterNone.bind(this),1:this._filterSub.bind(this),2:this._filterUp.bind(this),3:this._filterAvg.bind(this),4:this._filterPaeth.bind(this)};this.read(this._width*bpp+1,this._reverseFilterLine.bind(this))}Filter.prototype.filter=function(){var pxData=this._data;var rawData=new Buffer(((this._width<<2)+1)*this._height);var i,l,y,min,sel,sum;for(y=0;y<this._height;y++){min=Infinity;sel=0;for(i=0,l=this._filterTypes.length;i<l;i++){sum=this._filters[this._filterTypes[i]](pxData,y,null);if(sum<min){sel=this._filterTypes[i];min=sum}}this._filters[sel](pxData,y,rawData)}return rawData};Filter.prototype._reverseFilterLine=function(rawData){var pxData=this._data;var pxLineLength=this._width<<2;var pxRowPos=this._line*pxLineLength;var filter=rawData[0];var i,x,pxPos,rawPos,idx,left,up,add,upLeft;if(filter===0){for(x=0;x<this._width;x++){pxPos=pxRowPos+(x<<2);rawPos=1+x*this._bpp;for(i=0;i<4;i++){idx=pixelBppMap[this._bpp][i];pxData[pxPos+i]=idx!==255?rawData[rawPos+idx]:255}}}else if(filter===1){for(x=0;x<this._width;x++){pxPos=pxRowPos+(x<<2);rawPos=1+x*this._bpp;for(i=0;i<4;i++){idx=pixelBppMap[this._bpp][i];left=x>0?pxData[pxPos+i-4]:0;pxData[pxPos+i]=idx!==255?rawData[rawPos+idx]+left:255}}}else if(filter===2){for(x=0;x<this._width;x++){pxPos=pxRowPos+(x<<2);rawPos=1+x*this._bpp;for(i=0;i<4;i++){idx=pixelBppMap[this._bpp][i];up=this._line>0?pxData[pxPos-pxLineLength+i]:0;pxData[pxPos+i]=idx!==255?rawData[rawPos+idx]+up:255}}}else if(filter===3){for(x=0;x<this._width;x++){pxPos=pxRowPos+(x<<2);rawPos=1+x*this._bpp;for(i=0;i<4;i++){idx=pixelBppMap[this._bpp][i];left=x>0?pxData[pxPos+i-4]:0;up=this._line>0?pxData[pxPos-pxLineLength+i]:0;add=Math.floor((left+up)/2);pxData[pxPos+i]=idx!==255?rawData[rawPos+idx]+add:255}}}else if(filter===4){for(x=0;x<this._width;x++){pxPos=pxRowPos+(x<<2);rawPos=1+x*this._bpp;for(i=0;i<4;i++){idx=pixelBppMap[this._bpp][i];left=x>0?pxData[pxPos+i-4]:0;up=this._line>0?pxData[pxPos-pxLineLength+i]:0;upLeft=x>0&&this._line>0?pxData[pxPos-pxLineLength+i-4]:0;add=PaethPredictor(left,up,upLeft);pxData[pxPos+i]=idx!==255?rawData[rawPos+idx]+add:255}}}this._line++;if(this._line<this._height){this.read(this._width*this._bpp+1,this._reverseFilterLine.bind(this))}else{this.emit("complete",this._data,this._width,this._height)}};Filter.prototype._filterNone=function(pxData,y,rawData){var pxRowLength=this._width<<2;var rawRowLength=pxRowLength+1;var sum=0;if(!rawData){for(var x=0;x<pxRowLength;x++){sum+=Math.abs(pxData[y*pxRowLength+x])}}else{rawData[y*rawRowLength]=0;pxData.copy(rawData,rawRowLength*y+1,pxRowLength*y,pxRowLength*(y+1))}return sum};Filter.prototype._filterSub=function(pxData,y,rawData){var pxRowLength=this._width<<2;var rawRowLength=pxRowLength+1;var sum=0;var left,val;if(rawData){rawData[y*rawRowLength]=1}for(var x=0;x<pxRowLength;x++){left=x>=4?pxData[y*pxRowLength+x-4]:0;val=pxData[y*pxRowLength+x]-left;if(!rawData){sum+=Math.abs(val)}else{rawData[y*rawRowLength+1+x]=val}}return sum};Filter.prototype._filterUp=function(pxData,y,rawData){var pxRowLength=this._width<<2;var rawRowLength=pxRowLength+1;var sum=0;var up,val;if(rawData){rawData[y*rawRowLength]=2}for(var x=0;x<pxRowLength;x++){up=y>0?pxData[(y-1)*pxRowLength+x]:0;val=pxData[y*pxRowLength+x]-up;if(!rawData){sum+=Math.abs(val)}else{rawData[y*rawRowLength+1+x]=val}}return sum};Filter.prototype._filterAvg=function(pxData,y,rawData){var pxRowLength=this._width<<2;var rawRowLength=pxRowLength+1;var sum=0;var left,up,val;if(rawData){rawData[y*rawRowLength]=3}for(var x=0;x<pxRowLength;x++){left=x>=4?pxData[y*pxRowLength+x-4]:0;up=y>0?pxData[(y-1)*pxRowLength+x]:0;val=pxData[y*pxRowLength+x]-(left+up>>1);if(!rawData){sum+=Math.abs(val)}else{rawData[y*rawRowLength+1+x]=val}}return sum};Filter.prototype._filterPaeth=function(pxData,y,rawData){var pxRowLength=this._width<<2;var rawRowLength=pxRowLength+1;var sum=0;var left,up,upLeft,val;if(rawData){rawData[y*rawRowLength]=4}for(var x=0;x<pxRowLength;x++){left=x>=4?pxData[y*pxRowLength+x-4]:0;up=y>0?pxData[(y-1)*pxRowLength+x]:0;upLeft=x>=4&&y>0?pxData[(y-1)*pxRowLength+x-4]:0;val=pxData[y*pxRowLength+x]-PaethPredictor(left,up,upLeft);if(!rawData){sum+=Math.abs(val)}else{rawData[y*rawRowLength+1+x]=val}}return sum};return Filter}(ChunkStream);module.exports=Filter}).call(this,require("buffer").Buffer)},{"./chunk-stream":87,buffer:9}],91:[function(require,module,exports){(function(Buffer){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var stream=require("stream");var Parser=require("./parser");var Packer=require("./packer");(function(EDeflateStrategy){EDeflateStrategy[EDeflateStrategy["DEFAULT_STRATEGY"]=0]="DEFAULT_STRATEGY";EDeflateStrategy[EDeflateStrategy["FILTERED"]=1]="FILTERED";EDeflateStrategy[EDeflateStrategy["HUFFMAN_ONLY"]=2]="HUFFMAN_ONLY";EDeflateStrategy[EDeflateStrategy["RLE"]=3]="RLE";EDeflateStrategy[EDeflateStrategy["FIXED"]=4]="FIXED"})(exports.EDeflateStrategy||(exports.EDeflateStrategy={}));var EDeflateStrategy=exports.EDeflateStrategy;(function(EFilterType){EFilterType[EFilterType["Auto"]=-1]="Auto";EFilterType[EFilterType["None"]=0]="None";EFilterType[EFilterType["Sub"]=1]="Sub";EFilterType[EFilterType["Up"]=2]="Up";EFilterType[EFilterType["Average"]=3]="Average";EFilterType[EFilterType["Paeth"]=4]="Paeth"})(exports.EFilterType||(exports.EFilterType={}));var EFilterType=exports.EFilterType;function createImage(option){return new Image(option)}exports.createImage=createImage;var Image=function(_super){__extends(Image,_super);function Image(option){var _this=this;if(option===void 0){option={}}_super.call(this);this.width=option.width||0;this.height=option.height||0;if(this.width>0&&this.height>0){this.data=new Buffer(4*this.width*this.height);if(option.fill){this.data.fill(0)}}else{this.data=null}this.gamma=0;this.writable=true;this._parser=new Parser(option||{});this._parser.on("error",this.emit.bind(this,"error"));this._parser.on("close",this._handleClose.bind(this));this._parser.on("metadata",this._metadata.bind(this));this._parser.on("gamma",this._gamma.bind(this));this._parser.on("parsed",function(data){_this.data=data;_this.emit("parsed",data)});this._packer=new Packer(option);this._packer.on("data",this.emit.bind(this,"data"));this._packer.on("end",this.emit.bind(this,"end"));this._packer.on("close",this._handleClose.bind(this));this._packer.on("error",this.emit.bind(this,"error"))}Image.prototype.pack=function(){var _this=this;setImmediate(function(){_this._packer.pack(_this.data,_this.width,_this.height);_this.readable=true});return this};Image.prototype.parse=function(data,callback){var _this=this;if(callback){var onParsed_1=null,onError_1=null;this.once("parsed",onParsed_1=function(data){_this.removeListener("error",onError_1);_this.data=data;callback(null,_this)});this.once("error",onError_1=function(err){_this.removeListener("parsed",onParsed_1);callback(err,null)})}this.end(data);return this};Image.prototype._write=function(data,encoding,callback){return this._parser._write(data,encoding,callback)};Image.prototype.end=function(data){return this._parser.end(data)};Image.prototype.bitblt=function(dst,sx,sy,w,h,dx,dy){if(sx>this.width||sy>this.height||sx+w>this.width||sy+h>this.height){throw new Error("bitblt reading outside image")}if(dx>dst.width||dy>dst.height||dx+w>dst.width||dy+h>dst.height){throw new Error("bitblt writing outside image")}for(var y=0;y<h;y++){this.data.copy(dst.data,(dy+y)*dst.width+dx<<2,(sy+y)*this.width+sx<<2,(sy+y)*this.width+sx+w<<2)}return this};Image.prototype._read=function(){};Image.prototype._metadata=function(metadata){this.width=metadata.width;this.height=metadata.height;this.data=metadata.data;delete metadata.data;this.emit("metadata",metadata)};Image.prototype._gamma=function(gamma){this.gamma=gamma};Image.prototype._handleClose=function(){if(!this._parser.writable&&!this._packer.readable){this.emit("close")}};return Image}(stream.Duplex);exports.Image=Image}).call(this,require("buffer").Buffer)},{"./packer":92,"./parser":93,buffer:9,stream:48}],92:[function(require,module,exports){(function(Buffer){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var zlib=require("zlib");var stream=require("stream");var png=require("./index");var constants=require("./constants");var CrcStream=require("./crc");var Filter=require("./filter");var Packer=function(_super){__extends(Packer,_super);function Packer(option){_super.call(this);this._option=option;option.deflateChunkSize=option.deflateChunkSize||32*1024;option.deflateLevel=option.deflateLevel||9;if(option.deflateStrategy===undefined){option.deflateStrategy=png.EDeflateStrategy.RLE}this.readable=true}Packer.prototype.pack=function(data,width,height){var _this=this;this.emit("data",new Buffer(constants.PNG_SIGNATURE));this.emit("data",this._packIHDR(width,height));var filter=new Filter(width,height,4,data,this._option);data=filter.filter();var deflate=zlib.createDeflate({chunkSize:this._option.deflateChunkSize,level:this._option.deflateLevel,strategy:this._option.deflateStrategy});deflate.on("error",this.emit.bind(this,"error"));deflate.on("data",function(data){_this.emit("data",_this._packIDAT(data))});deflate.on("end",function(){_this.emit("data",_this._packIEND());_this.emit("end")});deflate.end(data)};Packer.prototype._read=function(){};Packer.prototype._packChunk=function(type,data){var len=data?data.length:0;var buf=new Buffer(len+12);buf.writeUInt32BE(len,0);buf.writeUInt32BE(type,4);if(data){data.copy(buf,8)}buf.writeInt32BE(CrcStream.crc32(buf.slice(4,buf.length-4)),buf.length-4);return buf};Packer.prototype._packIHDR=function(width,height){var buf=new Buffer(13);buf.writeUInt32BE(width,0);buf.writeUInt32BE(height,4);buf[8]=8;buf[9]=6;buf[10]=0;buf[11]=0;buf[12]=0;return this._packChunk(constants.TYPE_IHDR,buf)};Packer.prototype._packIDAT=function(data){return this._packChunk(constants.TYPE_IDAT,data)};Packer.prototype._packIEND=function(){return this._packChunk(constants.TYPE_IEND,null)};return Packer}(stream.Readable);module.exports=Packer}).call(this,require("buffer").Buffer)},{"./constants":88,"./crc":89,"./filter":90,"./index":91,buffer:9,stream:48,zlib:8}],93:[function(require,module,exports){(function(Buffer){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var zlib=require("zlib");var constants=require("./constants");var CrcStream=require("./crc");var ChunkStream=require("./chunk-stream");var Filter=require("./filter");var colorTypeToBppMap={0:1,2:3,3:1,4:2,6:4};var Parser=function(_super){__extends(Parser,_super);function Parser(option){_super.call(this);this._option=option;option.checkCRC=option.checkCRC!==false;this._hasIHDR=false;this._hasIEND=false;this._inflate=null;this._filter=null;this._crc=null;this._palette=[];this._colorType=0;this._chunks={};this._chunks[constants.TYPE_IHDR]=this._handleIHDR.bind(this);this._chunks[constants.TYPE_IEND]=this._handleIEND.bind(this);this._chunks[constants.TYPE_IDAT]=this._handleIDAT.bind(this);this._chunks[constants.TYPE_PLTE]=this._handlePLTE.bind(this);this._chunks[constants.TYPE_tRNS]=this._handleTRNS.bind(this);this._chunks[constants.TYPE_gAMA]=this._handleGAMA.bind(this);this.writable=true;this.on("error",this._handleError.bind(this));this._handleSignature()}Parser.prototype._handleError=function(){this.writable=false;this.destroy()};Parser.prototype._handleSignature=function(){this.read(constants.PNG_SIGNATURE.length,this._parseSignature.bind(this))};Parser.prototype._parseSignature=function(data){var signature=constants.PNG_SIGNATURE;for(var i=0;i<signature.length;i++){if(data[i]!==signature[i]){this.emit("error",new Error("Invalid file signature"));return}}this.read(8,this._parseChunkBegin.bind(this))};Parser.prototype._parseChunkBegin=function(data){var length=data.readUInt32BE(0);var type=data.readUInt32BE(4);var name="";for(var i=4;i<8;i++){name+=String.fromCharCode(data[i])}var ancillary=!!(data[4]&32);if(!this._hasIHDR&&type!==constants.TYPE_IHDR){this.emit("error",new Error("Expected IHDR on beginning"));return}this._crc=new CrcStream;this._crc.write(new Buffer(name));if(this._chunks[type]){return this._chunks[type](length)}else if(!ancillary){this.emit("error",new Error("Unsupported critical chunk type "+name));return}else{this.read(length+4,this._skipChunk.bind(this))}};Parser.prototype._skipChunk=function(data){this.read(8,this._parseChunkBegin.bind(this))};Parser.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))};Parser.prototype._parseChunkEnd=function(data){var fileCrc=data.readInt32BE(0);var calcCrc=this._crc.crc32;if(this._option.checkCRC&&calcCrc!==fileCrc){this.emit("error",new Error("Crc error"));return}if(this._hasIEND){this.destroySoon()}else{this.read(8,this._parseChunkBegin.bind(this))}};Parser.prototype._handleIHDR=function(length){this.read(length,this._parseIHDR.bind(this))};Parser.prototype._parseIHDR=function(data){this._crc.write(data);var width=data.readUInt32BE(0);var height=data.readUInt32BE(4);var depth=data[8];var colorType=data[9];var compr=data[10];var filter=data[11];var interlace=data[12];if(depth!==8){this.emit("error",new Error("Unsupported bit depth "+depth));return}if(!(colorType in colorTypeToBppMap)){this.emit("error",new Error("Unsupported color type"));return}if(compr!==0){this.emit("error",new Error("Unsupported compression method"));return}if(filter!==0){this.emit("error",new Error("Unsupported filter method"));return}if(interlace!==0){this.emit("error",new Error("Unsupported interlace method"));return}this._colorType=colorType;this._data=new Buffer(width*height*4);this._filter=new Filter(width,height,colorTypeToBppMap[this._colorType],this._data,this._option);this._hasIHDR=true;this.emit("metadata",{width:width,height:height,palette:!!(colorType&constants.COLOR_PALETTE),color:!!(colorType&constants.COLOR_COLOR),alpha:!!(colorType&constants.COLOR_ALPHA),data:this._data});this._handleChunkEnd()};Parser.prototype._handlePLTE=function(length){this.read(length,this._parsePLTE.bind(this))};Parser.prototype._parsePLTE=function(data){this._crc.write(data);var entries=Math.floor(data.length/3);for(var i=0;i<entries;i++){this._palette.push([data.readUInt8(i*3),data.readUInt8(i*3+1),data.readUInt8(i*3+2),255])}this._handleChunkEnd()};Parser.prototype._handleTRNS=function(length){this.read(length,this._parseTRNS.bind(this))};Parser.prototype._parseTRNS=function(data){this._crc.write(data);if(this._colorType===3){if(this._palette.length===0){this.emit("error",new Error("Transparency chunk must be after palette"));return}if(data.length>this._palette.length){this.emit("error",new Error("More transparent colors than palette size"));return}for(var i=0;i<this._palette.length;i++){this._palette[i][3]=i<data.length?data.readUInt8(i):255}}this._handleChunkEnd()};Parser.prototype._handleGAMA=function(length){this.read(length,this._parseGAMA.bind(this))};Parser.prototype._parseGAMA=function(data){this._crc.write(data);this.emit("gamma",data.readUInt32BE(0)/1e5);this._handleChunkEnd()};Parser.prototype._handleIDAT=function(length){this.read(-length,this._parseIDAT.bind(this,length))};Parser.prototype._parseIDAT=function(length,data){this._crc.write(data);if(this._colorType===3&&this._palette.length===0){throw new Error("Expected palette not found")}if(!this._inflate){this._inflate=zlib.createInflate();this._inflate.on("error",this.emit.bind(this,"error"));this._filter.on("complete",this._reverseFiltered.bind(this));this._inflate.pipe(this._filter)}this._inflate.write(data);length-=data.length;if(length>0){this._handleIDAT(length)}else{this._handleChunkEnd()}};Parser.prototype._handleIEND=function(length){this.read(length,this._parseIEND.bind(this))};Parser.prototype._parseIEND=function(data){this._crc.write(data);this._inflate.end();this._hasIEND=true;this._handleChunkEnd()};Parser.prototype._reverseFiltered=function(data,width,height){if(this._colorType===3){var i=void 0,y=void 0,x=void 0,pxRowPos=void 0,pxPos=void 0,color=void 0;var pxLineLength=width<<2;for(y=0;y<height;y++){pxRowPos=y*pxLineLength;for(x=0;x<width;x++){pxPos=pxRowPos+(x<<2),color=this._palette[data[pxPos]];for(i=0;i<4;i++){data[pxPos+i]=color[i]}}}}this.emit("parsed",data)};return Parser}(ChunkStream);module.exports=Parser}).call(this,require("buffer").Buffer)},{"./chunk-stream":87,"./constants":88,"./crc":89,"./filter":90,buffer:9,zlib:8}],94:[function(require,module,exports){exports.get=function(belowFn){var oldLimit=Error.stackTraceLimit;Error.stackTraceLimit=Infinity;var dummyObject={};var v8Handler=Error.prepareStackTrace;Error.prepareStackTrace=function(dummyObject,v8StackTrace){return v8StackTrace};Error.captureStackTrace(dummyObject,belowFn||exports.get);var v8StackTrace=dummyObject.stack;Error.prepareStackTrace=v8Handler;Error.stackTraceLimit=oldLimit;return v8StackTrace};exports.parse=function(err){if(!err.stack){return[]}var self=this;var lines=err.stack.split("\n").slice(1);return lines.map(function(line){if(line.match(/^\s*[-]{4,}$/)){return self._createParsedCallSite({fileName:line,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null})}var lineMatch=line.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(!lineMatch){return}var object=null;var method=null;var functionName=null;var typeName=null;var methodName=null;var isNative=lineMatch[5]==="native";if(lineMatch[1]){functionName=lineMatch[1];var methodStart=functionName.lastIndexOf(".");if(functionName[methodStart-1]==".")methodStart--;if(methodStart>0){object=functionName.substr(0,methodStart);method=functionName.substr(methodStart+1);var objectEnd=object.indexOf(".Module");if(objectEnd>0){functionName=functionName.substr(objectEnd+1);object=object.substr(0,objectEnd)}}typeName=null}if(method){typeName=object;methodName=method}if(method==="<anonymous>"){methodName=null;functionName=null}var properties={fileName:lineMatch[2]||null,lineNumber:parseInt(lineMatch[3],10)||null,functionName:functionName,typeName:typeName,methodName:methodName,columnNumber:parseInt(lineMatch[4],10)||null,native:isNative};return self._createParsedCallSite(properties)}).filter(function(callSite){return!!callSite})};function CallSite(properties){for(var property in properties){this[property]=properties[property]}}var strProperties=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"];var boolProperties=["topLevel","eval","native","constructor"];strProperties.forEach(function(property){CallSite.prototype[property]=null;CallSite.prototype["get"+property[0].toUpperCase()+property.substr(1)]=function(){return this[property]}});boolProperties.forEach(function(property){CallSite.prototype[property]=false;CallSite.prototype["is"+property[0].toUpperCase()+property.substr(1)]=function(){return this[property]}});exports._createParsedCallSite=function(properties){return new CallSite(properties)}},{}],95:[function(require,module,exports){"use strict";const GeneralUtils=require("./GeneralUtils");class AppEnvironment{constructor(os,hostingApp,displaySize){this._inferred=null;this._hostOS=os;this._hostApp=hostingApp;this._displaySize=displaySize}static fromInferred(inferred){const env=new AppEnvironment;env.inferred=inferred;return env}geInferred(){return this._inferred}setInferred(value){this._inferred=value}getOs(){return this._hostOS}setOs(value){this._hostOS=value}getHostingApp(){return this._hostApp}setHostingApp(value){this._hostApp=value}getDisplaySize(){return this._displaySize}setDisplaySize(value){this._displaySize=value}toJSON(){return{inferred:this._inferred,hostOS:this._hostOS,hostApp:this._hostApp,displaySize:this._displaySize}}toString(){return`AppEnvironment { ${GeneralUtils.toJson(this)} }`}}module.exports=AppEnvironment},{"./GeneralUtils":102}],96:[function(require,module,exports){"use strict";class ArgumentGuard{static notEqual(param,value,paramName){if(param===value){throw new Error(`IllegalArgument: ${paramName} === ${value}`)}}static notNull(param,paramName){if(param===null||param===undefined){throw new Error(`IllegalArgument: ${paramName} is null or undefined`)}}static isNull(param,paramName){if(param!==null&&param!==undefined){throw new Error(`IllegalArgument: ${paramName} is not null or undefined`)}}static notNullOrEmpty(param,paramName){if(!param){throw new Error(`IllegalArgument: ${paramName} is null or empty`)}}static greaterThanOrEqualToZero(param,paramName,isInteger=false){if(isInteger){ArgumentGuard.isInteger(param,paramName)}if(param<0){throw new Error(`IllegalArgument: ${paramName} < 0`)}}static greaterThanZero(param,paramName,isInteger=false){if(isInteger){ArgumentGuard.isInteger(param,paramName)}if(param<=0){throw new Error(`IllegalArgument: ${paramName} < 1`)}}static notZero(param,paramName,isInteger=false){if(isInteger){ArgumentGuard.isInteger(param,paramName)}if(param===0){throw new Error(`IllegalArgument: ${paramName} === 0`)}}static isInteger(param,paramName){if(!Number.isInteger(param)){throw new Error(`IllegalArgument: ${paramName} is not integer`)}}static isValidState(isValid,errMsg){if(!isValid){throw new Error(`IllegalState: ${errMsg}`)}}static isValidType(param,type){if(!(param instanceof type)){throw new Error(`IllegalType: ${param} is not instance of ${type}`)}}static isValidEnumValue(value,enumObject){if(!enumObject.hasOwnProperty(value)){throw new Error(`IllegalType: ${value} is not member of ${enumObject}`)}}static hasProperties(object,properties,paramName){if(!Array.isArray(properties)){properties=[properties]}for(const property of properties){if(!object.hasOwnProperty(property)){throw new Error(`IllegalArgument: ${paramName} don't have '${property}' property`)}}}}module.exports=ArgumentGuard},{}],97:[function(require,module,exports){"use strict";const ArgumentGuard=require("./ArgumentGuard");const GeneralUtils=require("./GeneralUtils");class BatchInfo{constructor(name=null,startedAt=new Date,id=GeneralUtils.guid()){ArgumentGuard.notNull(startedAt,"startedAt");this._id=id;this._name=name;this._startedAt=GeneralUtils.getIso8601Data(startedAt)}getId(){return this._id}setId(value){ArgumentGuard.notNullOrEmpty(value,"id");this._id=value}getName(){return this._name}getStartedAt(){return new Date(this._startedAt)}toJSON(){return{id:this._id,name:this._name,startedAt:this._startedAt}}toString(){return`BatchInfo { ${GeneralUtils.toJson(this)} }`}}module.exports=BatchInfo},{"./ArgumentGuard":96,"./GeneralUtils":102}],98:[function(require,module,exports){"use strict";class BrowserNames{}BrowserNames.Edge="Edge";BrowserNames.IE="IE";BrowserNames.Firefox="Firefox";BrowserNames.Chrome="Chrome";BrowserNames.Safari="Safari";BrowserNames.Chromium="Chromium";module.exports=BrowserNames},{}],99:[function(require,module,exports){"use strict";const Logger=require("./logging/Logger");const Region=require("./positioning/Region");const Location=require("./positioning/Location");const RectangleSize=require("./positioning/RectangleSize");const CoordinatesType=require("./positioning/CoordinatesType");const FileDebugScreenshotsProvider=require("./debug/FileDebugScreenshotsProvider");const NullDebugScreenshotProvider=require("./debug/NullDebugScreenshotProvider");const SimplePropertyHandler=require("./handlers/SimplePropertyHandler");const ReadOnlyPropertyHandler=require("./handlers/ReadOnlyPropertyHandler");const ImageDeltaCompressor=require("./images/ImageDeltaCompressor");const AppOutputProvider=require("./capture/AppOutputProvider");const AppOutputWithScreenshot=require("./capture/AppOutputWithScreenshot");const AppOutput=require("./capture/AppOutput");const FixedScaleProvider=require("./scaling/FixedScaleProvider");const NullScaleProvider=require("./scaling/NullScaleProvider");const NullCutProvider=require("./cutting/NullCutProvider");const InvalidPositionProvider=require("./positioning/InvalidPositionProvider");const TextTrigger=require("./triggers/TextTrigger");const MouseTrigger=require("./triggers/MouseTrigger");const MatchResult=require("./server/MatchResult");const MatchLevel=require("./match/MatchLevel");const ImageMatchSettings=require("./match/ImageMatchSettings");const MatchWindowData=require("./match/MatchWindowData");const DiffsFoundError=require("./errors/DiffsFoundError");const EyesError=require("./errors/EyesError");const NewTestError=require("./errors/NewTestError");const OutOfBoundsError=require("./errors/OutOfBoundsError");const TestFailedError=require("./errors/TestFailedError");const CheckSettings=require("./fluent/CheckSettings");const SessionStartInfo=require("./server/SessionStartInfo");const SessionType=require("./server/SessionType");const PropertyData=require("./server/PropertyData");const TestResultsStatus=require("./server/TestResultsStatus");const FailureReports=require("./FailureReports");const GeneralUtils=require("./GeneralUtils");const ArgumentGuard=require("./ArgumentGuard");const AppEnvironment=require("./AppEnvironment");const ServerConnector=require("./server/ServerConnector");const MatchWindowTask=require("./MatchWindowTask");const SessionEventHandler=require("./SessionEventHandler");const BatchInfo=require("./BatchInfo");const PromiseFactory=require("./PromiseFactory");const TestResults=require("./server/TestResults");const DEFAULT_MATCH_TIMEOUT=2e3;const MIN_MATCH_TIMEOUT=500;class EyesBase{constructor(serverUrl=EyesBase.DEFAULT_EYES_SERVER,isDisabled=false,promiseFactory=new PromiseFactory(asyncAction=>new Promise(asyncAction))){this._isDisabled=isDisabled;if(this._isDisabled){this._userInputs=null;return}ArgumentGuard.notNull(promiseFactory,"promiseFactory");ArgumentGuard.notNull(serverUrl,"serverUrl");this._logger=new Logger;this._promiseFactory=promiseFactory;this._scaleProviderHandler=new SimplePropertyHandler;this._scaleProviderHandler.set(new NullScaleProvider);this._cutProviderHandler=new SimplePropertyHandler;this._cutProviderHandler.set(new NullCutProvider);this._positionProvider=new InvalidPositionProvider;this._viewportSizeHandler=new SimplePropertyHandler;this._viewportSizeHandler.set(null);this._debugScreenshotsProvider=new NullDebugScreenshotProvider;this._defaultMatchSettings=new ImageMatchSettings;this._serverConnector=new ServerConnector(this._promiseFactory,this._logger,serverUrl);this._matchTimeout=DEFAULT_MATCH_TIMEOUT;this._failureReports=FailureReports.ON_CLOSE;this._userInputs=[];this._properties=[];this._validationId=-1;this._sessionEventHandlers=[];this._saveNewTests=true;this._saveFailedTests=false;this._shouldMatchWindowRunOnceOnTimeout=undefined;this._matchWindowTask=undefined;this._runningSession=undefined;this._sessionStartInfo=undefined;this._lastScreenshot=undefined;this._isViewportSizeSet=undefined;this._isOpen=undefined;this._agentId=undefined;this._sessionType=undefined;this._testName=undefined;this._batch=undefined;this._hostApp=undefined;this._hostOS=undefined;this._baselineEnvName=undefined;this._environmentName=undefined;this._branchName=undefined;this._parentBranchName=undefined;this._currentAppName=undefined;this._appName=undefined;this._autSessionId=undefined}setAgentId(agentId){this._agentId=agentId}getAgentId(){return this._agentId}setApiKey(apiKey){ArgumentGuard.notNull(apiKey,"apiKey");this._serverConnector.setApiKey(apiKey)}getApiKey(){return this._serverConnector.getApiKey()}setServerUrl(serverUrl){if(serverUrl){this._serverConnector.setServerUrl(serverUrl)}else{this._serverConnector.setServerUrl(this.getDefaultServerUrl())}}getServerUrl(){return this._serverConnector.getServerUrl()}setProxy(arg1,username,password){return this._serverConnector.setProxy(arg1,username,password)}getProxy(){return this._serverConnector.getProxy()}setIsDisabled(isDisabled){this._isDisabled=isDisabled}getIsDisabled(){return this._isDisabled}setAppName(appName){this._appName=appName}getAppName(){return this._currentAppName||this._appName}setBranchName(branchName){this._branchName=branchName}getBranchName(){return this._branchName}setParentBranchName(parentBranchName){this._parentBranchName=parentBranchName}getParentBranchName(){return this._parentBranchName}clearUserInputs(){if(this._isDisabled){return}this._userInputs.length=0}getUserInputs(){if(this._isDisabled){return null}return GeneralUtils.clone(this._userInputs)}setMatchTimeout(ms){if(this._isDisabled){this._logger.verbose("Ignored");return}this._logger.verbose("Setting match timeout to: "+ms);if(ms!==0&&MIN_MATCH_TIMEOUT>ms){throw new TypeError(`Match timeout must be set in milliseconds, and must be > ${MIN_MATCH_TIMEOUT}`)}this._matchTimeout=ms}getMatchTimeout(){return this._matchTimeout}setSaveNewTests(saveNewTests){this._saveNewTests=saveNewTests}getSaveNewTests(){return this._saveNewTests}setSaveFailedTests(saveFailedTests){this._saveFailedTests=saveFailedTests}getSaveFailedTests(){return this._saveFailedTests}setBatch(arg1,batchId,batchDate){if(this._isDisabled){this._logger.verbose("Ignored");return}if(arg1 instanceof BatchInfo){this._batch=arg1}else{this._batch=new BatchInfo(arg1,batchDate,batchId)}this._logger.verbose(`setBatch(${this._batch})`)}getBatch(){return this._batch}setFailureReports(failureReports){ArgumentGuard.isValidEnumValue(failureReports,FailureReports);this._failureReports=failureReports}getFailureReports(){return this._failureReports}setDefaultMatchSettings(defaultMatchSettings){ArgumentGuard.notNull(defaultMatchSettings,"defaultMatchSettings");this._defaultMatchSettings=defaultMatchSettings}getDefaultMatchSettings(){return this._defaultMatchSettings}setMatchLevel(matchLevel){ArgumentGuard.isValidEnumValue(matchLevel,MatchLevel);this._defaultMatchSettings.setMatchLevel(matchLevel)}getMatchLevel(){return this._defaultMatchSettings.getMatchLevel()}_getFullAgentId(){const agentId=this.getAgentId();if(!agentId){return this.getBaseAgentId()}return`${agentId} [${this.getBaseAgentId()}]`}getIsOpen(){return this._isOpen}getDefaultServerUrl(){return"https://eyesapi.applitools.com"}setLogHandler(logHandler){this._logger.setLogHandler(logHandler)}getLogHandler(){return this._logger.getLogHandler()}setImageCut(cutProvider){if(cutProvider){this._cutProviderHandler=new ReadOnlyPropertyHandler(this._logger,cutProvider)}else{this._cutProviderHandler=new SimplePropertyHandler(new NullCutProvider)}}setScaleRatio(scaleRatio){if(scaleRatio){this._scaleProviderHandler=new ReadOnlyPropertyHandler(this._logger,new FixedScaleProvider(scaleRatio))}else{this._scaleProviderHandler=new SimplePropertyHandler(new NullScaleProvider)}}getScaleRatio(){return this._scaleProviderHandler.get().getScaleRatio()}addProperty(name,value){const pd=new PropertyData(name,value);return this._properties.push(pd)}clearProperties(){this._properties.length=0}setSaveDebugScreenshots(saveDebugScreenshots){const prev=this._debugScreenshotsProvider;if(saveDebugScreenshots){this._debugScreenshotsProvider=new FileDebugScreenshotsProvider}else{this._debugScreenshotsProvider=new NullDebugScreenshotProvider}this._debugScreenshotsProvider.setPrefix(prev.getPrefix());this._debugScreenshotsProvider.setPath(prev.getPath())}getSaveDebugScreenshots(){return!(this._debugScreenshotsProvider instanceof NullDebugScreenshotProvider)}setDebugScreenshotsPath(pathToSave){this._debugScreenshotsProvider.setPath(pathToSave)}getDebugScreenshotsPath(){return this._debugScreenshotsProvider.getPath()}setDebugScreenshotsPrefix(prefix){this._debugScreenshotsProvider.setPrefix(prefix)}getDebugScreenshotsPrefix(){return this._debugScreenshotsProvider.getPrefix()}setDebugScreenshotsProvider(debugScreenshotsProvider){this._debugScreenshotsProvider=debugScreenshotsProvider}getDebugScreenshotsProvider(){return this._debugScreenshotsProvider}setIgnoreCaret(value){this._defaultMatchSettings.setIgnoreCaret(value)}getIgnoreCaret(){const ignoreCaret=this._defaultMatchSettings.getIgnoreCaret();return ignoreCaret||true}close(throwEx=true){const that=this;return that.getPromiseFactory().makePromise((resolve,reject)=>{that._logger.verbose(`"EyesBase.close(${throwEx})`);if(that._isDisabled){that._logger.verbose("Eyes close ignored. (disabled)");that._finallyClose();return resolve(new TestResults)}if(!that._isOpen){that._logger.log(`Close called with Eyes not open`);that._finallyClose();return reject(`Close called with Eyes not open`)}return that._endSession(false,throwEx).then(results=>resolve(results))})}abortIfNotClosed(){const that=this;that._logger.verbose(`"EyesBase.abortIfNotClosed()`);if(that._isDisabled){that._logger.verbose("Eyes abortIfNotClosed ignored. (disabled)");that._finallyClose();return this._promiseFactory.resolve(new TestResults)}if(!that._isOpen){that._logger.log(`Session not open, nothing to do.`);that._finallyClose();return that._promiseFactory.resolve()}return this._endSession(true,false).catch(()=>{})}_endSession(isAborted,throwEx){let serverResults,serverError;const that=this;return that._promiseFactory.makePromise((resolve,reject)=>{that._logger.verbose(`${isAborted?"Aborting":"Closing"} server session...`);that._isOpen=false;that._lastScreenshot=null;that.clearUserInputs();if(!that._runningSession){that._logger.verbose("Server session was not started");that._logger.log("--- Empty test ended.");const testResults=new TestResults;if(that._autSessionId){return that._notifyEvent("testEnded",that._autSessionId,null).then(()=>{that._finallyClose();return testResults})}else{that._finallyClose();return resolve(testResults)}}const isNewSession=that._runningSession.getIsNewSession();const sessionResultsUrl=that._runningSession.getUrl();that._logger.verbose("Ending server session...");const save=!isAborted&&(isNewSession&&that._saveNewTests||!isNewSession&&that._saveFailedTests);that._logger.verbose(`Automatically save test? ${save}`);return that._serverConnector.stopSession(that._runningSession,isAborted,save).then(results=>{results.setIsNew(isNewSession);results.setUrl(sessionResultsUrl);serverResults=results;that._logger.verbose(`Results: ${results}`);const status=results.getStatus();if(status===TestResultsStatus.Unresolved){if(serverResults.getIsNew()){let instructions="Please approve the new baseline at "+sessionResultsUrl;that._logger.log(`--- New test ended. ${instructions}`);if(throwEx){that._finallyClose();const message=`'${that._sessionStartInfo.getScenarioIdOrName()}' of '${that._sessionStartInfo.getAppIdOrName()}'. ${instructions}`;return reject(new NewTestError(results,message))}return resolve(results)}else{let instructions=`See details at ${sessionResultsUrl}`;that._logger.log(`--- Failed test ended. ${instructions}`);if(throwEx){that._finallyClose();const message=`Test '${that._sessionStartInfo.getScenarioIdOrName()}' of '${that._sessionStartInfo.getAppIdOrName()} detected differences!'. ${instructions}`;return reject(new DiffsFoundError(results,message))}return resolve(results)}}else if(status===TestResultsStatus.Failed){let instructions=`See details at ${sessionResultsUrl}`;that._logger.log(`--- Failed test ended. ${instructions}`);if(throwEx){that._finallyClose();const message=`'${that._sessionStartInfo.getScenarioIdOrName()}' of '${that._sessionStartInfo.getAppIdOrName()}'. ${instructions}`;return reject(new TestFailedError(results,message))}return resolve(results)}else{that._logger.log(`--- Test passed. See details at ${sessionResultsUrl}`);return resolve(results)}}).catch(err=>{serverResults=null;that._logger.log(err);return reject(err)})}).catch(err=>{serverError=err}).then(()=>that._notifyEvent("testEnded",that._autSessionId,serverResults)).then(()=>{that._finallyClose();if(serverError){throw serverError}return serverResults})}_finallyClose(){this._matchWindowTask=null;this._autSessionId=null;this._runningSession=null;this._currentAppName=null;this._logger.getLogHandler().close()}_notifyEvent(eventName,...param1){const that=this;return that._promiseFactory.makePromise(resolve=>{that._logger.verbose("Notifying event:",eventName);const notificationPromises=[];that._sessionEventHandlers.forEach(function(handler){const promise=handler[eventName](...param1).then(null,err=>{that._logger.verbose(`'${eventName}' notification handler returned an error: ${err}`)});notificationPromises.push(promise)});that._promiseFactory.all(notificationPromises).then(()=>{resolve()})})}setHostOS(hostOS){this._logger.log(`Host OS: ${hostOS}`);if(hostOS){this._hostOS=hostOS.trim()}else{this._hostOS=null}}getHostOS(){return this._hostOS}setHostApp(hostApp){this._logger.log(`Host OS: ${hostApp}`);if(hostApp){this._hostApp=hostApp.trim()}else{this._hostApp=null}}getHostApp(){return this._hostApp}setBaselineName(baselineName){this._logger.log(`Baseline environment name: ${baselineName}`);if(baselineName){this._baselineEnvName=baselineName.trim()}else{this._baselineEnvName=null}}getBaselineName(){return this._baselineEnvName}setBaselineEnvName(baselineEnvName){this._logger.log(`Baseline environment name: ${baselineEnvName}`);if(baselineEnvName){this._baselineEnvName=baselineEnvName.trim()}else{this._baselineEnvName=null}}getBaselineEnvName(){return this._baselineEnvName}setEnvName(envName){this._logger.log(`Environment name: ${envName}`);if(envName){this._environmentName=envName.trim()}else{this._environmentName=null}}getEnvName(){return this._environmentName}getPositionProvider(){return this._positionProvider}setPositionProvider(positionProvider){this._positionProvider=positionProvider}checkWindowBase(regionProvider,tag="",ignoreMismatch=false,checkSettings=new CheckSettings(EyesBase.USE_DEFAULT_TIMEOUT)){if(this._isDisabled){this._logger.verbose("Ignored");const result=new MatchResult;result.setAsExpected(true);return this._promiseFactory.resolve(result)}ArgumentGuard.isValidState(this._isOpen,"Eyes not open");ArgumentGuard.notNull(regionProvider,"regionProvider");const validationInfo=new SessionEventHandler.ValidationInfo;validationInfo.setValidationId(++this._validationId);validationInfo.setTag(tag);const validationResult=new SessionEventHandler.ValidationResult;const that=this;let matchResult;return that._notifyEvent("validationWillStart",that._autSessionId,validationInfo).then(()=>{return that._matchWindow(regionProvider,tag,ignoreMismatch,checkSettings)}).then(result=>{matchResult=result;that._logger.verbose("MatchWindow Done!");validationResult.setAsExpected(matchResult.getAsExpected());if(!ignoreMismatch){that.clearUserInputs();that._lastScreenshot=matchResult.getScreenshot()}that._validateResult(tag,matchResult);that._logger.verbose("Done!");return that._notifyEvent("validationEnded",that._autSessionId,validationInfo.getValidationId(),validationResult)}).then(()=>{return matchResult})}replaceWindow(stepIndex,screenshot,tag="",title="",userInputs=[]){this._logger.verbose("EyesBase.replaceWindow - running");if(this._isDisabled){this._logger.verbose("Ignored");const result=new MatchResult;result.setAsExpected(true);return this._promiseFactory.resolve(result)}ArgumentGuard.isValidState(this._isOpen,"Eyes not open");this._logger.verbose("EyesBase.replaceWindow - calling serverConnector.replaceWindow");const that=this;return this._promiseFactory.makePromise((resolve,reject)=>{const replaceWindowData=new MatchWindowData(userInputs,new AppOutput(title,screenshot),tag,null,null);return that._serverConnector.replaceWindow(that._runningSession,stepIndex,replaceWindowData).then(result=>{that._logger.verbose("EyesBase.replaceWindow done");resolve(result)},err=>{that._logger.log(err);reject(err)})})}_matchWindow(regionProvider,tag,ignoreMismatch,checkSettings){let retryTimeout=-1;let imageMatchSettings=null;const that=this;return that.getPromiseFactory().resolve().then(()=>{if(checkSettings){retryTimeout=checkSettings.getTimeout();let matchLevel=checkSettings.getMatchLevel();matchLevel=matchLevel?matchLevel:that.getDefaultMatchSettings().getMatchLevel();imageMatchSettings=new ImageMatchSettings(matchLevel,null);return that._collectIgnoreRegions(checkSettings,imageMatchSettings).then(()=>{return that._collectFloatingRegions(checkSettings,imageMatchSettings)}).then(()=>{let ignoreCaret=checkSettings.getIgnoreCaret();imageMatchSettings.setIgnoreCaret(ignoreCaret?ignoreCaret:that.getDefaultMatchSettings().getIgnoreCaret())})}}).then(()=>{that._logger.verbose(`CheckWindowBase(${regionProvider.constructor.name}, '${tag}', ${ignoreMismatch}, ${retryTimeout})`);return regionProvider.getRegion()}).then(region=>{that._logger.verbose("Calling match window...");return that._matchWindowTask.matchWindow(that.getUserInputs(),region,tag,that._shouldMatchWindowRunOnceOnTimeout,ignoreMismatch,imageMatchSettings,retryTimeout)})}_collectIgnoreRegions(checkSettings,imageMatchSettings){const regionPromises=checkSettings.getIgnoreRegions().map(container=>container.getRegion(this),this);return this.getPromiseFactory().all(regionPromises).then(ignoreRegions=>{imageMatchSettings.setIgnoreRegions(ignoreRegions)})}_collectFloatingRegions(checkSettings,imageMatchSettings){const regionPromises=checkSettings.getFloatingRegions().map(container=>container.getRegion(this),this);return this.getPromiseFactory().all(regionPromises).then(floatingRegions=>{imageMatchSettings.setFloatingRegions(floatingRegions)})}_validateResult(tag,result){if(result.getAsExpected()){return}this._shouldMatchWindowRunOnceOnTimeout=true;if(!this._runningSession.getIsNewSession()){this._logger.log(`Mismatch! (${tag})`)}if(this.getFailureReports()===FailureReports.IMMEDIATE){throw new TestFailedError(null,`Mismatch found in '${this._sessionStartInfo.getScenarioIdOrName()}' of '${this._sessionStartInfo.getAppIdOrName()}'`)}}openBase(appName,testName,viewportSize,sessionType){this._logger.getLogHandler().open();if(viewportSize){viewportSize=new RectangleSize(viewportSize)}try{if(this._isDisabled){this._logger.verbose("Eyes Open ignored - disabled");return this._promiseFactory.resolve()}if(!this._appName){ArgumentGuard.notNull(appName,"appName")}ArgumentGuard.notNull(testName,"testName");this._logger.log(`Agent = ${this._getFullAgentId()}`);this._logger.verbose(`openBase('${appName}', '${testName}', '${viewportSize}')`);this._validateApiKey();this._logOpenBase();const that=this;return this._validateSessionOpen().then(()=>{that._isViewportSizeSet=false;that._currentAppName=appName||that._appName;that._testName=testName;that._viewportSizeHandler.set(viewportSize);that._sessionType=sessionType||SessionType.SEQUENTIAL;that._scaleProviderHandler.set(new NullScaleProvider);that._validationId=-1;return that._ensureRunningSession()}).then(()=>{return that.getAUTSessionId()}).then(autSessionId=>{that._autSessionId=autSessionId;that._isOpen=true})}catch(err){this._logger.log(err);this._logger.getLogHandler().close();return this._promiseFactory.reject(err)}}_ensureRunningSession(){if(this._runningSession){return this._promiseFactory.resolve()}const that=this;that._logger.log("No running session, calling start session...");return that.startSession().then(()=>{that._logger.log("Done!");const outputProvider=new AppOutputProvider;outputProvider.getAppOutput=((region,lastScreenshot)=>{return that._getAppOutputWithScreenshot(region,lastScreenshot)});that._matchWindowTask=new MatchWindowTask(that._promiseFactory,that._logger,that._serverConnector,that._runningSession,that._matchTimeout,outputProvider)})}_validateApiKey(){if(!this.getApiKey()){const errMsg="API key is missing! Please set it using setApiKey()";this._logger.log(errMsg);throw new Error(errMsg)}}_logOpenBase(){this._logger.log(`Eyes server URL is '${this._serverConnector.getServerUrl()}'`);this._logger.verbose(`Timeout = '${this._serverConnector.getTimeout()}'`);this._logger.log(`matchTimeout = '${this._matchTimeout}'`);this._logger.log(`Default match settings = '${this._defaultMatchSettings}'`);this._logger.log(`FailureReports = '${this._failureReports}'`)}_validateSessionOpen(){if(this._isOpen){return this.abortIfNotClosed().then(()=>{const errMsg="A test is already running";this._logger.log(errMsg);throw new Error(errMsg)})}return this._promiseFactory.resolve()}setExplicitViewportSize(explicitViewportSize){if(!explicitViewportSize){this._viewportSizeHandler=new SimplePropertyHandler;this._viewportSizeHandler.set(null);this._isViewportSizeSet=false;return}this._logger.verbose("Viewport size explicitly set to "+explicitViewportSize);this._viewportSizeHandler=new ReadOnlyPropertyHandler(this._logger,new RectangleSize(explicitViewportSize.getWidth(),explicitViewportSize.getHeight()));this._isViewportSizeSet=true}addUserInput(trigger){if(this._isDisabled){return}ArgumentGuard.notNull(trigger,"trigger");this._userInputs.push(trigger)}addTextTriggerBase(control,text){if(this._isDisabled){this._logger.verbose(`Ignoring '${text}' (disabled)`);return}ArgumentGuard.notNull(control,"control");ArgumentGuard.notNull(text,"text");control=new Region(control);if(!this._lastScreenshot){this._logger.verbose(`Ignoring '${text}' (no screenshot)`);return}control=this._lastScreenshot.getIntersectedRegion(control,CoordinatesType.CONTEXT_RELATIVE,CoordinatesType.SCREENSHOT_AS_IS);if(control.isEmpty()){this._logger.verbose(`Ignoring '${text}' (out of bounds)`);return}const trigger=new TextTrigger(control,text);this._userInputs.push(trigger);this._logger.verbose(`Added ${trigger}`)}addMouseTriggerBase(action,control,cursor){if(this._isDisabled){this._logger.verbose(`Ignoring ${action} (disabled)`);return}ArgumentGuard.notNull(action,"action");ArgumentGuard.notNull(control,"control");ArgumentGuard.notNull(cursor,"cursor");if(!this._lastScreenshot){this._logger.verbose(`Ignoring ${action} (no screenshot)`);return}let cursorInScreenshot=new Location(cursor);cursorInScreenshot.offsetByLocation(control.getLocation());try{cursorInScreenshot=this._lastScreenshot.getLocationInScreenshot(cursorInScreenshot,CoordinatesType.CONTEXT_RELATIVE)}catch(err){if(err instanceof OutOfBoundsError){this._logger.verbose(`"Ignoring ${action} (out of bounds)`);return}throw err}const controlScreenshotIntersect=this._lastScreenshot.getIntersectedRegion(control,CoordinatesType.CONTEXT_RELATIVE,CoordinatesType.SCREENSHOT_AS_IS);if(!controlScreenshotIntersect.isEmpty()){const l=controlScreenshotIntersect.location;cursorInScreenshot.offset(-l.x,-l.y)}const trigger=new MouseTrigger(action,controlScreenshotIntersect,cursorInScreenshot);this._userInputs.push(trigger)}getAppEnvironment(){const appEnv=new AppEnvironment;if(this._hostOS){appEnv.setOs(this._hostOS)}if(this._hostApp){appEnv.setHostingApp(this._hostApp)}const that=this;return this.getInferredEnvironment().then(inferred=>{appEnv.setInferred(inferred);appEnv.setDisplaySize(that._viewportSizeHandler.get());return appEnv})}startSession(){this._logger.verbose("startSession()");if(this._runningSession){return this._promiseFactory.resolve()}const that=this;let testBatch,appEnvironment;if(that._batch){that._logger.verbose(`Batch is ${that._batch}`);testBatch=that._batch}else{that._logger.verbose("No batch set");testBatch=new BatchInfo}return that.getAUTSessionId().then(autSessionId=>{that._autSessionId=autSessionId}).then(()=>{return that._notifyEvent("testStarted",that._autSessionId)}).then(()=>{return that._notifyEvent("setSizeWillStart",that._autSessionId,that._viewportSize)}).then(()=>{return that._ensureViewportSize()}).then(()=>{return that._notifyEvent("setSizeEnded",that._autSessionId)},err=>{that._logger.log(err);return that._notifyEvent("setSizeEnded",that._autSessionId).then(()=>{throw new Error("Failed to set/get viewport size.")})}).then(()=>{return that._notifyEvent("initStarted",that._autSessionId)}).then(()=>{return that.getAppEnvironment()}).then(appEnv=>{appEnvironment=appEnv;that._logger.verbose(`Application environment is ${appEnvironment}`);return that._notifyEvent("initEnded",that._autSessionId)}).then(()=>{that._sessionStartInfo=new SessionStartInfo(that.getBaseAgentId(),that._sessionType,that.getAppName(),null,that._testName,testBatch,that._baselineEnvName,that._environmentName,appEnvironment,that._defaultMatchSettings,that._branchName,that._parentBranchName,that._properties);that._logger.verbose("Starting server session...");return that._serverConnector.startSession(that._sessionStartInfo)}).then(runningSession=>{that._runningSession=runningSession;that._logger.verbose(`Server session ID is ${that._runningSession.getId()}`);const testInfo=`'${that._testName}' of '${that.getAppName()}' "${appEnvironment}`;if(that._runningSession.getIsNewSession()){that._logger.log(`--- New test started - ${testInfo}`);that._shouldMatchWindowRunOnceOnTimeout=true}else{that._logger.log(`--- Test started - ${testInfo}`);that._shouldMatchWindowRunOnceOnTimeout=false}})}_ensureViewportSize(){if(!this._isViewportSizeSet){try{if(this._viewportSizeHandler.get()){return this.setViewportSize(this._viewportSizeHandler.get())}else{const that=this;if(!(this._viewportSizeHandler instanceof ReadOnlyPropertyHandler)){return this.getViewportSize().then(viewportSize=>{that._viewportSizeHandler.set(viewportSize)})}}this._isViewportSizeSet=true}catch(ignored){this._isViewportSizeSet=false}}return this._promiseFactory.resolve()}_getAppOutputWithScreenshot(region,lastScreenshot){const that=this;that._logger.verbose("getting screenshot...");let scr,compressedScr;return that.getScreenshot().then(screenshot=>{that._logger.verbose("Done getting screenshot!");if(!region.isEmpty()){return screenshot.getSubScreenshot(region,false)}return screenshot}).then(screenshot=>{scr=screenshot;return that._debugScreenshotsProvider.save(screenshot.getImage(),"SUB_SCREENSHOT")}).then(()=>{that._logger.verbose("Compressing screenshot...");return that._compressScreenshot64(scr,lastScreenshot)}).then(compressedScreenshot=>{compressedScr=compressedScreenshot;that._logger.verbose("Done! Getting title...");return that.getTitle()}).then(title=>{that._logger.verbose("Done!");const result=new AppOutputWithScreenshot(new AppOutput(title,compressedScr),scr);that._logger.verbose("Done!");return result})}_compressScreenshot64(screenshot,lastScreenshot){ArgumentGuard.notNull(screenshot,"screenshot");let targetData,sourceData;return this._promiseFactory.makePromise(resolve=>{if(lastScreenshot){return lastScreenshot.getImage().getImageData().then(imageData=>{sourceData=imageData;return screenshot.getImage().getImageData()}).then(imageData=>{targetData=imageData;resolve()})}else{resolve()}}).then(()=>{return screenshot.getImage().getImageBuffer()}).then(targetBuffer=>{try{return ImageDeltaCompressor.compressByRawBlocks(targetData,targetBuffer,sourceData)}catch(err){throw new Error(`Failed to compress screenshot! ${err}`)}})}addSessionEventHandler(eventHandler){eventHandler.promiseFactory=this._promiseFactory;this._sessionEventHandlers.push(eventHandler)}setRemoveSession(shouldRemove){this._serverConnector.setRemoveSession(shouldRemove)}getRemoveSession(){return this._serverConnector.getRemoveSession()}getTestName(){return this._testName}getRunningSession(){return this._runningSession}getBaseAgentId(){throw new TypeError("getBaseAgentId method is not implemented!")}getAUTSessionId(){throw new TypeError("getAUTSessionId method is not implemented!")}getViewportSize(){throw new TypeError("getViewportSize method is not implemented!")}setViewportSize(size){throw new TypeError("setViewportSize method is not implemented!")}getInferredEnvironment(){throw new TypeError("getInferredEnvironment method is not implemented!")}getScreenshot(){throw new TypeError("getScreenshot method is not implemented!")}getTitle(){throw new TypeError("getTitle method is not implemented!")}getPromiseFactory(){return this._promiseFactory}}EyesBase.DEFAULT_EYES_SERVER="https://eyesapi.applitools.com";EyesBase.USE_DEFAULT_TIMEOUT=-1;module.exports=EyesBase},{"./AppEnvironment":95,"./ArgumentGuard":96,"./BatchInfo":97,"./FailureReports":101,"./GeneralUtils":102,"./MatchWindowTask":103,"./PromiseFactory":105,"./SessionEventHandler":107,"./capture/AppOutput":110,"./capture/AppOutputProvider":111,"./capture/AppOutputWithScreenshot":112,"./cutting/NullCutProvider":117,"./debug/FileDebugScreenshotsProvider":120,"./debug/NullDebugScreenshotProvider":121,"./errors/DiffsFoundError":123,"./errors/EyesError":124,"./errors/NewTestError":125,"./errors/OutOfBoundsError":126,"./errors/TestFailedError":127,"./fluent/CheckSettings":128,"./handlers/ReadOnlyPropertyHandler":135,"./handlers/SimplePropertyHandler":136,"./images/ImageDeltaCompressor":138,"./logging/Logger":144,"./match/ImageMatchSettings":147,"./match/MatchLevel":148,"./match/MatchWindowData":149,"./positioning/CoordinatesType":151,"./positioning/InvalidPositionProvider":153,"./positioning/Location":154,"./positioning/RectangleSize":158,"./positioning/Region":159,"./scaling/FixedScaleProvider":163,"./scaling/NullScaleProvider":165,"./server/MatchResult":169,"./server/PropertyData":170,"./server/ServerConnector":173,"./server/SessionStartInfo":174,"./server/SessionType":175,"./server/TestResults":176,"./server/TestResultsStatus":177,"./triggers/MouseTrigger":178,"./triggers/TextTrigger":179}],100:[function(require,module,exports){"use strict";class EyesJsExecutor{executeScript(script,...var_args){}sleep(ms){}}module.exports=EyesJsExecutor},{}],101:[function(require,module,exports){"use strict";const FailureReports={IMMEDIATE:"Immediate",ON_CLOSE:"OnClose"};Object.freeze(FailureReports);module.exports=FailureReports},{}],102:[function(require,module,exports){"use strict";const dateformat=require("dateformat");const isBuffer=require("is-buffer");const DATE_FORMAT_ISO8601="yyyy-mm-dd'T'HH:MM:ss'Z'";const DATE_FORMAT_RFC1123="ddd, dd mmm yyyy HH:MM:ss 'GMT'";class GeneralUtils{static urlConcat(url,suffix){let left=url;if(url.lastIndexOf("/")===url.length-1){left=url.slice(0,url.length-1)}if(suffix.indexOf("/")===0){return left+suffix}return left+"/"+suffix}static toJson(o){return JSON.stringify(o)}static mixin(to,from){let index,protos=[],proto=from;while(!!proto){protos.push(Object.getOwnPropertyNames(proto));proto=Object.getPrototypeOf(proto)}for(index=protos.length-2;index>=0;index--){protos[index].forEach(function(method){if(!to[method]&&typeof from[method]==="function"&&method!=="constructor"){_mixin(to,from,method)}})}}static guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const r=Math.random()*16|0;const v=c==="x"?r:r&3|8;return v.toString(16)})}static clone(obj){if(obj==null||typeof obj!=="object"){return obj}if(obj instanceof Date){return new Date(obj.getTime())}if(obj instanceof Array){return Array.from(obj)}if(obj instanceof Object){const copy=obj.constructor();for(const attr in obj){if(obj.hasOwnProperty(attr)){copy[attr]=GeneralUtils.clone(obj[attr])}}return copy}throw new Error("Unable to copy object! Its type isn't supported.")}static definePropertyWithDefaultConfig(obj,name,getFunc,setFunc){Object.defineProperty(obj,name,{enumerable:true,configurable:true,get:getFunc,set:setFunc})}static defineStandardProperty(obj,name){const getFunc=function get(){return this[`_${name}`]};const setFunc=function set(v){this[`_${name}`]=v};GeneralUtils.definePropertyWithDefaultConfig(obj,name,getFunc,setFunc)}static sleep(ms,promiseFactory){return promiseFactory.makePromise(resolve=>{setTimeout(()=>{resolve()},ms)})}static getIso8601Data(date=new Date){return dateformat(date,DATE_FORMAT_ISO8601)}static getRfc1123Date(date=new Date){return dateformat(date,DATE_FORMAT_RFC1123)}static stringify(...args){return args.map(function(arg){if(typeof arg==="object"){return GeneralUtils.toJson(arg)}return arg}).join(" ")}static currentTimeMillis(){return(new Date).getTime()}static isString(value){return typeof value==="string"||value instanceof String}static isNumber(value){return typeof value==="number"||value instanceof Number}static isBoolean(value){return typeof value==="boolean"||value instanceof Boolean}static isBuffer(value){return isBuffer(value)}}function _mixin(to,from,fnName){to[fnName]=function(){return from[fnName].apply(from,arguments)}}module.exports=GeneralUtils},{dateformat:85,"is-buffer":86}],103:[function(require,module,exports){"use strict";const Region=require("./positioning/Region");const ArgumentGuard=require("./ArgumentGuard");const GeneralUtils=require("./GeneralUtils");const MatchWindowData=require("./match/MatchWindowData");const MATCH_INTERVAL=500;class MatchWindowTask{constructor(promiseFactory,logger,serverConnector,runningSession,retryTimeout,appOutputProvider){ArgumentGuard.notNull(serverConnector,"serverConnector");ArgumentGuard.notNull(runningSession,"runningSession");ArgumentGuard.greaterThanOrEqualToZero(retryTimeout,"retryTimeout");ArgumentGuard.notNull(appOutputProvider,"appOutputProvider");this._promiseFactory=promiseFactory;this._logger=logger;this._serverConnector=serverConnector;this._runningSession=runningSession;this._defaultRetryTimeout=retryTimeout;this._appOutputProvider=appOutputProvider;this._lastScreenshot=undefined;this._matchResult=undefined;this._lastScreenshotBounds=undefined}performMatch(userInputs,appOutput,tag,ignoreMismatch,imageMatchSettings){const options=new MatchWindowData.Options(tag,userInputs,ignoreMismatch,false,false,false,imageMatchSettings);const data=new MatchWindowData(userInputs,appOutput.getAppOutput(),tag,ignoreMismatch,options);return this._serverConnector.matchWindow(this._runningSession,data)}matchWindow(userInputs,region,tag,shouldRunOnceOnTimeout,ignoreMismatch,imageMatchSettings,retryTimeout){if(!retryTimeout||retryTimeout<0){retryTimeout=this._defaultRetryTimeout}const that=this;this._logger.verbose(`retryTimeout = ${retryTimeout}`);return that._takeScreenshot(userInputs,region,tag,shouldRunOnceOnTimeout,ignoreMismatch,imageMatchSettings,retryTimeout).then(screenshot=>{if(ignoreMismatch){return that._matchResult}that._updateLastScreenshot(screenshot);that._updateBounds(region);return that._matchResult})}_takeScreenshot(userInputs,region,tag,shouldRunOnceOnTimeout,ignoreMismatch,imageMatchSettings,retryTimeout){const that=this;const elapsedTimeStart=GeneralUtils.currentTimeMillis();let promise=this._promiseFactory.resolve();if(retryTimeout===0||shouldRunOnceOnTimeout){if(shouldRunOnceOnTimeout){promise=promise.then(()=>{return GeneralUtils.sleep(retryTimeout,that._promiseFactory)})}promise=promise.then(()=>{return that._tryTakeScreenshot(userInputs,region,tag,ignoreMismatch,imageMatchSettings)})}else{promise=promise.then(()=>{return that._retryTakingScreenshot(userInputs,region,tag,ignoreMismatch,imageMatchSettings,retryTimeout)})}return promise.then(screenshot=>{const elapsedTime=(GeneralUtils.currentTimeMillis()-elapsedTimeStart)/1e3;that._logger.verbose(`Completed in ${elapsedTime} seconds`);return screenshot})}_retryTakingScreenshot(userInputs,region,tag,ignoreMismatch,imageMatchSettings,retryTimeout){const that=this;const start=GeneralUtils.currentTimeMillis();const retry=GeneralUtils.currentTimeMillis()-start;return that._takingScreenshotLoop(userInputs,region,tag,ignoreMismatch,imageMatchSettings,retryTimeout,retry,start).then(screenshot=>{if(!this._matchResult.getAsExpected()){return this._tryTakeScreenshot(userInputs,region,tag,ignoreMismatch,imageMatchSettings)}return screenshot})}_takingScreenshotLoop(userInputs,region,tag,ignoreMismatch,imageMatchSettings,retryTimeout,retry,start,screenshot){if(retry>=retryTimeout){return this._promiseFactory.resolve(screenshot)}const that=this;return GeneralUtils.sleep(MATCH_INTERVAL,that._promiseFactory).then(()=>{return that._tryTakeScreenshot(userInputs,region,tag,true,imageMatchSettings).then(screenshot=>{if(that._matchResult.getAsExpected()){return screenshot}else{return that._takingScreenshotLoop(userInputs,region,tag,ignoreMismatch,imageMatchSettings,retryTimeout,GeneralUtils.currentTimeMillis()-start,start,screenshot)}})})}_tryTakeScreenshot(userInputs,region,tag,ignoreMismatch,imageMatchSettings){const that=this;return that._appOutputProvider.getAppOutput(region,that._lastScreenshot).then(appOutput=>{const screenshot=appOutput.getScreenshot();return that.performMatch(userInputs,appOutput,tag,ignoreMismatch,imageMatchSettings).then(matchResult=>{that._matchResult=matchResult;return screenshot})})}_updateLastScreenshot(screenshot){if(screenshot){this._lastScreenshot=screenshot}}_updateBounds(region){if(region.isEmpty()){if(!this._lastScreenshot){this._lastScreenshotBounds=new Region(0,0,Number.MAX_VALUE,Number.MAX_VALUE)}else{this._lastScreenshotBounds=new Region(0,0,this._lastScreenshot.getImage().getWidth(),this._lastScreenshot.getImage().getHeight())}}else{this._lastScreenshotBounds=region}return this._promiseFactory.resolve()}getLastScreenshotBounds(){return this._lastScreenshotBounds}}module.exports=MatchWindowTask},{"./ArgumentGuard":96,"./GeneralUtils":102,"./match/MatchWindowData":149,"./positioning/Region":159}],104:[function(require,module,exports){"use strict";class OSNames{}OSNames.Unknown="Unknown";OSNames.Windows="Windows";OSNames.IOS="IOS";OSNames.Macintosh="Macintosh";OSNames.ChromeOS="ChromeOS";module.exports=OSNames},{}],105:[function(require,module,exports){"use strict";class PromiseFactory{constructor(promiseFactoryFunc){this._promiseFactoryFunc=promiseFactoryFunc}setFactoryMethod(promiseFactoryFunc){this._promiseFactoryFunc=promiseFactoryFunc}getFactoryMethod(){return this._promiseFactoryFunc}makePromise(executor){if(this._promiseFactoryFunc){return this._promiseFactoryFunc(executor)}throw new Error("Promise factory was not initialized with proper callback")}resolve(value){return this.makePromise(resolve=>{resolve(value)})}reject(value){return this.makePromise((resolve,reject)=>{reject(value)})}race(iterable){return this.makePromise((resolve,reject)=>{for(let i=0,len=iterable.length;i<len;i++){iterable[i].then(resolve,reject)}})}all(iterable){const args=Array.prototype.slice.call(iterable);return this.makePromise((resolve,reject)=>{if(args.length===0){return resolve([])}let remaining=args.length;function resolveFn(curr,i){try{if(curr&&(typeof curr==="object"||typeof curr==="function")&&typeof curr.then==="function"){curr.then.call(curr,val=>resolveFn(val,i),reject);return}args[i]=curr;--remaining;if(remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(let i=0;i<args.length;i++){resolveFn(args[i],i)}})}}module.exports=PromiseFactory},{}],106:[function(require,module,exports){"use strict";const axios=require("axios");const GeneralUtils=require("./GeneralUtils");const SessionEventHandler=require("./SessionEventHandler");const DEFAULT_CONNECTION_TIMEOUT_MS=3e4;const SERVER_SUFFIX="/applitools/sessions";module.exports.createSessionEventHandler=((serverUrl,accessKey)=>{const sessionHandler=SessionEventHandler.createSessionEventHandler();sessionHandler._defaultHttpOptions={strictSSL:false,baseUrl:GeneralUtils.urlConcat(serverUrl,SERVER_SUFFIX),json:true,qs:{}};GeneralUtils.definePropertyWithDefaultConfig(sessionHandler,"timeout",function(){return this._defaultHttpOptions.timeout},function(timeout){this._defaultHttpOptions.timeout=timeout});GeneralUtils.definePropertyWithDefaultConfig(sessionHandler,"serverUrl",function(){return this._serverUrl},function(serverUrl){this._serverUrl=serverUrl;this._defaultHttpOptions.baseUrl=GeneralUtils.urlConcat(serverUrl,SERVER_SUFFIX)});GeneralUtils.definePropertyWithDefaultConfig(sessionHandler,"accessKey",function(){return this._defaultHttpOptions.qs.accessKey},function(accessKey){this._defaultHttpOptions.qs.accessKey=accessKey});sessionHandler.timeout=DEFAULT_CONNECTION_TIMEOUT_MS;sessionHandler.serverUrl=serverUrl;sessionHandler.accessKey=accessKey;const _sendNotification=(requestOptions,resolve,reject)=>axios(requestOptions).then(()=>resolve(response.statusCode)).catch(err=>reject(err));sessionHandler.testStarted=function(autSessionId){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri="";options.data={autSessionId:autSessionId};options.method="post";_sendNotification(options,resolve,reject)})};sessionHandler.testEnded=function(autSessionId,testResults){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=autSessionId;options.data={action:"testEnd",testResults:testResults};options.method="put";_sendNotification(options,resolve,reject)})};sessionHandler.initStarted=function(autSessionId){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=autSessionId;options.data={action:"initStart"};options.method="put";_sendNotification(options,resolve,reject)})};sessionHandler.initEnded=function(autSessionId){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=autSessionId;options.data={action:"initEnd"};options.method="put";_sendNotification(options,resolve,reject)})};sessionHandler.setSizeWillStart=function(autSessionId,size){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=autSessionId;options.data={action:"setSizeStart",size:size};options.method="put";_sendNotification(options,resolve,reject)})};sessionHandler.setSizeEnded=function(autSessionId){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=autSessionId;options.data={action:"setSizeEnd"};options.method="put";_sendNotification(options,resolve,reject)})};sessionHandler.validationWillStart=function(autSessionId,validationInfo){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=`${autSessionId}/validations`;options.data=validationInfo.toObject();options.method="post";_sendNotification(options,resolve,reject)})};sessionHandler.validationEnded=function(autSessionId,validationId,validationResult){return this._promiseFactory.makePromise((resolve,reject)=>{const options=Object.create(this._defaultHttpOptions);options.uri=`${autSessionId}/validations/${validationId}`;options.data={action:"validationEnd",asExpected:validationResult.asExpected};options.method="put";_sendNotification(options,resolve,reject)})};return sessionHandler})},{"./GeneralUtils":102,"./SessionEventHandler":107,axios:60}],107:[function(require,module,exports){"use strict";const GeneralUtils=require("./GeneralUtils");class ValidationInfo{constructor(){this._validationId=null;this._tag=null}setValidationId(value){this._validationId=value}getValidationId(){return this._validationId}setTag(value){this._tag=value}getTag(){return this._tag}toObject(){return{validationId:this._validationId,tag:this._tag}}}GeneralUtils.defineStandardProperty(ValidationInfo.prototype,"validationId");GeneralUtils.defineStandardProperty(ValidationInfo.prototype,"tag");class ValidationResult{constructor(){this._asExpected=null}setAsExpected(value){this._asExpected=value}getAsExpected(){return this._asExpected}}GeneralUtils.defineStandardProperty(ValidationResult.prototype,"asExpected");const _baseSessionEventHandler={initStarted(){},initEnded(){},setSizeWillStart(sizeToSet){},setSizeEnded(){},testStarted(autSessionId){},testEnded(autSessionId,testResults){},validationWillStart(autSessionId,validationInfo){},validationEnded(autSessionId,validationId,validationResult){}};GeneralUtils.defineStandardProperty(_baseSessionEventHandler,"promiseFactory");const createSessionEventHandler=()=>Object.create(_baseSessionEventHandler);module.exports.ValidationInfo=ValidationInfo;module.exports.ValidationResult=ValidationResult;module.exports.createSessionEventHandler=createSessionEventHandler},{"./GeneralUtils":102}],108:[function(require,module,exports){(function(Buffer){"use strict";const Stream=require("stream");class ReadableBufferStream extends Stream.Readable{constructor(buffer,options){super(options);this._buffer=buffer}_read(){this.push(this._buffer);this.push(null)}}class WritableBufferStream extends Stream.Writable{constructor(options){super(options);this._buffer=new Buffer(0)}_write(chunk,enc,next){const chunkAsBuffer=Buffer.isBuffer(chunk)?chunk:new Buffer(chunk,enc);this._buffer=Buffer.concat([this._buffer,chunkAsBuffer]);next()}writeInt(value){const buf=new Buffer(4);buf.writeInt32BE(value,0);return this.write(buf)}writeShort(value){const buf=new Buffer(2);buf.writeInt16BE(value,0);return this.write(buf)}writeByte(value){const buf=new Buffer(1);buf.writeInt8(value,0);return this.write(buf)}getBuffer(){return this._buffer}resetBuffer(){const buffer=this._buffer;this._buffer=new Buffer(0);return buffer}}module.exports={ReadableBufferStream:ReadableBufferStream,WritableBufferStream:WritableBufferStream}}).call(this,require("buffer").Buffer)},{buffer:9,stream:48}],109:[function(require,module,exports){"use strict";const ArgumentGuard=require("./ArgumentGuard");const BrowserNames=require("./BrowserNames");const OSNames=require("./OSNames");const MAJOR_MINOR="([^ .;_)]+)[_.]([^ .;_)]+)";const PRODUCT="(?:(%s)/"+MAJOR_MINOR+")";const VALUES_FOR_BROWSER_REGEX_EXCEPT_IE=["Opera","Chrome","Safari","Firefox","Edge"];const IE_BROWSER_REGEX=new RegExp("(?:MS(IE) "+MAJOR_MINOR+")");const getBrowserRegexes=()=>{const browserRegexes=[];for(let i=0;i<VALUES_FOR_BROWSER_REGEX_EXCEPT_IE.length;++i){const browser=VALUES_FOR_BROWSER_REGEX_EXCEPT_IE[i];browserRegexes.push(new RegExp(PRODUCT.replace("%s",browser)))}browserRegexes.push(IE_BROWSER_REGEX);return browserRegexes};const VERSION_REGEX=new RegExp(PRODUCT.replace("%s","Version"));const OS_REGEXES=[new RegExp("(?:(Windows) NT "+MAJOR_MINOR+")"),new RegExp("(?:(Windows XP))"),new RegExp("(?:(Windows 2000))"),new RegExp("(?:(Windows NT))"),new RegExp("(?:(Windows))"),new RegExp("(?:(Mac OS X) "+MAJOR_MINOR+")"),new RegExp("(?:(Android) "+MAJOR_MINOR+")"),new RegExp("(?:(CPU(?: i[a-zA-Z]+)? OS) "+MAJOR_MINOR+")"),new RegExp("(?:(Mac OS X))"),new RegExp("(?:(Mac_PowerPC))"),new RegExp("(?:(Linux))"),new RegExp("(?:(CrOS))"),new RegExp("(?:(SymbOS))")];const HIDDEN_IE_REGEX=new RegExp("(?:(?:rv:"+MAJOR_MINOR+"\\) like Gecko))");const EDGE_REGEX=new RegExp(PRODUCT.replace("%s","Edge"));class UserAgent{constructor(){this._OS=undefined;this._OSMajorVersion=undefined;this._OSMinorVersion=undefined;this._browser=undefined;this._browserMajorVersion=undefined;this._browserMinorVersion=undefined}static parseUserAgentString(userAgent,unknowns){ArgumentGuard.notNull(userAgent,"userAgent");userAgent=userAgent.trim();const result=new UserAgent;const oss=new Map;const matchers=[];for(let i=0;i<OS_REGEXES.length;i++){if(OS_REGEXES[i].test(userAgent)){matchers.push(OS_REGEXES[i].exec(userAgent));break}}for(let i=0;i<matchers.length;i++){const os=matchers[i][1];if(os){oss.set(os.toLowerCase(),matchers[i])}}let osmatch=null;if(matchers.length===0){if(unknowns){result._OS=OSNames.Unknown}else{throw new TypeError("Unknown OS: "+userAgent)}}else{if(oss.size>1&&oss.has("android")){osmatch=oss.get("android")}else{osmatch=Array.from(oss.values())[0]}result._OS=osmatch[1];if(osmatch.length>1){result._OSMajorVersion=osmatch[2];result._OSMinorVersion=osmatch[3]}}if(result._OS.startsWith("CPU")){result._OS=OSNames.IOS}else if(result._OS==="Windows XP"){result._OS=OSNames.Windows;result._OSMajorVersion="5";result._OSMinorVersion="1"}else if(result._OS==="Windows 2000"){result._OS=OSNames.Windows;result._OSMajorVersion="5";result._OSMinorVersion="0"}else if(result._OS==="Windows NT"){result._OS=OSNames.Windows;result._OSMajorVersion="4";result._OSMinorVersion="0"}else if(result._OS==="Mac_PowerPC"){result._OS=OSNames.Macintosh}else if(result._OS==="CrOS"){result._OS=OSNames.ChromeOS}let browserOK=false;const browserRegexes=getBrowserRegexes();for(let i=0;i<browserRegexes.length;i++){if(browserRegexes[i].test(userAgent)){const matcher=browserRegexes[i].exec(userAgent);result._browser=matcher[1];result._browserMajorVersion=matcher[2];result._browserMinorVersion=matcher[3];browserOK=true;break}}if(result._OS===OSNames.Windows){if(EDGE_REGEX.test(userAgent)){const edgeMatch=browserRegexes[i].exec(userAgent);result._browser=BrowserNames.Edge;result._browserMajorVersion=edgeMatch[2];result._browserMinorVersion=edgeMatch[3]}if(HIDDEN_IE_REGEX.test(userAgent)){const iematch=HIDDEN_IE_REGEX.exec(userAgent);result._browser=BrowserNames.IE;result._browserMajorVersion=iematch[2];result._browserMinorVersion=iematch[3];browserOK=true}}if(!browserOK){if(unknowns){result._browser="Unknown"}else{throw new TypeError("Unknown browser: "+userAgent)}}if(VERSION_REGEX.test(userAgent)){const versionMatch=VERSION_REGEX.exec(userAgent);result._browserMajorVersion=versionMatch.group("major");result._browserMinorVersion=versionMatch.group("minor")}return result}getBrowser(){return this._browser}getBrowserMajorVersion(){return this._browserMajorVersion}getBrowserMinorVersion(){return this._browserMinorVersion}getOS(){return this._OS}getOSMajorVersion(){return this._OSMajorVersion}getOSMinorVersion(){return this._OSMinorVersion}}module.exports=UserAgent},{"./ArgumentGuard":96,"./BrowserNames":98,"./OSNames":104}],110:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");class AppOutput{constructor(title,screenshot64){this._title=title;this._screenshot64=screenshot64}getTitle(){return this._title}getScreenshot64(){return this._screenshot64}toJSON(){return{title:this._title}}toString(){return`AppOutput { ${GeneralUtils.toJson(this)} }`}}module.exports=AppOutput},{"../GeneralUtils":102}],111:[function(require,module,exports){"use strict";class AppOutputProvider{getAppOutput(region,lastScreenshot){throw new TypeError("The method `getAppOutput` from `AppOutputProvider` should be implemented!")}}module.exports=AppOutputProvider},{}],112:[function(require,module,exports){"use strict";class AppOutputWithScreenshot{constructor(appOutput,screenshot){this._appOutput=appOutput;this._screenshot=screenshot}getAppOutput(){return this._appOutput}getScreenshot(){return this._screenshot}}module.exports=AppOutputWithScreenshot},{}],113:[function(require,module,exports){"use strict";class EyesScreenshotFactory{makeScreenshot(image){}}module.exports=EyesScreenshotFactory},{}],114:[function(require,module,exports){"use strict";class ImageProvider{getImage(){}}module.exports=ImageProvider},{}],115:[function(require,module,exports){"use strict";class CutProvider{cut(image){}scale(scaleRatio){}}module.exports=CutProvider},{}],116:[function(require,module,exports){"use strict";const Region=require("../positioning/Region");const CutProvider=require("./CutProvider");class FixedCutProvider extends CutProvider{constructor(header,footer,left,right){super();this._header=header;this._footer=footer;this._left=left;this._right=right}cut(image){const that=this;let promise=image.resolve();if(this._header>0){promise=promise.then(()=>{const region=new Region(0,that._header,image.getWidth(),image.getHeight()-that._header);return image.crop(region)})}if(this._footer>0){promise=promise.then(()=>{const region=new Region(0,0,image.getWidth(),image.getHeight()-that._footer);return image.crop(region)})}if(this._left>0){promise=promise.then(()=>{const region=new Region(that._left,0,image.getWidth()-that._left,image.getHeight());return image.crop(region)})}if(this._right>0){promise=promise.then(()=>{const region=new Region(0,0,image.getWidth()-that._right,image.getHeight());return image.crop(region)})}return promise}scale(scaleRatio){const scaledHeader=Math.ceil(this._header*scaleRatio);const scaledFooter=Math.ceil(this._footer*scaleRatio);const scaledLeft=Math.ceil(this._left*scaleRatio);const scaledRight=Math.ceil(this._right*scaleRatio);return new FixedCutProvider(scaledHeader,scaledFooter,scaledLeft,scaledRight)}}module.exports=FixedCutProvider},{"../positioning/Region":159,"./CutProvider":115}],117:[function(require,module,exports){"use strict";const FixedCutProvider=require("./FixedCutProvider");class NullCutProvider extends FixedCutProvider{constructor(){super(0,0,0,0)}}module.exports=NullCutProvider},{"./FixedCutProvider":116}],118:[function(require,module,exports){"use strict";const Region=require("../positioning/Region");const CutProvider=require("./CutProvider");class UnscaledFixedCutProvider extends CutProvider{constructor(header,footer,left,right){super();this._header=header;this._footer=footer;this._left=left;this._right=right}cut(image){const that=this;let promise=image.resolve();if(this._header>0){promise=promise.then(()=>{const region=new Region(0,that._header,image.getWidth(),image.getHeight()-that._header);return image.crop(region)})}if(this._footer>0){promise=promise.then(()=>{const region=new Region(0,0,image.getWidth(),image.getHeight()-that._footer);return image.crop(region)})}if(this._left>0){promise=promise.then(()=>{const region=new Region(that._left,0,image.getWidth()-that._left,image.getHeight());return image.crop(region)})}if(this._right>0){promise=promise.then(()=>{const region=new Region(0,0,image.getWidth()-that._right,image.getHeight());return image.crop(region)})}return promise}scale(scaleRatio){return new UnscaledFixedCutProvider(this._header,this._footer,this._left,this._right)}}module.exports=UnscaledFixedCutProvider},{"../positioning/Region":159,"./CutProvider":115}],119:[function(require,module,exports){"use strict";const DEFAULT_PREFIX="screenshot_";const DEFAULT_PATH="";class DebugScreenshotsProvider{constructor(){this._prefix=DEFAULT_PREFIX;this._path=null}getPrefix(){return this._prefix}setPrefix(value){this._prefix=value||DEFAULT_PREFIX}getPath(){return this._path}setPath(value){if(value){value=value.endsWith("/")?value:value+"/"}else{value=DEFAULT_PATH}this._path=value}save(image,suffix){}}module.exports=DebugScreenshotsProvider},{}],120:[function(require,module,exports){"use strict";const dateformat=require("dateformat");const DebugScreenshotsProvider=require("./DebugScreenshotsProvider");const DATE_FORMAT="yyyy_mm_dd_HH_MM_ss_l";class FileDebugScreenshotsProvider extends DebugScreenshotsProvider{save(image,suffix){const filename=this._path+this._prefix+this.getFormattedTimeStamp()+"_"+suffix+".png";return image.save(filename.replace(" ","_"))}getFormattedTimeStamp(){return dateformat(new Date,DATE_FORMAT)}}module.exports=FileDebugScreenshotsProvider},{"./DebugScreenshotsProvider":119,dateformat:85}],121:[function(require,module,exports){"use strict";const DebugScreenshotsProvider=require("./DebugScreenshotsProvider");class NullDebugScreenshotProvider extends DebugScreenshotsProvider{save(image,suffix){}}module.exports=NullDebugScreenshotProvider},{"./DebugScreenshotsProvider":119}],122:[function(require,module,exports){"use strict";const EyesError=require("./EyesError");class CoordinatesTypeConversionError extends EyesError{constructor(from,to,...params){super(`Cannot convert from '${from}' to '${to}'`,...params)}}module.exports=CoordinatesTypeConversionError},{"./EyesError":124}],123:[function(require,module,exports){"use strict";const TestFailedError=require("./TestFailedError");class DiffsFoundError extends TestFailedError{constructor(testResults,message,...params){super(testResults,message,...params)}}module.exports=DiffsFoundError},{"./TestFailedError":127}],124:[function(require,module,exports){"use strict";class EyesError extends Error{constructor(message,...params){super(message,...params);this.name=this.constructor.name;Error.captureStackTrace(this,this.constructor)}}module.exports=EyesError},{}],125:[function(require,module,exports){"use strict";const TestFailedError=require("./TestFailedError");class NewTestError extends TestFailedError{constructor(testResults,message,...params){super(testResults,message,...params)}}module.exports=NewTestError},{"./TestFailedError":127}],126:[function(require,module,exports){"use strict";const EyesError=require("./EyesError");class OutOfBoundsError extends EyesError{}module.exports=OutOfBoundsError},{"./EyesError":124}],127:[function(require,module,exports){"use strict";const EyesError=require("./EyesError");class TestFailedError extends EyesError{constructor(testResults,message,...params){super(message,...params);this._testResults=testResults}getTestResults(){return this._testResults}}module.exports=TestFailedError},{"./EyesError":124}],128:[function(require,module,exports){"use strict";const MatchLevel=require("../match/MatchLevel");const Region=require("../positioning/Region");const FloatingMatchSettings=require("../positioning/FloatingMatchSettings");const IgnoreRegionByRectangle=require("./IgnoreRegionByRectangle");const FloatingRegionByRectangle=require("./FloatingRegionByRectangle");const GetRegion=require("./GetRegion");const GetFloatingRegion=require("./GetFloatingRegion");class CheckSettings{constructor(timeout=-1,region=undefined){this._matchLevel=undefined;this._ignoreCaret=undefined;this._stitchContent=false;this._timeout=timeout;this._targetRegion=region;this._ignoreRegions=[];this._floatingRegions=[]}layout(){this._matchLevel=MatchLevel.Layout;return this}exact(){this._matchLevel=MatchLevel.Exact;return this}strict(){this._matchLevel=MatchLevel.Strict;return this}content(){this._matchLevel=MatchLevel.Content;return this}matchLevel(matchLevel){this._matchLevel=matchLevel;return this}getMatchLevel(){return this._matchLevel}ignoreCaret(ignoreCaret=true){this._ignoreCaret=ignoreCaret;return this}getIgnoreCaret(){return this._ignoreCaret}fully(){this._stitchContent=true;return this}stitchContent(stitchContent=true){this._stitchContent=stitchContent;return this}getStitchContent(){return this._stitchContent}timeout(timeoutMilliseconds){if(Number.isInteger(timeoutMilliseconds)){this._timeout=timeoutMilliseconds}return this}getTimeout(){return this._timeout}updateTargetRegion(region){this._targetRegion=region}getTargetRegion(){return this._targetRegion}ignore(regionOrContainer){if(regionOrContainer instanceof Region){this._ignoreRegions.push(new IgnoreRegionByRectangle(regionOrContainer))}else if(regionOrContainer instanceof GetRegion){this._ignoreRegions.push(regionOrContainer)}else{throw new TypeError("ignore method called with argument of unknown type!")}return this}ignores(...regionsOrContainers){if(!regionsOrContainers){throw new TypeError("ignores method called without arguments!")}for(const region of regionsOrContainers){this.ignore(region)}return this}getIgnoreRegions(){return this._ignoreRegions}floating(regionOrContainer,maxUpOffset,maxDownOffset,maxLeftOffset,maxRightOffset){if(regionOrContainer instanceof FloatingMatchSettings){this._floatingRegions.push(new FloatingRegionByRectangle(regionOrContainer.getRegion(),regionOrContainer.getMaxUpOffset(),regionOrContainer.getMaxDownOffset(),regionOrContainer.getMaxLeftOffset(),regionOrContainer.getMaxRightOffset()))}else if(regionOrContainer instanceof Region){this._floatingRegions.push(new FloatingRegionByRectangle(new Region(regionOrContainer),maxUpOffset,maxDownOffset,maxLeftOffset,maxRightOffset))}else if(regionOrContainer instanceof GetFloatingRegion){this._floatingRegions.push(regionOrContainer)}else{throw new TypeError("floating method called with argument of unknown type!")}return this}floatings(maxOffset,...regionsOrContainers){if(!regionsOrContainers){throw new TypeError("floatings method called without arguments!")}for(const region of regionsOrContainers){this.floating(region,maxOffset,maxOffset,maxOffset,maxOffset)}return this}getFloatingRegions(){return this._floatingRegions}}module.exports=CheckSettings},{"../match/MatchLevel":148,"../positioning/FloatingMatchSettings":152,"../positioning/Region":159,"./FloatingRegionByRectangle":130,"./GetFloatingRegion":131,"./GetRegion":132,"./IgnoreRegionByRectangle":133}],129:[function(require,module,exports){"use strict";const CheckSettings=require("./CheckSettings");class CheckTarget{static window(){return new CheckSettings}static region(rect){return new CheckSettings(undefined,rect)}}module.exports=CheckTarget},{"./CheckSettings":128}],130:[function(require,module,exports){"use strict";const GetFloatingRegion=require("./GetFloatingRegion");const FloatingMatchSettings=require("../positioning/FloatingMatchSettings");class FloatingRegionByRectangle extends GetFloatingRegion{constructor(rect,maxUpOffset,maxDownOffset,maxLeftOffset,maxRightOffset){super();this._rect=rect;this._maxUpOffset=maxUpOffset;this._maxDownOffset=maxDownOffset;this._maxLeftOffset=maxLeftOffset;this._maxRightOffset=maxRightOffset}getRegion(eyesBase){const region=new FloatingMatchSettings(this._rect.getLeft(),this._rect.getTop(),this._rect.getWidth(),this._rect.getHeight(),this._maxUpOffset,this._maxDownOffset,this._maxLeftOffset,this._maxRightOffset);return eyesBase.getPromiseFactory().resolve(region)}}module.exports=FloatingRegionByRectangle},{"../positioning/FloatingMatchSettings":152,"./GetFloatingRegion":131}],131:[function(require,module,exports){"use strict";class GetFloatingRegion{getRegion(eyesBase){}}module.exports=GetFloatingRegion},{}],132:[function(require,module,exports){"use strict";class GetRegion{getRegion(eyesBase){}}module.exports=GetRegion},{}],133:[function(require,module,exports){"use strict";const GetRegion=require("./GetRegion");class IgnoreRegionByRectangle extends GetRegion{constructor(region){super();this._region=region}getRegion(eyesBase){return eyesBase.getPromiseFactory().resolve(this._region)}}module.exports=IgnoreRegionByRectangle},{"./GetRegion":132}],134:[function(require,module,exports){"use strict";class PropertyHandler{set(obj){}get(){}}module.exports=PropertyHandler},{}],135:[function(require,module,exports){"use strict";const PropertyHandler=require("./PropertyHandler");class ReadOnlyPropertyHandler extends PropertyHandler{constructor(logger,obj){super();this._logger=logger;this._obj=obj||null}set(obj){this._logger.verbose("Ignored. (%s)","ReadOnlyPropertyHandler");return false}get(){return this._obj}}module.exports=ReadOnlyPropertyHandler},{"./PropertyHandler":134}],136:[function(require,module,exports){"use strict";const PropertyHandler=require("./PropertyHandler");class SimplePropertyHandler extends PropertyHandler{constructor(obj){super();this._obj=obj||null}set(obj){this._obj=obj;return true}get(){return this._obj}}module.exports=SimplePropertyHandler},{"./PropertyHandler":134}],137:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const Region=require("../positioning/Region");class EyesScreenshot{constructor(image){if(new.target===EyesScreenshot){throw new TypeError("Can not construct `EyesScreenshot` instance directly, should be used implementation!")}ArgumentGuard.notNull(image,"image");this._image=image}getImage(){return this._image}getSubScreenshot(region,throwIfClipped){throw new TypeError("The method `getSubScreenshot` from `EyesScreenshot` should be implemented!")}convertLocation(location,from,to){throw new TypeError("The method `convertLocation` from `EyesScreenshot` should be implemented!")}getLocationInScreenshot(location,coordinatesType){throw new TypeError("The method `getLocationInScreenshot` from `EyesScreenshot` should be implemented!")}getIntersectedRegion(region,originalCoordinatesType,resultCoordinatesType){throw new TypeError("The method `getIntersectedRegion` from `EyesScreenshot` should be implemented!")}convertRegionLocation(region,from,to){ArgumentGuard.notNull(region,"region");if(region.isEmpty()){return new Region(region)}ArgumentGuard.notNull(from,"from");ArgumentGuard.notNull(to,"to");const updatedLocation=this.convertLocation(region.getLocation(),from,to);return new Region(updatedLocation,region.getSize())}}module.exports=EyesScreenshot},{"../ArgumentGuard":96,"../positioning/Region":159}],138:[function(require,module,exports){(function(Buffer){"use strict";const zlib=require("zlib");const WritableBufferStream=require("../StreamUtils").WritableBufferStream;const PREAMBLE=new Buffer("applitools","utf8");const COMPRESS_BY_RAW_BLOCKS_FORMAT=3;class ImageDeltaCompressor{static _getActualBlockSize(imageSize,blockSize,blockColumn,blockRow){const actualWidth=Math.min(imageSize.width-blockColumn*blockSize,blockSize);const actualHeight=Math.min(imageSize.height-blockRow*blockSize,blockSize);return{width:actualWidth,height:actualHeight}}static _compareAndCopyBlocks(sourcePixels,targetPixels,imageSize,pixelLength,blockSize,blockColumn,blockRow,channel){let isIdentical=true;const actualBlockSize=ImageDeltaCompressor._getActualBlockSize(imageSize,blockSize,blockColumn,blockRow);const actualBlockHeight=actualBlockSize.height;const actualBlockWidth=actualBlockSize.width;const stride=imageSize.width*pixelLength;const channelBytes=new Buffer(actualBlockHeight*actualBlockWidth);let channelBytesOffset=0;let sourceByte,targetByte;for(let h=0;h<actualBlockHeight;++h){let offset=(blockSize*blockRow+h)*stride+blockSize*blockColumn*pixelLength+channel;for(let w=0;w<actualBlockWidth;++w){sourceByte=sourcePixels[offset];targetByte=targetPixels[offset];if(sourceByte!==targetByte){isIdentical=false}channelBytes.writeUInt8(targetByte,channelBytesOffset);channelBytesOffset++;offset+=pixelLength}}return{isIdentical:isIdentical,buffer:channelBytes}}static compressByRawBlocks(targetData,targetBuffer,sourceData,blockSize=10){if(!targetData||!sourceData||sourceData.width!==targetData.width||sourceData.height!==targetData.height){return targetBuffer}const targetPixels=targetData.data;const sourcePixels=sourceData.data;const pixelLength=(targetData.data[25]&4)===4?4:3;const imageSize={width:targetData.width,height:targetData.height};const blockColumnsCount=parseInt(targetData.width/blockSize+(targetData.width%blockSize===0?0:1));const blockRowsCount=parseInt(targetData.height/blockSize+(targetData.height%blockSize===0?0:1));const stream=new WritableBufferStream;const blocksStream=new WritableBufferStream;stream.write(PREAMBLE);stream.write(new Buffer([COMPRESS_BY_RAW_BLOCKS_FORMAT]));stream.writeShort(0);stream.writeShort(blockSize);let compareResult;for(let channel=0;channel<3;++channel){const actualChannelIndex=pixelLength===4?channel+1:channel;let blockNumber=0;for(let blockRow=0;blockRow<blockRowsCount;++blockRow){for(let blockColumn=0;blockColumn<blockColumnsCount;++blockColumn){compareResult=ImageDeltaCompressor._compareAndCopyBlocks(sourcePixels,targetPixels,imageSize,pixelLength,blockSize,blockColumn,blockRow,actualChannelIndex);if(!compareResult.isIdentical){blocksStream.writeByte(channel);blocksStream.writeInt(blockNumber);blocksStream.write(compareResult.buffer);if(stream.getBuffer().length+blocksStream.getBuffer().length>targetBuffer.length){return targetBuffer}}++blockNumber}}}stream.write(zlib.deflateRawSync(blocksStream.getBuffer(),{level:zlib.Z_BEST_COMPRESSION}));if(stream.getBuffer().length>targetBuffer.length){return targetBuffer}return stream.getBuffer()}}module.exports=ImageDeltaCompressor}).call(this,require("buffer").Buffer)},{"../StreamUtils":108,buffer:9,zlib:8}],139:[function(require,module,exports){(function(Buffer){"use strict";const fs=require("fs");const png=require("png-async");const{ReadableBufferStream:ReadableBufferStream,WritableBufferStream:WritableBufferStream}=require("../StreamUtils");class ImageUtils{static parseImage(buffer,promiseFactory){return promiseFactory.makePromise(resolve=>{if(!fs.open){return resolve(buffer)}const imageReadableStream=new ReadableBufferStream(buffer,undefined);const image=new png.Image({filterType:4});imageReadableStream.pipe(image).on("parsed",()=>{resolve(image)})})}static packImage(image,promiseFactory){return promiseFactory.makePromise(resolve=>{if(!fs.open){return resolve(image)}const imageWritableStream=new WritableBufferStream;image.pack().pipe(imageWritableStream).on("finish",()=>{resolve(imageWritableStream.getBuffer())})})}static createImage(width,height){return new png.Image({filterType:4,width:width,height:height})}static scaleImage(image,scaleRatio,promiseFactory){if(scaleRatio===1){return promiseFactory.makePromise(resolve=>{resolve(image)})}const ratio=image.height/image.width;const scaledWidth=Math.ceil(image.width*scaleRatio);const scaledHeight=Math.ceil(scaledWidth*ratio);return ImageUtils.resizeImage(image,scaledWidth,scaledHeight,promiseFactory)}static resizeImage(image,targetWidth,targetHeight,promiseFactory){return promiseFactory.makePromise(resolve=>{const dst={data:new Buffer(targetWidth*targetHeight*4),width:targetWidth,height:targetHeight};if(dst.width>image.width||dst.height>image.height){ImageUtils._doBicubicInterpolation(image,dst)}else{ImageUtils._scaleImageIncrementally(image,dst)}image.data=dst.data;image.width=dst.width;image.height=dst.height;resolve(image)})}static _interpolateCubic(x0,x1,x2,x3,t){const a0=x3-x2-x0+x1;const a1=x0-x1-a0;const a2=x2-x0;return Math.ceil(Math.max(0,Math.min(255,a0*(t*t*t)+a1*(t*t)+a2*t+x1)))}static _interpolateRows(bufSrc,wSrc,hSrc,wDst){const buf=new Buffer(wDst*hSrc*4);for(let i=0;i<hSrc;i++){for(let j=0;j<wDst;j++){const x=j*(wSrc-1)/wDst;const xPos=Math.floor(x);const t=x-xPos;const srcPos=(i*wSrc+xPos)*4;const buf1Pos=(i*wDst+j)*4;for(let k=0;k<4;k++){const kPos=srcPos+k;const x0=xPos>0?bufSrc[kPos-4]:2*bufSrc[kPos]-bufSrc[kPos+4];const x1=bufSrc[kPos];const x2=bufSrc[kPos+4];const x3=xPos<wSrc-2?bufSrc[kPos+8]:2*bufSrc[kPos+4]-bufSrc[kPos];buf[buf1Pos+k]=ImageUtils._interpolateCubic(x0,x1,x2,x3,t)}}}return buf}static _interpolateColumns(bufSrc,hSrc,wDst,hDst){const buf=new Buffer(wDst*hDst*4);for(let i=0;i<hDst;i++){for(let j=0;j<wDst;j++){const y=i*(hSrc-1)/hDst;const yPos=Math.floor(y);const t=y-yPos;const buf1Pos=(yPos*wDst+j)*4;const buf2Pos=(i*wDst+j)*4;for(let k=0;k<4;k++){const kPos=buf1Pos+k;const y0=yPos>0?bufSrc[kPos-wDst*4]:2*bufSrc[kPos]-bufSrc[kPos+wDst*4];const y1=bufSrc[kPos];const y2=bufSrc[kPos+wDst*4];const y3=yPos<hSrc-2?bufSrc[kPos+wDst*8]:2*bufSrc[kPos+wDst*4]-bufSrc[kPos];buf[buf2Pos+k]=ImageUtils._interpolateCubic(y0,y1,y2,y3,t)}}}return buf}static _interpolateScale(bufColumns,wDst,hDst,wDst2,m,wM,hM){const buf=new Buffer(wDst*hDst*4);for(let i=0;i<wDst;i++){for(let j=0;j<hDst;j++){let r=0,g=0,b=0,a=0;for(let y=0;y<hM;y++){const yPos=i*hM+y;for(let x=0;x<wM;x++){const xPos=j*wM+x;const xyPos=(yPos*wDst2+xPos)*4;r+=bufColumns[xyPos];g+=bufColumns[xyPos+1];b+=bufColumns[xyPos+2];a+=bufColumns[xyPos+3]}}const pos=(i*wDst+j)*4;buf[pos]=Math.round(r/m);buf[pos+1]=Math.round(g/m);buf[pos+2]=Math.round(b/m);buf[pos+3]=Math.round(a/m)}}return buf}static _doBicubicInterpolation(src,dst){const wM=Math.max(1,Math.floor(src.width/dst.width));const wDst2=dst.width*wM;const hM=Math.max(1,Math.floor(src.height/dst.height));const hDst2=dst.height*hM;const bufRows=ImageUtils._interpolateRows(src.data,src.width,src.height,wDst2);const bufColumns=ImageUtils._interpolateColumns(bufRows,src.height,wDst2,hDst2);const m=wM*hM;if(m>1){dst.data=ImageUtils._interpolateScale(bufColumns,dst.width,dst.height,wDst2,m,wM,hM)}else{dst.data=bufColumns}return dst}static _scaleImageIncrementally(src,dst){let incrementCount=0;let currentWidth=src.width,currentHeight=src.height;const targetWidth=dst.width,targetHeight=dst.height;dst.data=src.data;dst.width=src.width;dst.height=src.height;const fraction=2;do{const prevCurrentWidth=currentWidth;const prevCurrentHeight=currentHeight;if(currentWidth>targetWidth){currentWidth-=currentWidth/fraction;if(currentWidth<targetWidth){currentWidth=targetWidth}}if(currentHeight>targetHeight){currentHeight-=currentHeight/fraction;if(currentHeight<targetHeight){currentHeight=targetHeight}}if(prevCurrentWidth===currentWidth&&prevCurrentHeight===currentHeight){return dst}const incrementalImage={data:new Buffer(currentWidth*currentHeight*4),width:currentWidth,height:currentHeight};ImageUtils._doBicubicInterpolation(dst,incrementalImage);dst.data=incrementalImage.data;dst.width=incrementalImage.width;dst.height=incrementalImage.height;incrementCount++}while(currentWidth!==targetWidth||currentHeight!==targetHeight);return dst}static cropImage(image,region,promiseFactory){return promiseFactory.makePromise((resolve,reject)=>{if(!region){return resolve(image)}if(region.getTop()<0||region.getTop()>=image.height||region.getLeft()<0||region.getLeft()>=image.width){return reject(new Error("region is outside the image bounds!"))}const croppedArray=[];const yStart=region.getTop();const yEnd=Math.min(region.getTop()+region.getHeight(),image.height);const xStart=region.getLeft();const xEnd=Math.min(region.getLeft()+region.getWidth(),image.width);let y,x,idx,i;for(y=yStart;y<yEnd;y++){for(x=xStart;x<xEnd;x++){idx=image.width*y+x<<2;for(i=0;i<4;i++){croppedArray.push(image.data[idx+i])}}}image.data=new Buffer(croppedArray);image.width=xEnd-xStart;image.height=yEnd-yStart;resolve(image)})}static rotateImage(image,deg,promiseFactory){return promiseFactory.makePromise((resolve,reject)=>{if(typeof deg!=="number"){return reject(new Error("deg must be a number!"))}let i=Math.round(deg/90)%4;if(i<0){i+=4}while(i>0){const buffer=new Buffer(image.data.length);let offset=0;for(let x=0;x<image.width;x++){for(let y=image.height-1;y>=0;y--){const idx=image.width*y+x<<2;const data=image.data.readUInt32BE(idx,true);buffer.writeUInt32BE(data,offset,true);offset+=4}}image.data=Buffer.from(buffer);const tmp=image.width;image.width=image.height;image.height=tmp;i--}resolve(image)})}static copyPixels(dstImage,dstPosition,srcImage,srcPosition,size){let y,dstY,srcY,x,dstX,srcX,dstIndex,srcIndex;const maxHeight=dstPosition.y+size.height<=dstImage.height?size.height:dstImage.height-dstPosition.y;const maxWidth=dstPosition.x+size.width<=dstImage.width?size.width:dstImage.width-dstPosition.x;for(y=0;y<maxHeight;++y){dstY=dstPosition.y+y;srcY=srcPosition.y+y;for(x=0;x<maxWidth;++x){dstX=dstPosition.x+x;srcX=srcPosition.x+x;dstIndex=dstY*dstImage.width+dstX<<2;srcIndex=srcY*srcImage.width+srcX<<2;dstImage.data[dstIndex]=srcImage.data[srcIndex];dstImage.data[dstIndex+1]=srcImage.data[srcIndex+1];dstImage.data[dstIndex+2]=srcImage.data[srcIndex+2];dstImage.data[dstIndex+3]=srcImage.data[srcIndex+3]}}}static stitchImage(fullSize,parts,promiseFactory){return promiseFactory.makePromise(resolve=>{const stitchedImage=new png.Image({filterType:4,width:fullSize.width,height:fullSize.height});let stitchingPromise=promiseFactory.makePromise(resolve=>{resolve()});for(let i=0;i<parts.length;++i){stitchingPromise=ImageUtils._stitchPart(stitchingPromise,stitchedImage,parts[i],promiseFactory)}const lastPart=parts[parts.length-1];const actualImageWidth=lastPart.position.x+lastPart.size.width;const actualImageHeight=lastPart.position.y+lastPart.size.height;stitchingPromise.then(()=>{if(actualImageWidth<stitchedImage.width||actualImageHeight<stitchedImage.height){const newWidth=stitchedImage.width>actualImageWidth?actualImageWidth:stitchedImage.width;const newHeight=stitchedImage.height>actualImageHeight?actualImageHeight:stitchedImage.height;return ImageUtils.cropImage(stitchedImage,{left:0,top:0,width:newWidth,height:newHeight},promiseFactory)}}).then(()=>ImageUtils.packImage(stitchedImage,promiseFactory)).then(buffer=>{resolve(buffer)})})}static _stitchPart(stitchingPromise,stitchedImage,part,promiseFactory){return stitchingPromise.then(()=>promiseFactory.makePromise(resolve=>{ImageUtils.parseImage(part.image,promiseFactory).then(pngImage=>{ImageUtils.copyPixels(stitchedImage,part.position,pngImage,{x:0,y:0},part.size);resolve(stitchedImage)})}))}static getImageSizeFromBuffer(imageBuffer){if(imageBuffer[12]===73&&imageBuffer[13]===72&&imageBuffer[14]===68&&imageBuffer[15]===82){const width=imageBuffer[16]*256*256*256+imageBuffer[17]*256*256+imageBuffer[18]*256+imageBuffer[19];const height=imageBuffer[20]*256*256*256+imageBuffer[21]*256*256+imageBuffer[22]*256+imageBuffer[23];return{width:width,height:height}}throw new TypeError("Buffer contains unsupported image type.")}static saveImage(imageBuffer,filename,promiseFactory){return promiseFactory.makePromise((resolve,reject)=>{fs.writeFile(filename,imageBuffer,err=>{if(err){reject(err)}resolve()})})}}module.exports=ImageUtils}).call(this,require("buffer").Buffer)},{"../StreamUtils":108,buffer:9,fs:6,"png-async":91}],140:[function(require,module,exports){(function(Buffer){"use strict";const fs=require("fs");const Location=require("../positioning/Location");const RectangleSize=require("../positioning/RectangleSize");const ImageUtils=require("./ImageUtils");const GeneralUtils=require("../GeneralUtils");const disabled=!fs.open;function _parseImage(that){return that._promiseFactory.makePromise(resolve=>{if(that._isParsed||disabled){return resolve()}return ImageUtils.parseImage(that._imageBuffer,that._promiseFactory).then(imageData=>{that._imageBmp=imageData;that._width=imageData.width;that._height=imageData.height;that._isParsed=true;resolve()})})}function _packImage(that){return that._promiseFactory.makePromise(resolve=>{if(!that._isParsed||that._imageBuffer||disabled){return resolve()}return ImageUtils.packImage(that._imageBmp,that._promiseFactory).then(buffer=>{that._imageBuffer=buffer;resolve()})})}function _retrieveImageSize(that){if(that._isParsed||that._width&&that._height){return}const imageSize=ImageUtils.getImageSizeFromBuffer(that._imageBuffer);that._width=imageSize.width;that._height=imageSize.height}class MutableImage{constructor(image,promiseFactory){if(GeneralUtils.isString(image)){image=new Buffer(image,"base64")}this._imageBuffer=image;this._promiseFactory=promiseFactory;this._isParsed=false;this._imageBmp=undefined;this._width=0;this._height=0;this._top=0;this._left=0}getCoordinates(){return this._promiseFactory.resolve(new Location(this._left,this._top))}setCoordinates(coordinates){this._left=coordinates.getX();this._top=coordinates.getY();return this._promiseFactory.resolve()}getSize(){_retrieveImageSize(this);return new RectangleSize(this._width,this._height)}getWidth(){_retrieveImageSize(this);return this._width}getHeight(){_retrieveImageSize(this);return this._height}asObject(){const that=this;return _packImage(that).then(()=>_retrieveImageSize(that)).then(()=>({imageBuffer:that._imageBuffer,width:that._width,height:that._height}))}scale(scaleRatio){if(scaleRatio===1){return this._promiseFactory.resolve(this)}const that=this;return _parseImage(that).then(()=>{if(that._isParsed){return ImageUtils.scaleImage(that._imageBmp,scaleRatio,that._promiseFactory).then(()=>{that._imageBuffer=null;that._width=that._imageBmp.width;that._height=that._imageBmp.height;return that})}return that})}crop(region){const that=this;return _parseImage(that).then(()=>{if(that._isParsed){return ImageUtils.cropImage(that._imageBmp,region,that._promiseFactory).then(()=>{that._imageBuffer=null;that._width=that._imageBmp.width;that._height=that._imageBmp.height;return that})}return that})}getImagePart(region){const that=this;return _packImage(that).then(()=>{const newImage=new MutableImage(Buffer.from(that._imageBuffer),that._promiseFactory);return newImage.crop(region)})}rotate(degrees){const that=this;if(degrees===0){return that._promiseFactory.makePromise(resolve=>{resolve(that)})}return _parseImage(that).then(()=>{if(that._isParsed){return ImageUtils.rotateImage(that._imageBmp,degrees,that._promiseFactory).then(()=>{that._imageBuffer=null;that._width=that._imageBmp.width;that._height=that._imageBmp.height;return that})}return that})}copyRasterData(dx,dy,srcImage){const that=this;return _parseImage(that).then(()=>srcImage.getImageData()).then(srcImageBmp=>{let width=srcImage.getWidth(),height=srcImage.getHeight();const maxWidth=that.getWidth()-dx,maxHeight=that.getHeight()-dy;if(maxWidth<width){width=maxWidth}if(maxHeight<height){height=maxHeight}ImageUtils.copyPixels(that._imageBmp,{x:dx,y:dy},srcImageBmp,{x:0,y:0},{width:width,height:height})})}save(filename){const that=this;return that.getImageBuffer().then(imageBuffer=>ImageUtils.saveImage(imageBuffer,filename,that._promiseFactory))}getImageBuffer(){const that=this;return _packImage(that).then(()=>that._imageBuffer)}getImageBase64(){const that=this;return _packImage(that).then(()=>that._imageBuffer.toString("base64"))}getImageData(){const that=this;return _parseImage(that).then(()=>that._imageBmp)}resolve(){return this._promiseFactory.resolve(this)}static newImage(width,height,promiseFactory){const result=new MutableImage(null,promiseFactory);result._isParsed=true;result._imageBmp=ImageUtils.createImage(width,height);result._width=width;result._height=height;return result}}module.exports=MutableImage}).call(this,require("buffer").Buffer)},{"../GeneralUtils":102,"../positioning/Location":154,"../positioning/RectangleSize":158,"./ImageUtils":139,buffer:9,fs:6}],141:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");const LogHandler=require("./LogHandler");class ConsoleLogHandler extends LogHandler{constructor(isVerbose){super();this.setIsVerbose(isVerbose)}open(){}close(){}onMessage(verbose,logString){if(!verbose||this._isVerbose){console.log(`${GeneralUtils.getIso8601Data()} Eyes: ${logString}`)}}}module.exports=ConsoleLogHandler},{"../GeneralUtils":102,"./LogHandler":143}],142:[function(require,module,exports){"use strict";const path=require("path");const fs=require("fs");const GeneralUtils=require("../GeneralUtils");const LogHandler=require("./LogHandler");class FileLogHandler extends LogHandler{constructor(isVerbose,filename="eyes.log",append=true){super();this._filename=filename;this._append=append;this.setIsVerbose(isVerbose)}open(){this.close();const file=path.normalize(this._filename);const opts={flags:this._append?"a":"w",encoding:"utf8"};this._writer=fs.createWriteStream(file,opts)}close(){if(this._writer){this._writer.end("\n");this._writer=undefined}}onMessage(verbose,logString){if(this._writer&&(!verbose||this._isVerbose)){this._writer.write(`${GeneralUtils.getIso8601Data()} Eyes: ${logString}\n`)}}}module.exports=FileLogHandler},{"../GeneralUtils":102,"./LogHandler":143,fs:6,path:27}],143:[function(require,module,exports){"use strict";class LogHandler{constructor(){this._isVerbose=false}setIsVerbose(isVerbose){this._isVerbose=!!isVerbose}getIsVerbose(){return this._isVerbose}open(){}close(){}onMessage(verbose,logString){}}module.exports=LogHandler},{}],144:[function(require,module,exports){"use strict";const stackTrace=require("stack-trace");const ArgumentGuard=require("../ArgumentGuard");const GeneralUtils=require("../GeneralUtils");const NullLogHandler=require("./NullLogHandler");class Logger{constructor(){this._logHandler=new NullLogHandler}getLogHandler(){return this._logHandler}setLogHandler(handler){ArgumentGuard.notNull(handler,"handler");this._logHandler=handler}verbose(...args){this._logHandler.onMessage(true,this._getPrefix()+GeneralUtils.stringify(...args))}log(...args){this._logHandler.onMessage(false,this._getPrefix()+GeneralUtils.stringify(...args))}_getPrefix(){const trace=stackTrace.get();let prefix="";if(trace&&trace.length>=2&&trace[2].getMethodName()){prefix=`${trace[2].getMethodName()}():`}return prefix}}module.exports=Logger},{"../ArgumentGuard":96,"../GeneralUtils":102,"./NullLogHandler":145,"stack-trace":94}],145:[function(require,module,exports){"use strict";const LogHandler=require("./LogHandler");class NullLogHandler extends LogHandler{open(){}close(){}onMessage(verbose,logString){}}module.exports=NullLogHandler},{"./LogHandler":143}],146:[function(require,module,exports){"use strict";class ExactMatchSettings{constructor(minDiffIntensity,minDiffWidth,minDiffHeight,matchThreshold){this._minDiffIntensity=minDiffIntensity||0;this._minDiffWidth=minDiffWidth||0;this._minDiffHeight=minDiffHeight||0;this._matchThreshold=matchThreshold||0}getMinDiffIntensity(){return this._minDiffIntensity}setMinDiffIntensity(value){this._minDiffIntensity=value}getMinDiffWidth(){return this._minDiffWidth}setMinDiffWidth(value){this._minDiffWidth=value}getMinDiffHeight(){return this._minDiffHeight}setMinDiffHeight(value){this._minDiffHeight=value}getMatchThreshold(){return this._matchThreshold}setMatchThreshold(value){this._matchThreshold=value}toString(){return`[min diff intensity: ${this._minDiffIntensity}, min diff width ${this._minDiffWidth}, `+`min diff height ${this._minDiffHeight}, match threshold: ${this._matchThreshold}]`}}module.exports=ExactMatchSettings},{}],147:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");const MatchLevel=require("./MatchLevel");class ImageMatchSettings{constructor(matchLevel=MatchLevel.Strict,exact,ignoreCaret){this._matchLevel=matchLevel;this._exact=exact;this._ignoreCaret=ignoreCaret;this._ignoreRegions=[];this._floatingMatchSettings=[]}getMatchLevel(){return this._matchLevel}setMatchLevel(value){this._matchLevel=value}getExact(){return this._exact}setExact(value){this._exact=value}getIgnoreCaret(){return this._ignoreCaret}setIgnoreCaret(value){this._ignoreCaret=value}getIgnoreRegions(){return this._ignoreRegions}setIgnoreRegions(value){this._ignoreRegions=value}getFloatingRegions(){return this._floatingMatchSettings}setFloatingRegions(value){this._floatingMatchSettings=value}toJSON(){return{matchLevel:this._matchLevel,exact:this._exact,ignoreCaret:this._ignoreCaret,ignore:this._ignoreRegions,floating:this._floatingMatchSettings}}toString(){return`ImageMatchSettings { ${GeneralUtils.toJson(this)} }`}}module.exports=ImageMatchSettings},{"../GeneralUtils":102,"./MatchLevel":148}],148:[function(require,module,exports){"use strict";const MatchLevel={None:"None",LegacyLayout:"Layout1",Layout:"Layout2",Layout2:"Layout2",Content:"Content",Strict:"Strict",Exact:"Exact"};Object.freeze(MatchLevel);module.exports=MatchLevel},{}],149:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");const ArgumentGuard=require("../ArgumentGuard");class Options{constructor(name,userInputs,ignoreMismatch,ignoreMatch,forceMismatch,forceMatch,imageMatchSettings){ArgumentGuard.notNull(userInputs,"userInputs");this._name=name;this._userInputs=userInputs;this._ignoreMismatch=ignoreMismatch;this._ignoreMatch=ignoreMatch;this._forceMismatch=forceMismatch;this._forceMatch=forceMatch;this._imageMatchSettings=imageMatchSettings}getName(){return this._name}getUserInputs(){return this._userInputs}getIgnoreMismatch(){return this._ignoreMismatch}getIgnoreMatch(){return this._ignoreMatch}getForceMismatch(){return this._forceMismatch}getForceMatch(){return this._forceMatch}getImageMatchSettings(){return this._imageMatchSettings}toJSON(){return{name:this._name,userInputs:this._userInputs,ignoreMismatch:this._ignoreMismatch,ignoreMatch:this._ignoreMatch,forceMismatch:this._forceMismatch,forceMatch:this._forceMatch,imageMatchSettings:this._imageMatchSettings}}toString(){return`Options { ${GeneralUtils.toJson(this)} }`}}class MatchWindowData{constructor(userInputs,appOutput,tag,ignoreMismatch,options){ArgumentGuard.notNull(userInputs,"userInputs");this._userInputs=userInputs;this._appOutput=appOutput;this._tag=tag;this._ignoreMismatch=ignoreMismatch;this._options=options}getUserInputs(){return this._userInputs}getAppOutput(){return this._appOutput}getTag(){return this._tag}getIgnoreMismatch(){return this._ignoreMismatch}getOptions(){return this._options}toJSON(){return{tag:this._tag,userInputs:this._userInputs,appOutput:this._appOutput,ignoreMismatch:this._ignoreMismatch,options:this._options}}toString(){return`MatchWindowData { ${GeneralUtils.toJson(this)} }`}}MatchWindowData.Options=Options;module.exports=MatchWindowData},{"../ArgumentGuard":96,"../GeneralUtils":102}],150:[function(require,module,exports){"use strict";class MatchWindowDataWithScreenshot{constructor(matchWindowData,screenshot){this._matchWindowData=matchWindowData;this.screenshot=screenshot}getMatchWindowData(){return this._matchWindowData}getScreenshot(){return this.screenshot}}module.exports=MatchWindowDataWithScreenshot},{}],151:[function(require,module,exports){"use strict";const CoordinatesType={SCREENSHOT_AS_IS:1,CONTEXT_AS_IS:2,CONTEXT_RELATIVE:3};Object.freeze(CoordinatesType);module.exports=CoordinatesType},{}],152:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");const Region=require("./Region");class FloatingMatchSettings{constructor(left,top,width,height,maxUpOffset,maxDownOffset,maxLeftOffset,maxRightOffset){this._top=top;this._left=left;this._width=width;this._height=height;this._maxUpOffset=maxUpOffset;this._maxDownOffset=maxDownOffset;this._maxLeftOffset=maxLeftOffset;this._maxRightOffset=maxRightOffset}getLeft(){return this._left}setLeft(value){this._left=value}getTop(){return this._top}setTop(value){this._top=value}getWidth(){return this._width}setWidth(value){this._width=value}getHeight(){return this._height}setHeight(value){this._height=value}getMaxUpOffset(){return this._maxUpOffset}setMaxUpOffset(value){this._maxUpOffset=value}getMaxDownOffset(){return this._maxDownOffset}setMaxDownOffset(value){this._maxDownOffset=value}getMaxLeftOffset(){return this._maxLeftOffset}setMaxLeftOffset(value){this._maxLeftOffset=value}getMaxRightOffset(){return this._maxRightOffset}setMaxRightOffset(value){this._maxRightOffset=value}getRegion(){return new Region(this._left,this._top,this._width,this._height)}toJSON(){return{top:this._top,left:this._left,width:this._width,height:this._height,maxUpOffset:this._maxUpOffset,maxDownOffset:this._maxDownOffset,maxLeftOffset:this._maxLeftOffset,maxRightOffset:this._maxRightOffset}}toString(){return`FloatingMatchSettings { ${GeneralUtils.toJson(this)} }`}}module.exports=FloatingMatchSettings},{"../GeneralUtils":102,"./Region":159}],153:[function(require,module,exports){"use strict";const PositionProvider=require("./PositionProvider");class InvalidPositionProvider extends PositionProvider{getCurrentPosition(){throw new TypeError("This class does not implement methods!")}setPosition(location){throw new TypeError("This class does not implement methods!")}getEntireSize(){throw new TypeError("This class does not implement methods!")}getState(){throw new TypeError("This class does not implement methods!")}restoreState(state){throw new TypeError("This class does not implement methods!")}}module.exports=InvalidPositionProvider},{"./PositionProvider":157}],154:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");class Location{constructor(arg1,arg2){let x=arg1,y=arg2;if(arg1 instanceof Object){if(arg1 instanceof Location){x=arg1.getX();y=arg1.getY()}else if(arg1 instanceof Object){ArgumentGuard.hasProperties(arg1,["x","y"],"LocationObject");x=arg1.x;y=arg1.y}else{throw new TypeError("The constructor is not support the object "+arg1)}}ArgumentGuard.isInteger(x,"x");ArgumentGuard.isInteger(y,"y");this._x=x;this._y=y}getX(){return this._x}getY(){return this._y}equals(obj){if(typeof obj!==typeof this||!(obj instanceof Location)){return false}return this.getX()===obj.getX()&&this.getY()===obj.getY()}offset(dx,dy){return new Location(this._x+dx,this._y+dy)}offsetByLocation(amount){return this.offset(amount.getX(),amount.getY())}scale(scaleRatio){return new Location(Math.ceil(this._x*scaleRatio),Math.ceil(this._y*scaleRatio))}toJSON(){return{x:this._x,y:this._y}}toString(){return`(${this._x}, ${this._y})`}toStringForFilename(){return`${this._x}_${this._y}`}}Location.ZERO=new Location(0,0);module.exports=Location},{"../ArgumentGuard":96}],155:[function(require,module,exports){"use strict";const RegionProvider=require("./RegionProvider");const Region=require("./Region");class NullRegionProvider extends RegionProvider{constructor(promiseFactory){super(Region.EMPTY,promiseFactory)}}module.exports=NullRegionProvider},{"./Region":159,"./RegionProvider":160}],156:[function(require,module,exports){"use strict";class PositionMemento{}module.exports=PositionMemento},{}],157:[function(require,module,exports){"use strict";class PositionProvider{getCurrentPosition(){}setPosition(location){}getEntireSize(){}getState(){}restoreState(state){}}module.exports=PositionProvider},{}],158:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");class RectangleSize{constructor(arg1,arg2){let width=arg1,height=arg2;if(arg1 instanceof Object){if(arg1 instanceof RectangleSize){width=arg1.getWidth();height=arg1.getHeight()}else if(arg1 instanceof Object){ArgumentGuard.hasProperties(arg1,["width","height"],"RectangleSizeObject");width=arg1.width;height=arg1.height}else{throw new TypeError("The constructor is not support the object "+arg1)}}ArgumentGuard.greaterThanOrEqualToZero(width,"width",true);ArgumentGuard.greaterThanOrEqualToZero(height,"height",true);this._width=width;this._height=height}static parse(size){ArgumentGuard.notNull(size,"size");const parts=size.split("x");if(parts.length!==2){throw new Error(`IllegalArgument: Not a valid size string: ${size}`)}return new RectangleSize(parseInt(parts[0],10),parseInt(parts[1],10))}getWidth(){return this._width}getHeight(){return this._height}equals(obj){if(typeof obj!==typeof this||!(obj instanceof RectangleSize)){return false}return this.getWidth()===obj.getWidth()&&this.getHeight()===obj.getHeight()}scale(scaleRatio){return new RectangleSize(Math.ceil(this._width*scaleRatio),Math.ceil(this._height*scaleRatio))}toJSON(){return{width:this._width,height:this._height}}toString(){return`${this._width}x${this._height}`}}module.exports=RectangleSize},{"../ArgumentGuard":96}],159:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const RectangleSize=require("./RectangleSize");const Location=require("./Location");const CoordinatesType=require("./CoordinatesType");class Region{constructor(arg1,arg2,arg3,arg4,arg5){let left=arg1,top=arg2,width=arg3,height=arg4,coordinatesType=arg5;if(arg1 instanceof Object){if(arg1 instanceof Region){left=arg1.getLeft();top=arg1.getTop();width=arg1.getWidth();height=arg1.getHeight();coordinatesType=arg1.getCoordinatesType()}else if(arg1 instanceof Location||arg2 instanceof RectangleSize){ArgumentGuard.notNull(arg1,"Location");ArgumentGuard.notNull(arg2,"RectangleSize");left=arg1.getX();top=arg1.getY();width=arg2.getWidth();height=arg2.getHeight();coordinatesType=arg3}else if(arg1 instanceof Object){ArgumentGuard.hasProperties(arg1,["left","top","width","height"],"RegionObject");left=arg1.left;top=arg1.top;width=arg1.width;height=arg1.height;coordinatesType=arg1.coordinatesType}else{throw new TypeError(`The Region constructor for ${typeof arg1} type not found.`)}}ArgumentGuard.isInteger(left,"left");ArgumentGuard.isInteger(top,"top");ArgumentGuard.greaterThanOrEqualToZero(width,"width",true);ArgumentGuard.greaterThanOrEqualToZero(height,"height",true);this._left=left;this._top=top;this._width=width;this._height=height;this._coordinatesType=coordinatesType||CoordinatesType.SCREENSHOT_AS_IS}getLeft(){return this._left}getTop(){return this._top}getWidth(){return this._width}getHeight(){return this._height}getCoordinatesType(){return this._coordinatesType}getLocation(){return new Location(this._left,this._top)}setLocation(location){ArgumentGuard.notNull(location,"location");this._left=location.getX();this._top=location.getY()}getSize(){return new RectangleSize(this._width,this._height)}setSize(size){ArgumentGuard.notNull(size,"size");this._width=size.getWidth();this._height=size.getHeight()}equals(obj){if(typeof obj!==typeof this||!(obj instanceof Region)){return false}return this.getLeft()===obj.getLeft()&&this.getTop()===obj.getTop()&&this.getWidth()===obj.getWidth()&&this.getHeight()===obj.getHeight()}isEmpty(){return this.getLeft()===Region.EMPTY.getLeft()&&this.getTop()===Region.EMPTY.getTop()&&this.getWidth()===Region.EMPTY.getWidth()&&this.getHeight()===Region.EMPTY.getHeight()}offset(dx,dy){return new Region(this.getLocation().offset(dx,dy),this.getSize(),this.getCoordinatesType())}getMiddleOffset(){const middleX=this._width/2;const middleY=this._height/2;return new Location(middleX,middleY)}scale(scaleRatio){return new Region(this.getLocation().scale(scaleRatio),this.getSize().scale(scaleRatio),this.getCoordinatesType())}getSubRegions(subRegionSize,isFixedSize=false){if(isFixedSize){return _getSubRegionsWithFixedSize(this,subRegionSize)}return _getSubRegionsWithVaryingSize(this,subRegionSize)}contains(locationOrRegion){if(locationOrRegion instanceof Location){return locationOrRegion.getX()>=this._left&&locationOrRegion.getX()<=this._left+this._width&&locationOrRegion.getY()>=this._top&&locationOrRegion.getY()<=this._top+this._height}else if(locationOrRegion instanceof Region){return this._top<=locationOrRegion.getTop()&&this._left<=locationOrRegion.getLeft()&&this._top+this._height>=locationOrRegion.getTop()+locationOrRegion.getHeight()&&this._left+this._width>=locationOrRegion.getLeft()+locationOrRegion.getWidth()}else{throw new TypeError("Unsupported type of given object.")}}isIntersected(other){const right=this._left+this._width;const bottom=this._top+this._height;const otherLeft=other.getLeft();const otherTop=other.getTop();const otherRight=otherLeft+other.getWidth();const otherBottom=otherTop+other.getHeight();return(this._left<=otherLeft&&otherLeft<=right||otherLeft<=this._left&&this._left<=otherRight)&&(this._top<=otherTop&&otherTop<=bottom||otherTop<=this._top&&this._top<=otherBottom)}intersect(other){if(!this.isIntersected(other)){this.makeEmpty();return}const otherLeft=other.getLeft();const otherTop=other.getTop();const intersectionLeft=this._left>=otherLeft?this._left:otherLeft;const intersectionTop=this._top>=otherTop?this._top:otherTop;const right=this._left+this._width;const otherRight=otherLeft+other.getWidth();const intersectionRight=right<=otherRight?right:otherRight;const intersectionWidth=intersectionRight-intersectionLeft;const bottom=this._top+this._height;const otherBottom=otherTop+other.getHeight();const intersectionBottom=bottom<=otherBottom?bottom:otherBottom;const intersectionHeight=intersectionBottom-intersectionTop;this._left=intersectionLeft;this._top=intersectionTop;this._width=intersectionWidth;this._height=intersectionHeight}makeEmpty(){this._left=Region.EMPTY.getLeft();this._top=Region.EMPTY.getTop();this._width=Region.EMPTY.getWidth();this._height=Region.EMPTY.getHeight();this._coordinatesType=Region.EMPTY.getCoordinatesType()}toJSON(){return{left:this._left,top:this._top,width:this._width,height:this._height}}toString(){return`(${this._left}, ${this._top}) ${this._width}x${this._height}, ${true._coordinatesType}`}}function _getSubRegionsWithFixedSize(containerRegion,subRegionSize){ArgumentGuard.notNull(containerRegion,"containerRegion");ArgumentGuard.notNull(subRegionSize,"subRegionSize");const subRegions=[];let subRegionWidth=subRegionSize.getWidth();let subRegionHeight=subRegionSize.getHeight();ArgumentGuard.greaterThanZero(subRegionWidth,"subRegionSize width");ArgumentGuard.greaterThanZero(subRegionHeight,"subRegionSize height");if(subRegionWidth>containerRegion.getWidth()){subRegionWidth=containerRegion.getWidth()}if(subRegionHeight>containerRegion.getHeight()){subRegionHeight=containerRegion.getHeight()}if(subRegionWidth===containerRegion.getWidth()&&subRegionHeight===containerRegion.getHeight()){subRegions.push(new Region(containerRegion));return subRegions}let currentTop=containerRegion.getTop();const bottom=containerRegion.getTop()+containerRegion.getHeight()-1;const right=containerRegion.getLeft()+containerRegion.getWidth()-1;while(currentTop<=bottom){if(currentTop+subRegionHeight>bottom){currentTop=bottom-subRegionHeight+1}let currentLeft=containerRegion.getLeft();while(currentLeft<=right){if(currentLeft+subRegionWidth>right){currentLeft=right-subRegionWidth+1}subRegions.push(new Region(currentLeft,currentTop,subRegionWidth,subRegionHeight));currentLeft+=subRegionWidth}currentTop+=subRegionHeight}return subRegions}function _getSubRegionsWithVaryingSize(containerRegion,maxSubRegionSize){ArgumentGuard.notNull(containerRegion,"containerRegion");ArgumentGuard.notNull(maxSubRegionSize,"maxSubRegionSize");ArgumentGuard.greaterThanZero(maxSubRegionSize.getWidth(),"maxSubRegionSize.getWidth()");ArgumentGuard.greaterThanZero(maxSubRegionSize.getHeight(),"maxSubRegionSize.getHeight()");const subRegions=[];let currentTop=containerRegion.getTop();const bottom=containerRegion.getTop()+containerRegion.getHeight();const right=containerRegion.getLeft()+containerRegion.getWidth();while(currentTop<bottom){let currentBottom=currentTop+maxSubRegionSize.getHeight();if(currentBottom>bottom){currentBottom=bottom}let currentLeft=containerRegion.getLeft();while(currentLeft<right){let currentRight=currentLeft+maxSubRegionSize.getWidth();if(currentRight>right){currentRight=right}const currentHeight=currentBottom-currentTop;const currentWidth=currentRight-currentLeft;subRegions.push(new Region(currentLeft,currentTop,currentWidth,currentHeight));currentLeft+=maxSubRegionSize.getWidth()}currentTop+=maxSubRegionSize.getHeight()}return subRegions}Region.EMPTY=new Region(0,0,0,0);module.exports=Region},{"../ArgumentGuard":96,"./CoordinatesType":151,"./Location":154,"./RectangleSize":158}],160:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");class RegionProvider{constructor(region,promiseFactory){if(region){ArgumentGuard.notNull(promiseFactory,"promiseFactory")}this._region=region;this._promiseFactory=promiseFactory}getRegion(){return this._promiseFactory.resolve(this._region)}}module.exports=RegionProvider},{"../ArgumentGuard":96}],161:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const ScaleProvider=require("./ScaleProvider");const ALLOWED_VS_DEVIATION=1;const ALLOWED_DCES_DEVIATION=10;const UNKNOWN_SCALE_RATIO=0;function getScaleRatioToViewport(viewportWidth,imageToScaleWidth,currentScaleRatio){const scaledImageWidth=Math.round(imageToScaleWidth*currentScaleRatio);const fromScaledToViewportRatio=viewportWidth/scaledImageWidth;return currentScaleRatio*fromScaledToViewportRatio}class ContextBasedScaleProvider extends ScaleProvider{constructor(logger,topLevelContextEntireSize,viewportSize,devicePixelRatio,isMobileDevice){super();this._logger=logger;this._topLevelContextEntireSize=topLevelContextEntireSize;this._viewportSize=viewportSize;this._devicePixelRatio=devicePixelRatio;this._isMobileDevice=isMobileDevice;this._scaleRatio=UNKNOWN_SCALE_RATIO}getScaleRatio(){ArgumentGuard.isValidState(this._scaleRatio!==UNKNOWN_SCALE_RATIO,"scaleRatio not defined yet");return this._scaleRatio}updateScaleRatio(imageToScaleWidth){const viewportWidth=this._viewportSize.getWidth();const dcesWidth=this._topLevelContextEntireSize.getWidth();if(imageToScaleWidth>=viewportWidth-ALLOWED_VS_DEVIATION&&imageToScaleWidth<=viewportWidth+ALLOWED_VS_DEVIATION||imageToScaleWidth>=dcesWidth-ALLOWED_DCES_DEVIATION&&imageToScaleWidth<=dcesWidth+ALLOWED_DCES_DEVIATION){this._logger.verbose("Image is already scaled correctly.");this._scaleRatio=1}else{this._logger.verbose("Calculating the scale ratio..");this._scaleRatio=1/this._devicePixelRatio;if(this._isMobileDevice){this._logger.verbose("Mobile device, so using 2 step calculation for scale ration...");this._logger.verbose("Scale ratio based on DRP: "+this._scaleRatio);this._scaleRatio=getScaleRatioToViewport(viewportWidth,imageToScaleWidth,this._scaleRatio)}this._logger.verbose("Final scale ratio: "+this._scaleRatio)}}}module.exports=ContextBasedScaleProvider},{"../ArgumentGuard":96,"./ScaleProvider":166}],162:[function(require,module,exports){"use strict";const ScaleProviderFactory=require("./ScaleProviderFactory");const ContextBasedScaleProvider=require("./ContextBasedScaleProvider");class ContextBasedScaleProviderFactory extends ScaleProviderFactory{constructor(logger,topLevelContextEntireSize,viewportSize,devicePixelRatio,isMobileDevice,scaleProviderHandler){super(scaleProviderHandler);this._logger=logger;this._topLevelContextEntireSize=topLevelContextEntireSize;this._viewportSize=viewportSize;this._devicePixelRatio=devicePixelRatio;this._isMobileDevice=isMobileDevice}getScaleProviderImpl(imageToScaleWidth){const scaleProvider=new ContextBasedScaleProvider(this._logger,this._topLevelContextEntireSize,this._viewportSize,this._devicePixelRatio,this._isMobileDevice);scaleProvider.updateScaleRatio(imageToScaleWidth);return scaleProvider}}module.exports=ContextBasedScaleProviderFactory},{"./ContextBasedScaleProvider":161,"./ScaleProviderFactory":167}],163:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const ScaleProvider=require("./ScaleProvider");class FixedScaleProvider extends ScaleProvider{constructor(scaleRatio){super();ArgumentGuard.greaterThanZero(scaleRatio,"scaleRatio");this._scaleRatio=scaleRatio}getScaleRatio(){return this._scaleRatio}}module.exports=FixedScaleProvider},{"../ArgumentGuard":96,"./ScaleProvider":166}],164:[function(require,module,exports){"use strict";const FixedScaleProvider=require("./FixedScaleProvider");const ScaleProviderFactory=require("./ScaleProviderFactory");class FixedScaleProviderFactory extends ScaleProviderFactory{constructor(scaleRatio,scaleProviderHandler){super(scaleProviderHandler);this._fixedScaleProvider=new FixedScaleProvider(scaleRatio)}getScaleProviderImpl(imageToScaleWidth){return this._fixedScaleProvider}}module.exports=FixedScaleProviderFactory},{"./FixedScaleProvider":163,"./ScaleProviderFactory":167}],165:[function(require,module,exports){"use strict";const FixedScaleProvider=require("./FixedScaleProvider");class NullScaleProvider extends FixedScaleProvider{constructor(){super(1)}}module.exports=NullScaleProvider},{"./FixedScaleProvider":163}],166:[function(require,module,exports){"use strict";class ScaleProvider{getScaleRatio(){}}module.exports=ScaleProvider},{}],167:[function(require,module,exports){"use strict";class ScaleProviderFactory{constructor(scaleProviderHandler){this._scaleProviderHandler=scaleProviderHandler}getScaleProvider(imageToScaleWidth){const scaleProvider=this.getScaleProviderImpl(imageToScaleWidth);this._scaleProviderHandler.set(scaleProvider);return scaleProvider}getScaleProviderImpl(imageToScaleWidth){throw new Error("The method `getScaleProviderImpl` from `ScaleProviderFactory` should be implemented!")}}module.exports=ScaleProviderFactory},{}],168:[function(require,module,exports){"use strict";const ScaleProviderFactory=require("./ScaleProviderFactory");class ScaleProviderIdentityFactory extends ScaleProviderFactory{constructor(scaleProvider,scaleProviderHandler){super(scaleProviderHandler);this._scaleProvider=scaleProvider}getScaleProviderImpl(imageToScaleWidth){return this._scaleProvider}}module.exports=ScaleProviderIdentityFactory},{"./ScaleProviderFactory":167}],169:[function(require,module,exports){"use strict";class MatchResult{constructor(){this.asExpected=null;this.windowId=null;this.screenshot=null}getAsExpected(){return this.asExpected}setAsExpected(value){this.asExpected=value}getWindowId(){return this.windowId}setWindowId(value){this.windowId=value}getScreenshot(){return this.screenshot}setScreenshot(value){this.screenshot=value}}module.exports=MatchResult},{}],170:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");class PropertyData{constructor(name,value){this._name=name;this._value=value}getName(){return this._name}setName(value){this._name=value}getValue(){return this._value}setValue(value){this._value=value}toJSON(){return{name:this._name,value:this._value}}toString(){return`PropertyData { ${GeneralUtils.toJson(this)} }`}}module.exports=PropertyData},{"../GeneralUtils":102}],171:[function(require,module,exports){"use strict";const url=require("url");const ArgumentGuard=require("../ArgumentGuard");class ProxySettings{constructor(uri,username,password){ArgumentGuard.notNull(uri,"uri");this._uri=uri;this._username=username;this._password=password;this._url=url.parse(uri)}getUri(){return this._uri}getUsername(){return this._username}getPassword(){return this._password}toProxyObject(){const proxy={};proxy.host=this._url.hostname;proxy.port=this._url.port;if(!this._username&&this._url.auth){const i=this._url.auth.indexOf(":");if(i!==-1){proxy.auth={username:this._url.auth.slice(0,i),password:this._url.auth.slice(i+1)}}}else if(this._username){proxy.auth={username:this._username,password:this._password}}return proxy}}module.exports=ProxySettings},{"../ArgumentGuard":96,url:50}],172:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");class RunningSession{constructor(){this.isNewSession=false;this.id=null;this.url=null}getIsNewSession(){return this.isNewSession}setNewSession(value){this.isNewSession=value}getId(){return this.id}setId(value){this.id=value}getUrl(){return this.url}setUrl(value){this.url=value}toJSON(){return{id:this.id,url:this.url,isNewSession:this.isNewSession}}toString(){return`RunningSession { ${GeneralUtils.toJson(this)} }`}}module.exports=RunningSession},{"../GeneralUtils":102}],173:[function(require,module,exports){(function(Buffer){"use strict";const axios=require("axios");const ProxySettings=require("./ProxySettings");const RunningSession=require("./RunningSession");const TestResults=require("./TestResults");const MatchResult=require("./MatchResult");const GeneralUtils=require("../GeneralUtils");const ArgumentGuard=require("../ArgumentGuard");const DEFAULT_TIMEOUT_MS=3e5;const API_PATH="/api/sessions/running";const LONG_REQUEST_DELAY_MS=2e3;const MAX_LONG_REQUEST_DELAY_MS=1e4;const LONG_REQUEST_DELAY_MULTIPLICATIVE_INCREASE_FACTOR=1.5;const DEFAULT_HEADERS={Accept:"application/json","Content-Type":"application/json"};const HTTP_STATUS_CODES={CREATED:201,ACCEPTED:202,OK:200,GONE:410};class ServerConnector{constructor(promiseFactory,logger,serverUrl){this._promiseFactory=promiseFactory;this._logger=logger;this.setServerUrl(serverUrl);this._apiKey=null;this._proxySettings=null;this._timeout=DEFAULT_TIMEOUT_MS;this._httpOptions={proxy:null,headers:DEFAULT_HEADERS,timeout:DEFAULT_TIMEOUT_MS,responseType:"json",params:{}}}setServerUrl(serverUrl){this._serverUrl=serverUrl;this._endPoint=GeneralUtils.urlConcat(serverUrl,API_PATH)}getServerUrl(){return this._serverUrl}setApiKey(apiKey){ArgumentGuard.notNull(apiKey,"apiKey");this._apiKey=apiKey;this._httpOptions.params.apiKey=apiKey}getApiKey(){return this._apiKey}setProxy(arg1,username,password){if(arg1 instanceof ProxySettings){this._proxySettings=arg1}else{this._proxySettings=new ProxySettings(arg1,username,password)}this._httpOptions.proxy=this._proxySettings.toProxyObject()}getProxy(){return this._proxySettings}setRemoveSession(shouldRemove){this._httpOptions.params.removeSession=shouldRemove}getRemoveSession(){return!!this._httpOptions.params.removeSession}setTimeout(timeout){ArgumentGuard.greaterThanOrEqualToZero(timeout,"timeout");this._timeout=timeout;this._httpOptions.timeout=this._timeout}getTimeout(){return this._timeout}startSession(sessionStartInfo){ArgumentGuard.notNull(sessionStartInfo,"sessionStartInfo");this._logger.verbose(`ServerConnector.startSession called with: ${sessionStartInfo}`);const that=this;const uri=this._endPoint;const options={data:{startInfo:sessionStartInfo}};return sendRequest(that,"startSession",uri,"post",options).then(response=>{const validStatusCodes=[HTTP_STATUS_CODES.OK,HTTP_STATUS_CODES.CREATED];if(validStatusCodes.includes(response.status)){that._logger.verbose("ServerConnector.startSession - post succeeded");const runningSession=new RunningSession;Object.assign(runningSession,response.data);runningSession.setNewSession(response.status===HTTP_STATUS_CODES.CREATED);return runningSession}throw new Error(`ServerConnector.startSession - unexpected status (${response.statusText})`)})}stopSession(runningSession,isAborted,save){ArgumentGuard.notNull(runningSession,"runningSession");this._logger.verbose(`ServerConnector.stopSession called with isAborted: ${isAborted}, save: ${save} for session: ${runningSession}`);const that=this;const uri=GeneralUtils.urlConcat(this._endPoint,runningSession.getId());const options={params:{aborted:isAborted,updateBaseline:save}};return sendLongRequest(that,"stopSession",uri,"delete",options).then(response=>{const validStatusCodes=[HTTP_STATUS_CODES.OK];if(validStatusCodes.includes(response.status)){that._logger.verbose("ServerConnector.stopSession - post succeeded");const testResults=new TestResults;Object.assign(testResults,response.data);return testResults}throw new Error(`ServerConnector.stopSession - unexpected status (${response.statusText})`)})}matchWindow(runningSession,matchWindowData){ArgumentGuard.notNull(runningSession,"runningSession");ArgumentGuard.notNull(matchWindowData,"matchWindowData");this._logger.verbose(`ServerConnector.matchWindow called with ${matchWindowData} for session: ${runningSession}`);const that=this;const uri=GeneralUtils.urlConcat(this._endPoint,runningSession.getId());const options={contentType:"application/octet-stream",data:Buffer.concat([createDataBytes(matchWindowData),matchWindowData.getAppOutput().getScreenshot64()])};return sendLongRequest(that,"matchWindow",uri,"post",options).then(response=>{const validStatusCodes=[HTTP_STATUS_CODES.OK];if(validStatusCodes.includes(response.status)){that._logger.verbose("ServerConnector.matchWindow - post succeeded");const matchResult=new MatchResult;Object.assign(matchResult,response.data);return matchResult}throw new Error(`ServerConnector.matchWindow - unexpected status (${response.statusText})`)})}replaceWindow(runningSession,stepIndex,matchWindowData){ArgumentGuard.notNull(runningSession,"runningSession");ArgumentGuard.notNull(matchWindowData,"matchWindowData");this._logger.verbose(`ServerConnector.replaceWindow called with ${matchWindowData} for session: ${runningSession}`);const that=this;const uri=GeneralUtils.urlConcat(this._endPoint,runningSession.getId()+"/"+stepIndex);const options={contentType:"application/octet-stream",body:Buffer.concat([createDataBytes(matchWindowData),matchWindowData.getAppOutput().getScreenshot64()])};return sendLongRequest(that,"replaceWindow",uri,"put",options).then(response=>{const validStatusCodes=[HTTP_STATUS_CODES.OK];if(validStatusCodes.includes(response.status)){that._logger.verbose("ServerConnector.replaceWindow - post succeeded");const matchResult=new MatchResult;Object.assign(matchResult,response.data);return matchResult}throw new Error(`ServerConnector.replaceWindow - unexpected status (${response.statusText})`)})}}function sendLongRequest(that,name,uri,method,options={}){const headers={"Eyes-Expect":"202+location","Eyes-Date":GeneralUtils.getRfc1123Date()};options.headers=options.headers?Object.assign(options.headers,headers):headers;return sendRequest(that,name,uri,method,options).then(response=>{return longRequestCheckStatus(that,name,response)})}function longRequestCheckStatus(that,name,response){switch(response.status){case HTTP_STATUS_CODES.OK:return that._promiseFactory.resolve(response);case HTTP_STATUS_CODES.ACCEPTED:const uri=response.headers["location"];return longRequestLoop(that,name,uri,LONG_REQUEST_DELAY_MS).then(response=>{return longRequestCheckStatus(that,name,response)});case HTTP_STATUS_CODES.CREATED:const deleteUri=response.headers["location"];const options={headers:{"Eyes-Date":GeneralUtils.getRfc1123Date()}};return sendRequest(that,name,deleteUri,"delete",options);case HTTP_STATUS_CODES.GONE:return that._promiseFactory.reject(new Error("The server task has gone."));default:return that._promiseFactory.reject(new Error(`Unknown error processing long request: ${GeneralUtils.toJson(response)}`))}}function longRequestLoop(that,name,uri,delay){delay=Math.min(MAX_LONG_REQUEST_DELAY_MS,Math.floor(delay*LONG_REQUEST_DELAY_MULTIPLICATIVE_INCREASE_FACTOR));that._logger.verbose(`${name}: Still running... Retrying in ${delay} ms`);return GeneralUtils.sleep(delay,that._promiseFactory).then(()=>{const options={headers:{"Eyes-Date":GeneralUtils.getRfc1123Date()}};return sendRequest(that,name,uri,"get",options)}).then(response=>{if(response.status!==HTTP_STATUS_CODES.OK){return response}return longRequestLoop(that,name,uri,delay)})}function sendRequest(that,name,url,method,options={}){const request=GeneralUtils.clone(that._httpOptions);request.url=url;request.method=method;if(options.params){request.params=Object.assign(request.params,options.params)}if(options.headers){request.headers=Object.assign(request.headers,options.headers)}if(options.data){request.data=options.data}if(options.contentType){request.headers["Content-Type"]=options.contentType}that._logger.verbose(`ServerConnector.${name} will now post call to: ${request.url}`);return axios(request).then(function(response){that._logger.verbose(`ServerConnector.${name} - result ${response.statusText}, status code ${response.status}`);return response}).catch(error=>{that._logger.log(`ServerConnector.${name} - post failed: ${error.response.statusText}`);throw error})}function createDataBytes(jsonData){const dataStr=GeneralUtils.toJson(jsonData);const dataLen=Buffer.byteLength(dataStr,"utf8");const result=new Buffer(dataLen+4);result.writeUInt32BE(dataLen,0);result.write(dataStr,4,dataLen);return result}module.exports=ServerConnector}).call(this,require("buffer").Buffer)},{"../ArgumentGuard":96,"../GeneralUtils":102,"./MatchResult":169,"./ProxySettings":171,"./RunningSession":172,"./TestResults":176,axios:60,buffer:9}],174:[function(require,module,exports){"use strict";const GeneralUtils=require("../GeneralUtils");const ArgumentGuard=require("../ArgumentGuard");class SessionStartInfo{constructor(agentId,sessionType,appIdOrName,verId,scenarioIdOrName,batchInfo,baselineEnvName,environmentName,environment,defaultMatchSettings,branchName,parentBranchName,properties){ArgumentGuard.notNullOrEmpty(agentId,"agentId");ArgumentGuard.notNullOrEmpty(appIdOrName,"appIdOrName");ArgumentGuard.notNullOrEmpty(scenarioIdOrName,"scenarioIdOrName");ArgumentGuard.notNull(batchInfo,"batchInfo");ArgumentGuard.notNull(environment,"environment");ArgumentGuard.notNull(defaultMatchSettings,"defaultMatchSettings");this._agentId=agentId;this._sessionType=sessionType;this._appIdOrName=appIdOrName;this._verId=verId;this._scenarioIdOrName=scenarioIdOrName;this._batchInfo=batchInfo;this._baselineEnvName=baselineEnvName;this._environmentName=environmentName;this._environment=environment;this._defaultMatchSettings=defaultMatchSettings;this._branchName=branchName;this._parentBranchName=parentBranchName;this._properties=properties}getAgentId(){return this._agentId}getSessionType(){return this._sessionType}getAppIdOrName(){return this._appIdOrName}getVerId(){return this._verId}getScenarioIdOrName(){return this._scenarioIdOrName}getBatchInfo(){return this._batchInfo}getBaselineEnvName(){return this._baselineEnvName}getEnvironmentName(){return this._environmentName}getEnvironment(){return this._environment}getDefaultMatchSettings(){return this._defaultMatchSettings}getBranchName(){return this._branchName}getParentBranchName(){return this._parentBranchName}getProperties(){return this._properties}toJSON(){return{agentId:this._agentId,sessionType:this._sessionType,appIdOrName:this._appIdOrName,verId:this._verId,scenarioIdOrName:this._scenarioIdOrName,batchInfo:this._batchInfo,baselineEnvName:this._baselineEnvName,environmentName:this._environmentName,environment:this._environment,defaultMatchSettings:this._defaultMatchSettings,branchName:this._branchName,parentBranchName:this._parentBranchName,properties:this._properties}}toString(){return`SessionStartInfo { ${GeneralUtils.toJson(this)} }`}}module.exports=SessionStartInfo},{"../ArgumentGuard":96,"../GeneralUtils":102}],175:[function(require,module,exports){"use strict";const SessionType={SEQUENTIAL:"SEQUENTIAL",PROGRESSION:"PROGRESSION"};Object.freeze(SessionType);module.exports=SessionType},{}],176:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const TestResultsStatus=require("./TestResultsStatus");class TestResults{constructor(){this.status=null;this.appUrls=null;this.apiUrls=null;this.stepsInfo=null;this.steps=null;this.matches=null;this.mismatches=null;this.missing=null;this.exactMatches=null;this.strictMatches=null;this.contentMatches=null;this.layoutMatches=null;this.noneMatches=null;this.url=null;this.isNew=null;this.isDifferent=null;this.isAborted=null}isPassed(){return this.status===TestResultsStatus.Passed}getStatus(){return this.status}setStatus(value){this.status=value}getAppUrls(){return this.appUrls}setAppUrls(value){this.appUrls=value}getApiUrls(){return this.apiUrls}setApiUrls(value){this.apiUrls=value}getStepsInfo(){return this.stepsInfo}setStepsInfo(value){this.stepsInfo=value}getSteps(){return this.steps}setSteps(value){ArgumentGuard.greaterThanOrEqualToZero(value,"steps");this.steps=value}getMatches(){return this.matches}setMatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"matches");this.matches=value}getMismatches(){return this.mismatches}setMismatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"mismatches");this.mismatches=value}getMissing(){return this.missing}setMissing(value){ArgumentGuard.greaterThanOrEqualToZero(value,"missing");this.missing=value}getExactMatches(){return this.exactMatches}setExactMatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"exactMatches");this.exactMatches=value}getStrictMatches(){return this.strictMatches}setStrictMatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"strictMatches");this.strictMatches=value}getContentMatches(){return this.contentMatches}setContentMatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"contentMatches");this.contentMatches=value}getLayoutMatches(){return this.layoutMatches}setLayoutMatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"layoutMatches");this.layoutMatches=value}getNoneMatches(){return this.noneMatches}setNoneMatches(value){ArgumentGuard.greaterThanOrEqualToZero(value,"noneMatches");this.noneMatches=value}getUrl(){return this.url}setUrl(value){this.url=value}getIsNew(){return this.isNew}setIsNew(value){this.isNew=value}getIsDifferent(){return this.isDifferent}setIsDifferent(value){this.isDifferent=value}getIsAborted(){return this.isAborted}setIsAborted(value){this.isAborted=value}toString(){const isNewTestStr=this.isNew?"New test":"Existing test";return`${isNewTestStr} [steps: ${this.steps}, matches: ${this.matches}, mismatches:${this.mismatches}, missing: ${this.missing}] , URL: ${this.url}`}}module.exports=TestResults},{"../ArgumentGuard":96,"./TestResultsStatus":177}],177:[function(require,module,exports){"use strict";const TestResultsStatus={Passed:"Passed",Unresolved:"Unresolved",Failed:"Failed"};Object.freeze(TestResultsStatus);module.exports=TestResultsStatus},{}],178:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const Trigger=require("./Trigger");class MouseTrigger extends Trigger{constructor(mouseAction,control,location){super();ArgumentGuard.notNull(mouseAction,"mouseAction");ArgumentGuard.notNull(control,"control");this._mouseAction=mouseAction;this._control=control;this._location=location}getMouseAction(){return this._mouseAction}getControl(){return this._control}getLocation(){return this._location}getTriggerType(){return Trigger.TriggerType.Mouse}toString(){return`${this._mouseAction} [${this._control}] ${this._location}`}}MouseTrigger.MouseAction={None:"None",Click:"Click",RightClick:"RightClick",DoubleClick:"DoubleClick",Move:"Move",Down:"Down",Up:"Up"};Object.freeze(MouseTrigger.MouseAction);module.exports=MouseTrigger},{"../ArgumentGuard":96,"./Trigger":180}],179:[function(require,module,exports){"use strict";const ArgumentGuard=require("../ArgumentGuard");const Trigger=require("./Trigger");class TextTrigger extends Trigger{constructor(control,text){super();ArgumentGuard.notNull(control,"control");ArgumentGuard.notNullOrEmpty(text,"text");this._text=text;this._control=control}getText(){return this._text}getControl(){return this._control}getTriggerType(){return Trigger.TriggerType.Text}toString(){return`Text [${this._control}] ${this._text}`}}module.exports=TextTrigger},{"../ArgumentGuard":96,"./Trigger":180}],180:[function(require,module,exports){"use strict";class Trigger{constructor(){if(new.target===Trigger){throw new TypeError("Can not construct `Trigger` instance directly, should be used implementation!")}}getTriggerType(){throw new TypeError("The method `getTriggerType` from `Trigger` should be implemented!")}}Trigger.TriggerType={Unknown:"Unknown",Mouse:"Mouse",Text:"Text",Keyboard:"Keyboard"};Object.freeze(Trigger.TriggerType);module.exports=Trigger},{}]},{},[1]);
